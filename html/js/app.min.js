function clearVariables(){progressVal=0,motifsContentTypeList=[],motifsList=[],motifsDataSource.read(),filmsList=[],tmpFilmsList=[],filmsDataSource.read(),ProductList=[],clipsDataSource.read(),dicativeList=[],clipsLocArr=[],motifsTypeNamArr=[],currClipsIds=[],currClipsList=[],currentProdClipsDataSource.read(),curMotifsList=[],currMotifTypesList=[],currClipMotifsList=[],currentProdMotifsDataSource.read(),currentProduction.set("prodObj",defProductionParams),accountsArr=[],accountsDataSource.read(),groupArr=[],groupUsersArr=[],prodGroups=[],motifTypesArr=[],audioArr=[],productionsArr=[],openProdsArr=[],finishedProdsArr=[],finishedProdsDataSource.read(),userAccount.set("loginStatus",0),userAccount.set("id",0),userAccount.set("groupId",0),userAccount.set("firstName","empty"),userAccount.set("surName","empty"),userAccount.set("inProduction",[]),userAccount.set("curProduction",""),userAccount.set("productsVal",0),userAccount.set("motifsVal",0),userAccount.set("indicatives",-1),userAccount.set("abdicatives",-1),ProductionsStatArr=[],ProductUsageStatArr=[]}function toggleBtnStatus(btns,status){$(btns.selector).each(function(){$(this).data("kendoButton").enable(status)})}function countClipMotifs(callback){for(var i=0;i<motifsContentTypeList.length;i++)for(var j=0;j<ProductList.length;j++){if(motifsContentTypeList[i].productID==ProductList[j].clipId){ProductList[j].motifsNum++,ProductList[j].motifNamesString+=motifsContentTypeList[i].name+" ";break}ProductList[j].emptyMotifs=ProductList[j].motifsNum}clipsDataSource.read(),admProductsDataSource.read(),callback&&"function"==typeof callback&&callback()}function urlGen(method){var hostname=window.location.hostname;hostname=hostname.split("."),hostname=hostname.slice(-2),hostname=hostname.join("."),-1!=window.location.hostname.indexOf("www")&&(hostname="www."+hostname);var shaObj=new jsSHA(method,"TEXT"),hash=shaObj.getHash("SHA-1","HEX");return shaObj=new jsSHA(hash+SALTED,"TEXT"),hash=shaObj.getHash("SHA-1","HEX"),window.location.protocol+"//"+hostname+"/services/index.php?pass="+hash+"&call="+method}function loadingInc(val){if($("#loading-progressbar").length){var loadingProgressBar=$("#loading-progressbar").data("kendoProgressBar"),val=parseInt(val/progressMaxVal*100);loadingProgressBar.value(val),val>=progressMaxVal&&(router.navigate("/hub"),kendo.bind($("#hubPage"),userAccount))}}function loginFunc(){var loginData=$("#login-form").serializeArray();$.ajax({type:"POST",url:urlGen("login"),cache:!1,data:loginData,success:function(data){0==+data.Result?($("#login-form .error-msg").fadeIn(300).delay(5e3).fadeOut(700),console.log("Wrong username or password"),router.navigate("/login")):3==+data.Result?($("#login-form .error-same-user").fadeIn(300).delay(5e3).fadeOut(700),console.log("Same user is already logged in"),router.navigate("/login")):2==+data.Result&&(userAccount.set("id",parseInt(data.ID)),userAccount.set("groupId",parseInt(data.AccountGroupID)),userAccount.set("firstName",data.Name1),userAccount.set("surName",data.Name2),userAccount.set("indicatives",parseInt(data.Indicative)),userAccount.set("abdicatives",parseInt(data.Abdicative)),userAccount.set("onlinethreesixty",1==data.onlinethreesixty),defProductionParams.name=currLang.NEW_PRODUCTION,currentProduction.set("name",currLang.NEW_PRODUCTION),$.when(getFileExtensions(),getDicativesByAccount(),getMotifListByAccount(),getFilmsByAccount(),getProductListByAccount()).then(function(){$.when(getAudioList(),mergeProductsNDicatives(ProductList,dicativeList,function(){1==userAccount.get("groupId")&&editGroupObj.set("ProductList",ProductList),loadingInc(++progressVal)}),getContentTypeListByAccount()).then(function(){countClipMotifs(),initSortingSelects(),-1==userAccount.get("indicatives")&&-1==userAccount.get("abdicatives")||productionManageFunc(!0,function(){loadingInc(++progressVal),currClipMotifsList=[],populateProdMotifsArr(function(){checkEmptyMotifs(),currentProdMotifsDataSource.read(),currentProdClipsDataSource.read(),recalcProductionTime(),loadingInc(++progressVal)})})})}),userAccount.set("loginStatus",1),router.navigate("/loading"),1==userAccount.get("groupId")&&(progressMaxVal+=4,getAccountGroupList(function(){getAccountList(function(){editAccObj.set("groupNamesField",groupArr)})}),getProductGroupList(function(){}),getContentFormats(function(){})))},error:function(jqXHR,textStatus,errorThrown){console.log("failed to connect"),console.log(textStatus+" - "+errorThrown),$("#login-form .error").prepend('<p class="cur-error">failed to send login request - '+textStatus+"</p>").find(".cur-error").fadeIn(300).delay(5e3).fadeOut(700,function(){$("#login-form .cur-error").remove()}),router.navigate("/login")}})}function getFileExtensions(callback){var dfd=new $.Deferred;return $.ajax({type:"GET",url:urlGen("getFileExtensions"),cache:!1,success:function(data){var dataArr=data.MediaFormats.MediaFormat;fileExtensionsArr=[];for(var i=0;i<dataArr.length;i++)fileExtensionsArr.push({id:parseInt(dataArr[i].ID),extension:dataArr[i].Extension,name:dataArr[i].Name,type:dataArr[i].Type}),"motif"!=dataArr[i].Type&&"film"!=dataArr[i].Type||(motifUploadAcceptStr+=dataArr[i].Extension+",");motifUploadAcceptStr=motifUploadAcceptStr.substr(0,motifUploadAcceptStr.length-1),dfd.resolve(),loadingInc(++progressVal),callback&&"function"==typeof callback&&callback()}}),dfd.promise()}function getFileExtensionStr(fileName){return fileName=/[.]/.exec(fileName)?/[^.]+$/.exec(fileName):void 0,fileName[0]}function checkFileExtension(fileExt){fileExt="."+getFileExtensionStr(fileExt);for(var i=0;i<fileExtensionsArr.length;i++)if(fileExtensionsArr[i].extension==fileExt)return fileExtensionsArr[i].id}function getContentTypeListByAccount(callback){function getContentTypeListByAccountProcess(data){motifsContentTypeList=[];for(var i=0;i<data.length;i++)motifsContentTypeList.push({motifTypeId:parseInt(data[i].ID),name:data[i].Name,aspect:parseFloat(data[i].Aspect),position:parseInt(data[i].Position),positionName:alphabetNumeration[parseInt(data[i].Position)-1],productID:parseInt(data[i].ProductID),loaderName:data[i].LoaderName,contentType:data[i].Content,canLoop:parseInt(data[i].CanLoop),acceptsFilm:parseInt(data[i].AcceptsFilm)});loadingInc(++progressVal)}var dfd=new $.Deferred;return 1==userAccount.get("groupId")?$.ajax({type:"GET",url:urlGen("getContentTypeListByAccount"),cache:!1,success:function(data){getContentTypeListByAccountProcess(data.ContentTypes.ContentType),dfd.resolve(),callback&&"function"==typeof callback&&callback()},error:function(data){console.log("can't get contentType list"),dfd.catch()}}):$.ajax({type:"POST",url:urlGen("getContentTypeListByAccount"),cache:!1,data:{accountGroupID:+userAccount.get("groupId")},success:function(data){getContentTypeListByAccountProcess(data.ContentTypes.ContentType),dfd.resolve(),callback&&"function"==typeof callback&&callback()},error:function(data){console.log("can't get contentType list"),dfd.catch()}}),dfd.promise()}function getMotifListByAccount(callback){var dfd=new $.Deferred;return $.ajax({type:"POST",url:urlGen("getMotifListByAccount"),cache:!1,data:{accountID:+userAccount.get("id"),min_date:0},success:function(data){motifsList=[];for(var itemID=0,i=0;i<data.length;i++)motifsList.push({id:itemID++,motifId:+data[i].Motif.ID,accountId:+data[i].Motif.AccountID,name:data[i].Motif.Name,frameCount:+data[i].Motif.FrameCount,crTime:+data[i].Motif.CreationTime,date:dateFormating(parseInt(data[i].Motif.CreationTime)),description:data[i].Motif.Description});userAccount.set("motifsVal",motifsList.length),motifsDataSource.read(),dfd.resolve(),loadingInc(++progressVal),callback&&"function"==typeof callback&&callback()},error:function(data){console.log("can't get motifs list JSON"),dfd.catch()}}),dfd.promise()}function uploadMotifFunc(loadedMotif,callback){$("#motif-upload-form .table-cell > img").hide().attr("src",""),$("#saveMotifBtn").data("kendoButton").enable(!1),$("#motif-upload-form .img-wr p").show();var motifUploadData=new FormData;motifUploadData.append("accountID",+userAccount.get("id")),motifUploadData.append("extension",getFileExtensionStr(loadedMotif.name)),motifUploadData.append("name",loadedMotif.name),motifUploadData.append("Filedata",loadedMotif),loadedMotif.type.match(/video.*/)?motifUploadData.append("image_film_flag","film"):(loadedMotif.type.match(/image.*/)||loadedMotif.type.match(/.pdf/))&&motifUploadData.append("image_film_flag","image"),$("#newMotifName").val(loadedMotif.name.split(".")[0]),$("#motif-upload-progressbar").show(100),$.ajax({type:"POST",url:urlGen("uploadMotif"),cache:!1,processData:!1,contentType:!1,data:motifUploadData,xhr:function(){myXhr=$.ajaxSettings.xhr(),$("#motif-upload-form .img-wr p > span").hide(),$("#motif-upload-form .img-wr p .wait-loading").show();var motifProgressBar=$("#motif-upload-progressbar").data("kendoProgressBar");return myXhr.upload&&myXhr.upload.addEventListener("progress",function(e){var pc=parseInt(e.loaded/e.total*100);motifProgressBar.value(pc)},!1),myXhr},success:function(data){if(null==data)return $("#motif-upload-form .img-wr p > span").hide(),$("#motif-upload-form .img-wr p .error").show(),$("#motif-upload-progressbar").hide(100),!1;$("#motif-upload-form .img-wr p > span").hide(),$("#motif-upload-form .img-wr p .default").show();var dataObj=data.Result;if(uploadMotifObj={accountID:userAccount.get("id"),media_format_id:0,aspect:parseFloat(dataObj.Aspect),width:0,fileName:dataObj.Name,fileExtension:dataObj.Extension,description:$("#descriptionValue").val(),frameCount:parseInt(dataObj.nFrames),name:$("#newMotifName").val(),animated:parseInt(dataObj.Animated)},uploadMotifObj.media_format_id=checkFileExtension(uploadMotifObj.fileName+uploadMotifObj.fileExtension),loadedMotif.type.match(/image.*/)||loadedMotif.type.match(/.pdf/)){var motifImgWr=$("#motif-upload-form .img-wr"),imgWrAspect=motifImgWr.width()/motifImgWr.height(),oldImg=$("#motif-upload-form .table-cell > img"),tmpImg=document.createElement("img");$("#motif-upload-form .img-wr p").hide(),setTimeout(function(){checkImageLoad(tmpImg,function(){$("#saveMotifBtn").data("kendoButton").enable(!0)})},100),tmpImg.src=window.location.protocol+"//"+window.location.host.replace("www.","")+"/data/accounts/"+userAccount.get("id")+"/temp/"+uploadMotifObj.fileName+"_thumb.jpg",uploadMotifObj.aspect>imgWrAspect?$(tmpImg).css("width",motifImgWr.width()):$(tmpImg).css("height",motifImgWr.height()),$(tmpImg).insertAfter(oldImg),$(tmpImg).show().css("display","block"),$(oldImg).remove()}loadedMotif.type.match(/video.*/)&&(uploadMotifObj.width=0,uploadMotifObj.frameCount=-1,$("#motif-upload-form .img-wr p > span").hide(),$("#motif-upload-form .img-wr p .video").show(),$("#saveMotifBtn").data("kendoButton").enable(!0)),$("#motif-upload-progressbar").hide(100),callback&&"function"==typeof callback&&callback()}})}function checkImageLoad(imgObj,callback){imgObj.complete?callback&&"function"==typeof callback&&callback():setTimeout(function(){checkImageLoad(imgObj,callback)},500)}function saveMotifFunc(callback){uploadMotifObj.name=$("#newMotifName").val(),uploadMotifObj.description=$("#descriptionValue").val(),$.ajax({type:"POST",url:urlGen("saveMotif"),cache:!1,data:{accountID:uploadMotifObj.accountID,media_format_id:uploadMotifObj.media_format_id,aspect:uploadMotifObj.aspect.toString(),width:uploadMotifObj.width,fileName:uploadMotifObj.fileName+uploadMotifObj.fileExtension,description:uploadMotifObj.description,frameCount:uploadMotifObj.frameCount,name:uploadMotifObj.name},success:function(data){var loadedMotifID=data.ID;getMotifListByAccount().then(function(){window.scrollTo(0,0);var newMotifEl=document.querySelectorAll("[data-id='"+loadedMotifID+"']");if(1==uploadMotifObj.animated){$(newMotifEl).find(".img").css("background-image","url("+window.location.protocol+"//"+window.location.host.replace("www.","")+"/data/accounts/"+userAccount.get("id")+"/motifs/"+loadedMotifID+"_thumb.jpg)");var tmpImg=document.createElement("img");$(tmpImg).on("error",function(){setTimeout(function(){var randomId=(new Date).getTime(),srcStr=window.location.protocol+"//"+window.location.host.replace("www.","")+"/data/accounts/"+userAccount.get("id")+"/motifs/"+loadedMotifID+"_thumb.jpg?r="+randomId;$(tmpImg).attr("src",srcStr)},1e3)}).on("load",function(){setTimeout(function(){delete tmpImg,getMotifListByAccount()},2e3)}).attr("src",window.location.protocol+"//"+window.location.host.replace("www.","")+"/data/accounts/"+userAccount.get("id")+"/motifs/"+loadedMotifID+"_thumb.jpg")}else setTimeout(function(){$(newMotifEl).find(".img").css("background-image",window.location.protocol+"//"+window.location.host.replace("www.","")+"/data/accounts/"+userAccount.get("id")+"/temp/"+uploadMotifObj.fileName+"_thumb.jpg)")},500)}),callback&&"function"==typeof callback&&callback()}})}function deleteMotifFunc(motifID,callback){deleteMotifObj={ownerID:+userAccount.get("id"),motifID:motifID,permanent:0},$.ajax({type:"POST",url:urlGen("deleteMotif"),cache:!1,data:deleteMotifObj,success:function(data){console.log(data),callback&&"function"==typeof callback&&callback()}})}function sepAndSortCodecs(arr){$.each(arr,function(i,item){item.tplName=item.name.split(":")[1],item.onlinethreesixty=userAccount.get("onlinethreesixty")}),arr.sort(function(a,b){return a.sort_order-b.sort_order});var resArr={mp4:[],wmv:[],vr360:[],special:[],other:[]};return $.each(arr,function(i,item){switch(item.type_group){case"1":resArr.mp4.push(item);break;case"2":resArr.wmv.push(item);break;case"3":resArr.vr360.push(item);break;case"4":resArr.special.push(item);break;default:resArr.other.push(item)}}),resArr}function getProductListByAccount(callback){function getProductListByAccountProcess(data){codecTypes=$.extend(!0,[],data.CodecTypes),$.each(codecTypes,function(i,item){item.resName=item.name.split(":")[1],item.onlinethreesixty=userAccount.get("onlinethreesixty")}),codecTypesLists=sepAndSortCodecs(data.CodecTypes),editProductObj.set("codecs",codecTypesLists),clipFormats=$.extend(!0,[],data.ContentFormats),data=data.Products.Product,ProductList=[];for(var itemID=0,i=0;i<data.length;i++)ProductList.push({id:itemID++,clipId:parseInt(data[i].ID),idString:to4DigitsSting(data[i].ID),categoryId:parseInt(data[i].GroupID),name:data[i].Name,location:data[i].Location,motifNamesString:"",crTime:data[i].CreationTime,date:dateFormating(parseInt(data[i].CreationTime)),duration:data[i].OutFrame-data[i].InFrame+1,durTime:timeFormating(parseInt(data[i].Frames)),motifsNum:0,emptyMotifs:0,locked:"",previewFrame:parseInt(data[i].PreviewFrame),description:data[i].Description,productType:data[i].ProductType,productTypeName:clipFormats[+data[i].ProductType-1].name,allowedCodecs:data[i].AllowedCodecTypes,can_reformat:data[i].can_reformat,resolution:data[i].resolution,master_ID:data[i].MasterProductId,inFrame:data[i].InFrame,outFrame:data[i].OutFrame});loadingInc(++progressVal)}var dfd=new $.Deferred;return 1==userAccount.get("groupId")?$.ajax({type:"GET",url:urlGen("getShortProductListByAccount"),cache:!1,success:function(data){getProductListByAccountProcess(data),dfd.resolve(),callback&&"function"==typeof callback&&callback()}}):$.ajax({type:"POST",url:urlGen("getShortProductListByAccount"),cache:!1,data:{accountGroupID:parseInt(userAccount.get("groupId"))},success:function(data){getProductListByAccountProcess(data),dfd.resolve(),callback&&"function"==typeof callback&&callback()}}),dfd.promise()}function getDicativesByAccount(callback){function getDicativesByAccountProcess(data){dicativeList=[];for(var itemID=0,i=0;i<data.length;i++)dicativeList.push({id:itemID++,clipId:parseInt(data[i].ID),idString:to4DigitsSting(data[i].ID),categoryId:parseInt(data[i].GroupID),name:data[i].Name,location:data[i].Location,motifNamesString:"",crTime:data[i].CreationTime,date:dateFormating(parseInt(data[i].CreationTime)),duration:parseInt(data[i].Frames),durTime:timeFormating(parseInt(data[i].Frames)),motifsNum:0,emptyMotifs:0,locked:"",previewFrame:parseInt(data[i].PreviewFrame),description:data[i].Description,master_ID:data[i].MasterProductId,inFrame:data[i].InFrame,outFrame:data[i].OutFrame});loadingInc(++progressVal)}var dfd=new $.Deferred;return 1==userAccount.get("groupId")?$.ajax({type:"GET",url:urlGen("getDicativesByAccount"),cache:!1,success:function(data){getDicativesByAccountProcess(data.Products.Product),dfd.resolve(),callback&&"function"==typeof callback&&callback()}}):$.ajax({type:"POST",url:urlGen("getDicativesByAccount"),cache:!1,data:{accountGroupID:+userAccount.get("groupId")},success:function(data){getDicativesByAccountProcess(data.Products.Product),dfd.resolve(),callback&&"function"==typeof callback&&callback()}}),dfd.promise()}function mergeProductsNDicatives(baseArray,extArray,callback){for(var overlapFlag=!1,newArr=[],i=0;i<extArray.length;i++){for(var j=0;j<baseArray.length;j++)if(extArray[i].clipId==baseArray[j].clipId){overlapFlag=!0;break}1!=overlapFlag?newArr.push(extArray[i]):overlapFlag=!1}$.merge(baseArray,newArr),callback&&"function"==typeof callback&&callback()}function getFilmsByAccount(callback){var dfd=new $.Deferred;return $.ajax({type:"POST",url:urlGen("getFilmsByAccount"),cache:!1,data:{accountID:+userAccount.get("id"),min_date:0},success:function(data){var dataArr=data.Films.Film;filmsList=[];for(var itemID=0,i=0;i<dataArr.length;i++)filmsList.push({id:itemID++,filmId:+dataArr[i].ID,accountId:dataArr[i].Owner,jobId:dataArr[i].jobID,name:dataArr[i].Name,crTime:dataArr[i].Date,crDate:dateFormating(+dataArr[i].Date),duration:dataArr[i].Duration,durTime:timeFormating(+dataArr[i].Duration),formats:dataArr[i].Formats?dataArr[i].Formats.split(","):[],videoFiles:codecFormatsToArray(dataArr[i].codecFormats,dataArr[i].size,dataArr[i].Formats),videoSizes:dataArr[i].size?dataArr[i].size.split("."):[],products:dataArr[i].Products,motifs:dataArr[i].Motifs,urlHash:dataArr[i].UrlHash,status:dataArr[i].Status?dataArr[i].Status:-1}),dataArr[i].jobID&&!dataArr[i].size&&-1==userAccount.get("inProduction").indexOf(+dataArr[i].ID)&&userAccount.get("inProduction").push(+dataArr[i].ID);userAccount.set("productsVal",filmsList.length),0!=userAccount.get("inProduction").length&&checkProductionStatus(),filmsDataSource.read(),dfd.resolve(),loadingInc(++progressVal),callback&&"function"==typeof callback&&callback()}}),dfd.promise()}function deleteFilmFunc(FilmId,callback){$.ajax({type:"POST",url:urlGen("deleteFilm"),cache:!1,data:{filmID:+FilmId,permanent:0},success:function(data){getFilmsByAccount(),callback&&"function"==typeof callback&&callback()}})}function createSingleProductionFunc(prodObj,callback){$.ajax({type:"POST",url:urlGen("createSingleProduction"),cache:!1,data:prodObj,success:function(data){userAccount.set("lastProdId",data.FilmID),callback&&"function"==typeof callback&&callback()}})}function logOut(){$.ajax({type:"POST",url:urlGen("logout"),cache:!1,data:{accountID:userAccount.get("id")},success:function(data){clearVariables(),router.navigate("/logout")}})}function checkProductionStatus(callback){setTimeout(function(){$.ajax({type:"POST",url:urlGen("checkProductionStatusAdv"),cache:!1,data:{userID:+userAccount.get("id"),filmIDs:userAccount.get("inProduction").join(",")},success:function(data){var renewFlag=!1;data.Films=data.Films.filter(function(obj){return 0!=obj.id});for(var i=0;i<data.Films.length;i++){filmsList.filter(function(obj){return obj.filmId==data.Films[i].id})[0].status=data.Films[i].status,8==data.Films[i].status&&(userAccount.set("inProduction",userAccount.get("inProduction").filter(function(el){return el!=data.Films[i].id})),renewFlag=!0)}filmsDataSource.read(),0!=userAccount.get("inProduction").length&&checkProductionStatus(),renewFlag&&getFilmsByAccount(function(){setTimeout(function(){filmsDataSource.read()},500)}),callback&&"function"==typeof callback&&callback()}})},5e3)}function dateFormating(miliseconds){var d=new Date(1e3*miliseconds);return d.toLocaleDateString()+" - "+to2DigitsSting(d.getHours())+":"+to2DigitsSting(d.getMinutes())}function timeFormating(videoFramesNum){if(0==videoFramesNum)return"00:00 min";var totalSeconds=Math.floor(videoFramesNum/constFPS),minutes=Math.floor(totalSeconds%3600/60);minutes=to2DigitsSting(minutes);var seconds=0==totalSeconds?0:Math.floor(totalSeconds%60-1);return seconds=to2DigitsSting(seconds),minutes+":"+seconds+" min"}function timeFormatingFromClipsArr(framesArr){if(0==framesArr.length)return"00:00 min";for(var totalSeconds=0,i=0;i<framesArr.length;i++)framesArr[i]=Math.floor(framesArr[i]/constFPS),framesArr[i]=0==framesArr[i]?0:framesArr[i]-1,totalSeconds+=framesArr[i];var minutes=Math.floor(totalSeconds%3600/60);minutes=to2DigitsSting(minutes);var seconds=Math.floor(totalSeconds%60);return seconds=to2DigitsSting(seconds),minutes+":"+seconds+"min"}function to2DigitsSting(number){return number="0"+number,number.slice(-2)}function to4DigitsSting(number){return number="000"+number,number.slice(-4)}function codecFormatsToArray(codecString,sizeString,codecIDs){sizeString=null==sizeString?"":sizeString;for(var itemSize,codecArray=codecString.split("+"),sizeArray=sizeString.split("."),IDsArray=codecIDs?codecIDs.split(","):[],i=0;i<codecArray.length;i++)codecArray[i]=codecArray[i].split(":"),itemSize=parseInt(sizeArray[i])/1e6,codecArray[i][2]=itemSize.toFixed(2),codecArray[i][0]=codecArray[i][0].toLowerCase(),codecArray[i][3]=IDsArray[i];return codecArray}function stringToArray(curString){for(var resultArray=curString.split("."),i=0;i<resultArray.length;i++)resultArray[i]=resultArray[i].split(",");return resultArray}function prodStringToArray(curString){return curString.split(",")}function motifsArrayToString(curArray){for(var resultString="",i=0;i<curArray.length;i++){for(var tmpStr="",j=0;j<curArray[i].length;j++)"0"!=curArray[i][j]?tmpStr+=curArray[i][j]+",":tmpStr+="-1,";0==curArray[i].length&&(tmpStr+="-1,"),tmpStr=tmpStr.substr(0,tmpStr.length-1),resultString+=tmpStr+"."}return resultString=resultString.substr(0,resultString.length-1)}function codecFormatsToString(curArray){for(var resultString="",i=0;i<curArray.length;i++)resultString+=curArray[i]+"+";return resultString=resultString.substr(0,resultString.length-1)}function previewFramesStringFunc(curArray){for(var resultString="",i=0;i<curArray.length;i++)resultString+="0,";return resultString=resultString.substr(0,resultString.length-1)}function clipsDurationTotalTime(curArray){for(var framesSum=0,i=0;i<curArray.length;i++)framesSum+=curArray[i].duration;return timeFormating(framesSum)}function clipsDurationToString(curArray){var tpmArr=[],indDur=0,resultString=0,abdDur=0,startCount=0,endCount=curArray.length;-1!=userAccount.get("indicatives")&&startCount++,-1!=userAccount.get("abdicatives")&&endCount--;for(var i=0;i<curArray.length;i++)for(var j=0;j<ProductList.length;j++)if(curArray[i]==ProductList[j].clipId){tpmArr[i]=+ProductList[j].duration;break}for(var i=startCount;i<endCount;i++)resultString+=tpmArr[i];if(-1!=userAccount.get("indicatives"))for(var j=0;j<ProductList.length;j++)if(curArray[0]==ProductList[j].clipId){indDur=+ProductList[j].duration;break}if(-1!=userAccount.get("abdicatives"))for(var j=0;j<ProductList.length;j++)if(curArray[endCount]==ProductList[j].clipId){abdDur=+ProductList[j].duration;break}return resultString=indDur+"."+resultString+"."+abdDur}function clipsArrayToString(curArray){for(var resultString="",i=0;i<curArray.length;i++)resultString+=curArray[i]+",";return resultString=resultString.substr(0,resultString.length-1)}function arrayToCommaString(curArray){for(var resultString="",i=0;i<curArray.length;i++)resultString+=curArray[i]+",";return resultString=resultString.substr(0,resultString.length-1)}function productTypesFunc(curArray){for(var resultString="",i=0;i<curArray.length;i++)resultString+="0,";return resultString=resultString.substr(0,resultString.length-1)}function motifFramesFunc(curArray){for(var resultString="",i=0;i<curArray.length;i++){for(var tmpStr="",j=0;j<curArray[i].length;j++)for(var z=0;z<motifsList.length;z++)if(curArray[i][j]==motifsList[z].motifId){tmpStr+=motifsList[z].frameCount+",";break}0==curArray[i].length&&(tmpStr+="-1,"),tmpStr=tmpStr.substr(0,tmpStr.length-1),resultString+=tmpStr+"."}return resultString=resultString.substr(0,resultString.length-1)}function getProductionClipIds(){var resultArray=[];1==currentInd.get("isVisible")&&resultArray.push(currentInd.get("clipObj.clipId"));for(var i=0;i<currClipsList.length;i++)resultArray.push(currClipsList[i].clipId);return 1==currentAbd.get("isVisible")&&resultArray.push(currentAbd.get("clipObj.clipId")),resultArray}function checkTimelineFor360(){for(var i=0;i<currClipsList.length;i++)if(128==currClipsList[i].categoryId)return!0;return!1}function getProductionMotifIds(){var resultArray=[];1==currentInd.get("isVisible")&&resultArray.push([]);for(var i=0;i<curMotifsList.length;i++){for(var tmpArr=[],j=0;j<curMotifsList[i].length;j++)tmpArr[j]=curMotifsList[i][j].motifId;resultArray.push(tmpArr)}return 1==currentAbd.get("isVisible")&&resultArray.push([]),resultArray}function groupCommandsToStr(tasksArr){for(var tasksStrArr=[],i=0;i<tasksArr.length;i++)tasksStrArr[i]=tasksArr[i].opObjType+","+tasksArr[i].operType+","+tasksArr[i].grId+","+tasksArr[i].objId;return tasksStrArr.join(".")}function groupAudioCommandsToStr(tasksArr){var tasksStr="",audiosList=audioGrDataSource.data(),tasksStrArr=[];if(tasksArr.length>0){tasksArr=[];for(var i=0;i<audiosList.length;i++)tasksStrArr[i]="accountGroup2audio,add,"+editGroupObj.get("groupId")+","+audiosList[i].audioId;tasksStr=groupOperationsList.length>0?"."+tasksStrArr.join("."):tasksStrArr.join(".")}return tasksStr}function prodGroupsCommandsToStr(tasksArr){var tasksStr="",groupsList=groupProdDataSource.data(),tasksStrArr=[];if(tasksArr.length>0||"addProduct"==editProductObj.get("task")){tasksArr=[];for(var i=0;i<groupsList.length;i++)tasksStrArr[i]="addGroup2Product."+groupsList[i].groupId+"."+editProductObj.get("clipId");tasksStr=editProductObj.get("contentTypes").length>0?","+tasksStrArr.join(","):tasksStrArr.join(",")}return tasksStr}function productCommandsToStr(tasksArr){for(var curArr=$.extend({},tasksArr),i=0;i<curArr.length;i++){var itemStr="addMotif2Product.";itemStr+=curArr[i].motifTypeId+".",itemStr+=editProductObj.get("clipId")+".",itemStr+=curArr[i].canLoop?"1":"0",itemStr+=".",itemStr+=curArr[i].acceptsFilm?"1":"0",itemStr+=".",itemStr+=curArr[i].position+".",itemStr+=curArr[i].loaderName+".",itemStr+=curArr[i].contentType,curArr[i]=itemStr}return curArr.join(",")}function saveProdPopupFunc(){$("#production-save-form #newProdNameInput").val(currentProduction.get("prodObj.name")),$("#production-save-form").submit(function(e){e.preventDefault(),applySaveProdFunc()})}function applySaveProdFunc(){currentProduction.set("prodObj.clips",getProductionClipIds()),currentProduction.set("prodObj.motifs",getProductionMotifIds());var newProdObj={indicatives:+userAccount.get("indicatives"),abdicatives:+userAccount.get("abdicatives"),motifIDs:motifsArrayToString(currentProduction.get("prodObj.motifs")),durationTime:0,formats:[],products:clipsArrayToString(currentProduction.get("prodObj.clips")),user:+userAccount.get("id"),jobName:$("#production-save-form #newProdNameInput").val(),audioParam:1,template:1};userAccount.set("curProduction",newProdObj.jobName),currentProduction.set("prodObj.name",newProdObj.jobName),createSingleProductionFunc(newProdObj,function(){getFilmsByAccount(function(){filmsDataSource.read()})}),curPopupCloseFunc()}function setAllowedCodecs(){for(var allowedList=$.extend([],codecTypes),i=0;i<currClipsList.length;i++)if(currClipsList[i].allowedCodecs){var allowedArr=currClipsList[i].allowedCodecs.split(",");$.each(allowedList,function(idx,item){item.enabled=!1;for(var i=0;i<allowedArr.length;i++)if(item.codec_type_id==allowedArr[i]){item.enabled=!0;break}})}else $.each(allowedList,function(idx,item){item.enabled=!1});return $.each(allowedList,function(i,item){item.tplName=item.name.split(":")[1]+"("+item.extension.slice(1)+")"}),allowedList=sepAndSortCodecs(allowedList)}function produceProdPopupFunc(){codecFormatsObj.set("codecFormatTypes",setAllowedCodecs()),codecFormatsObj.set("audioSelectArr",audioArr),audioArr.length>0?codecFormatsObj.set("productionAudio",audioArr[0].audioId):(codecFormatsObj.set("productionAudio",1),$("#prodAudioSelect").data("kendoDropDownList").enable(!1)),codecFormatsObj.set("codecFormatsArr",[]),codecFormatsObj.set("jobNameField",currentProduction.get("prodObj.name")),codecFormatsObj.set("userEmailField",""),codecFormatsObj.set("isEnabled360format",checkTimelineFor360()),kendo.bind($("#produce-form"),codecFormatsObj),$("[data-role=window]").kendoWindow("center"),$("#produce-form").submit(function(e){e.preventDefault(),toggleBtnStatus($("#produce-prod-popup-button"),!1),applyProduceProdFunc()})}function initProductionAudio(){var audioObj=$.extend(!0,{},audioArr[0]);$("#playCurAudio").attr("src","/data/audio/audio_"+audioObj.audioId+audioObj.extension)}function onSelectProductionAudio(e){for(var item=e.item,selectedVal=item.text(),audioObj={},i=0;i<audioArr.length;i++)audioArr[i].name==selectedVal&&(audioObj=$.extend(!0,{},audioArr[i]));-1!=codecFormatsObj.get("productionAudio")?($("#playCurAudio").removeClass("playing").attr("src","/data/audio/audio_"+audioObj.audioId+audioObj.extension),toggleBtnStatus($("#play-audio-edit-button"),!0)):($("#playCurAudio").removeClass("playing").attr("src",""),toggleBtnStatus($("#play-audio-edit-button"),!1)),$("#play-audio-button").each(function(){$(this).find(".play").css("opacity",1),$(this).find(".stop").css("opacity",0)})}function applyProduceProdFunc(){currentProduction.set("prodObj.clips",getProductionClipIds()),currentProduction.set("prodObj.motifs",getProductionMotifIds());var newProdObj={indicatives:+userAccount.get("indicatives"),abdicatives:+userAccount.get("abdicatives"),companyID:+userAccount.get("groupId"),motifFrames:motifFramesFunc(currentProduction.get("prodObj.motifs")),durations:"",jobName:codecFormatsObj.get("jobNameField").trim(),formats:codecFormatsObj.get("codecFormatsArr").slice(),previewFrames:previewFramesStringFunc(currentProduction.get("prodObj.clips")),motifIDs:motifsArrayToString(currentProduction.get("prodObj.motifs")),specialIntroMusic:0,durationTime:clipsDurationToString(currentProduction.get("prodObj.clips")),status:0,template:0,user:+userAccount.get("id"),audioParam:codecFormatsObj.get("productionAudio"),products:clipsArrayToString(currentProduction.get("prodObj.clips")),productTypes:productTypesFunc(currentProduction.get("prodObj.clips")),email:codecFormatsObj.get("userEmailField")};userAccount.set("curProduction",newProdObj.jobName),currentProduction.set("prodObj.name",newProdObj.jobName),createSingleProductionFunc(newProdObj,function(){userAccount.get("inProduction").push(userAccount.get("lastProdId")),getFilmsByAccount(function(){userAccount.set("productsVal",filmsList.length),checkProductionStatus(),setTimeout(function(){filmsDataSource.read()},500)}),curPopupCloseFunc(function(){setTimeout(function(){shortPopupCallFunct("dialog-popup","produce-dialog-tmp"),toggleBtnStatus($("#produce-prod-popup-button"),!0)},350)})})}function createPreviewProduction(){createSingleProductionFunc({is_preview:1,indicatives:-1,abdicatives:-1,companyID:+userAccount.get("groupId"),motifFrames:1,durations:"",jobName:editProductObj.get("name"),formats:["7"],previewFrames:"",motifIDs:-1,specialIntroMusic:0,durationTime:"0."+editProductObj.get("duration")+".0",status:0,template:0,user:+userAccount.get("id"),audioParam:1,products:editProductObj.get("clipId"),productTypes:"0"},function(){shortPopupCallFunct("dialog-popup","preview-created-tmp")})}function logOutAfterProduce(){curPopupCloseFunc(),logOut()}function goHubAfterProduce(){curPopupCloseFunc(),router.navigate("/hub")}function initStatisticTime(callback){var curTime=Math.floor((new Date).getTime()/1e3),strStartTime=new Date,strEndTime=new Date;strStartTime.setTime(strEndTime.getTime()-2592e6),strStartTime.setSeconds(1),strStartTime.setMinutes(0),
strStartTime.setHours(0),statisticUser.set("userName",userAccount.get("firstName")+" "+userAccount.get("surName")),statisticUser.set("statEndDate",curTime),statisticUser.set("statStartDate",Math.floor(strStartTime.getTime()/1e3)),statisticUser.set("statStartDateString",strStartTime.toLocaleDateString()),statisticUser.set("statEndDateString",strEndTime.toLocaleDateString()),callback&&"function"==typeof callback&&callback()}function initCharts(){ProductionsTableData=new google.visualization.DataTable,ProductionsTableData.addColumn("string",currLang.DROPDOWN_DATE),ProductionsTableData.addColumn("number",currLang.FCPD_FilmsHeader),ProductionsTableData.addColumn("number",currLang.FCPD_ClipsHeader),ProductionsTableData.addRows(ProductionsStatArr),ProductionsView=new google.visualization.DataView(ProductionsTableData),ProductionsView.setColumns([0,1,2]),ProductionsTable=new google.visualization.Table(document.getElementById("ProductionsTable")),ProductionsTable.draw(ProductionsTableData,{showRowNumber:!1});var optionsProductionsChart={width:$("#ProductionsChart").width()-16,height:300,legend:{position:"top",maxLines:10},bar:{groupWidth:"75%"},isStacked:!0,chartArea:{width:"80%",height:"75%"}};ProductionsChart=new google.visualization.ColumnChart(document.getElementById("ProductionsChart")),ProductionsChart.draw(ProductionsTableData,optionsProductionsChart),google.visualization.events.addListener(ProductionsTable,"sort",function(event){ProductionsTableData.sort([{column:event.column,desc:!event.ascending}]),ProductionsChart.draw(ProductionsView,optionsProductionsChart)}),ProductUsageTableData=new google.visualization.DataTable,ProductUsageTableData.addColumn("string",currLang.DROPDOWN_NAME),ProductUsageTableData.addColumn("number",currLang.count),ProductUsageTableData.addRows(ProductUsageStatArr),ProductUsageView=new google.visualization.DataView(ProductUsageTableData),ProductUsageView.setColumns([0,1]),ProductUsageTable=new google.visualization.Table(document.getElementById("ProductUsageTable")),ProductUsageTable.draw(ProductUsageTableData,{showRowNumber:!1});var optionsProductUsageChart={width:$("#ProductUsageChart").width(),height:300,chartArea:{width:"90%",height:"90%"}};ProductUsageChart=new google.visualization.PieChart(document.getElementById("ProductUsageChart")),ProductUsageChart.draw(ProductUsageTableData,optionsProductUsageChart),google.visualization.events.addListener(ProductUsageTable,"sort",function(event){ProductUsageTableData.sort([{column:event.column,desc:!event.ascending}]),ProductUsageChart.draw(ProductUsageView,optionsProductUsageChart)})}function getStatisticsFunc(callback){$.ajax({type:"POST",url:urlGen("getStatistics"),data:{StartDate:+statisticUser.get("statStartDate"),EndDate:+statisticUser.get("statEndDate"),AccountID:+userAccount.get("id")},success:function(data){var dataAssetsArr=0==data.Statistics.AssetCounts.length?[]:data.Statistics.AssetCounts.AssetCount,dataUsagesArr=0==data.Statistics.ProductUsages.length?[]:data.Statistics.ProductUsages.ProductUsage,tmpFilmCount=0,tmpClipCount=0;ProductionsStatArr=[],ProductUsageStatArr=[];for(var i=0;i<dataAssetsArr.length;i++)ProductionsStatArr.push([{v:dataAssetsArr[i].Timestamp,f:dataAssetsArr[i].Date},{v:+dataAssetsArr[i].FilmCount,f:dataAssetsArr[i].FilmCount},{v:+dataAssetsArr[i].ClipCount,f:dataAssetsArr[i].ClipCount}]),tmpFilmCount+=parseInt(dataAssetsArr[i].FilmCount),tmpClipCount+=parseInt(dataAssetsArr[i].ClipCount);for(var i=0;i<dataUsagesArr.length;i++)ProductUsageStatArr.push([dataUsagesArr[i].Name,{v:+dataUsagesArr[i].Count,f:dataUsagesArr[i].Count}]);statisticUser.set("TotalFilmCount",data.Statistics.TotalFilmCount),statisticUser.set("TotalClipCount",data.Statistics.TotalClipCount),statisticUser.set("TimespanFilmCount",tmpFilmCount),statisticUser.set("TimespanClipCount",tmpClipCount),callback&&"function"==typeof callback&&callback()},error:function(data){console.log("can't get statistic")}})}function initDatepickers(){var start=$("#startDate").data("kendoDatePicker"),end=$("#endDate").data("kendoDatePicker");start.max(end.value()),end.min(start.value())}function startDateChange(){var start=$("#startDate").data("kendoDatePicker"),end=$("#endDate").data("kendoDatePicker"),startDate=start.value(),endDate=end.value();startDate?(startDate=new Date(startDate),startDate.setDate(startDate.getDate()),end.min(startDate)):endDate?start.max(new Date(endDate)):(endDate=new Date,start.max(endDate),end.min(endDate))}function endDateChange(){var start=$("#startDate").data("kendoDatePicker"),end=$("#endDate").data("kendoDatePicker"),startDate=start.value(),endDate=end.value();endDate?(endDate=new Date(endDate),endDate.setDate(endDate.getDate()),start.max(endDate)):startDate?end.min(new Date(startDate)):(endDate=new Date,start.max(endDate),end.min(endDate))}function setToday(){var startDate=new Date,endDate=new Date;startDate.setSeconds(1),startDate.setMinutes(0),startDate.setHours(0);var startDatepicker=$("#startDate").data("kendoDatePicker"),endDatepicker=$("#endDate").data("kendoDatePicker");startDatepicker.max(new Date(2100,0,1)),endDatepicker.min(new Date(1999,0,1)),startDatepicker.value(startDate),endDatepicker.value(endDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),statisticUser.set("statEndDateString",endDate.toLocaleDateString())}function setThisMonth(){var startDate=new Date,endDate=new Date;startDate.setSeconds(1),startDate.setMinutes(0),startDate.setHours(0),startDate.setDate(1);var startDatepicker=$("#startDate").data("kendoDatePicker"),endDatepicker=$("#endDate").data("kendoDatePicker");startDatepicker.max(new Date(2100,0,1)),endDatepicker.min(new Date(1999,0,1)),startDatepicker.value(startDate),endDatepicker.value(endDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),statisticUser.set("statEndDateString",endDate.toLocaleDateString())}function setLastMonth(){var startDate=new Date,endDate=new Date;startDate.setSeconds(1),startDate.setMinutes(0),startDate.setHours(0),startDate.setDate(1),startDate.setMonth(endDate.getMonth()-1),endDate.setSeconds(59),endDate.setMinutes(59),endDate.setHours(23),endDate.setDate(0);var startDatepicker=$("#startDate").data("kendoDatePicker"),endDatepicker=$("#endDate").data("kendoDatePicker");startDatepicker.max(new Date(2100,0,1)),endDatepicker.min(new Date(1999,0,1)),startDatepicker.value(startDate),endDatepicker.value(endDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),statisticUser.set("statEndDateString",endDate.toLocaleDateString())}function setThisYear(){var startDate=new Date,endDate=new Date;startDate.setSeconds(1),startDate.setMinutes(0),startDate.setHours(0),startDate.setDate(1),startDate.setMonth(0);var startDatepicker=$("#startDate").data("kendoDatePicker"),endDatepicker=$("#endDate").data("kendoDatePicker");startDatepicker.max(new Date(2100,0,1)),endDatepicker.min(new Date(1999,0,1)),startDatepicker.value(startDate),endDatepicker.value(endDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),statisticUser.set("statEndDateString",endDate.toLocaleDateString())}function setLastYear(){var startDate=new Date,endDate=new Date;startDate.setSeconds(1),startDate.setMinutes(0),startDate.setHours(0),startDate.setDate(1),startDate.setMonth(0),startDate.setFullYear(endDate.getFullYear()-1),endDate.setSeconds(59),endDate.setMinutes(59),endDate.setHours(23),endDate.setDate(1),endDate.setMonth(0);var startDatepicker=$("#startDate").data("kendoDatePicker"),endDatepicker=$("#endDate").data("kendoDatePicker");startDatepicker.max(new Date(2100,0,1)),endDatepicker.min(new Date(1999,0,1)),startDatepicker.value(startDate),endDatepicker.value(endDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),statisticUser.set("statEndDateString",endDate.toLocaleDateString())}function setTimespan(){var start=$("#startDate").data("kendoDatePicker"),end=$("#endDate").data("kendoDatePicker"),startDate=start.value(),endDate=end.value();startDate&&endDate?(startDate=new Date(startDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),startDate=Math.floor(startDate.getTime()/1e3),endDate=new Date(endDate),statisticUser.set("statEndDateString",endDate.toLocaleDateString()),endDate=Math.floor(endDate.getTime()/1e3)+86399,statisticUser.set("statStartDate",startDate),statisticUser.set("statEndDate",endDate),getStatisticsFunc(function(){initCharts(),curPopupCloseFunc()})):alert("Enter both values")}function exportStatistics(){function genProductionCsv(){var resultString="",clipsArr=[],motifsArr=[];clipsArr=prodStringToArray(curProdItem.products).slice(),motifsArr=stringToArray(curProdItem.motifs).slice(),resultString+=curProdItem.crDate+";"+curProdItem.name+";"+userAccount.get("surName")+";\n";for(var i=0;i<clipsArr.length;i++){resultString+=";;;"+(i+1)+";";for(var j=0;j<ProductList.length;j++){if(clipsArr[i]==ProductList[j].clipId){resultString+=ProductList[j].name+";\n";break}j==ProductList.length-1&&(resultString+=clipsArr[i]+" was deleted;\n")}for(var j=0;j<motifsArr[i].length;j++){if(-1==motifsArr[i][j]){resultString+=";;;;;Indicativ;\n";break}resultString+=";;;;;"+(j+1)+";";for(var z=0;z<motifsContentTypeList.length;z++)if(clipsArr[i]==motifsContentTypeList[z].productID&&j+1==motifsContentTypeList[z].position){resultString+=motifsContentTypeList[z].name+";";break}for(var z=0;z<motifsList.length;z++){if(motifsArr[i][j]==motifsList[z].motifId){resultString+=motifsList[z].name+";\n";break}z==motifsList.length-1&&(resultString+=motifsArr[i][j]+" was deleted;\n")}}}return resultString}var csvContent="",curDate=new Date,startDate=new Date(1e3*statisticUser.get("statStartDate")),endDate=new Date(1e3*statisticUser.get("statEndDate"));crStatProdictionsIdArr(statisticUser.get("statStartDate"),statisticUser.get("statEndDate")),csvContent+="Report date:;",csvContent+=curDate.toLocaleDateString()+" - "+curDate.toLocaleTimeString()+";",csvContent+="Date Range:"+startDate.toLocaleDateString()+" - "+startDate.toLocaleTimeString()+" to "+endDate.toLocaleDateString()+" - "+endDate.toLocaleTimeString()+";\n\n",csvContent+="Total Films;Total Clips;\n"+statisticUser.get("TotalFilmCount")+";"+statisticUser.get("TotalClipCount")+";\n",csvContent+="Films in date range;Clips in date range;\n"+statisticUser.get("TimespanFilmCount")+";"+statisticUser.get("TimespanClipCount")+";\n",csvContent+="Production Date;Production Name;Account Name;Clip Counter;Clip Name;Motif Counter;Motif Type;Motif Name;\n";for(var i=0;i<prodCrTimeArr.length;i++){for(var curProdItem={},resultString="",j=0;j<filmsList.length;j++)if(prodCrTimeArr[i]==filmsList[j].crTime){var curProdItem=$.extend(!0,{},filmsList[j]);resultString=genProductionCsv();break}csvContent+=resultString}csvContent+="\nProduct;nClipS;\n";for(var i=0;i<ProductUsageStatArr.length;i++)csvContent+=ProductUsageStatArr[i][0]+";"+ProductUsageStatArr[i][1].v+";\n";var encodedUri=encodeURIComponent(csvContent),$link=$("#dataLink");$link.attr("href","data:Application/octet-stream,"+encodedUri),$link.attr("download","joblog_"+userAccount.get("id")+".csv"),$link[0].click()}function crStatProdictionsIdArr(startTime,endTime){prodCrTimeArr=[];for(var startPos=0,endPos=0,j=0;j<filmsList.length;j++)filmsList[j].duration>0&&prodCrTimeArr.push(+filmsList[j].crTime);prodCrTimeArr.sort();for(var j=0;j<prodCrTimeArr.length;j++)startTime>prodCrTimeArr[j]&&++startPos,endTime>=prodCrTimeArr[j]&&++endPos;prodCrTimeArr.splice(endPos,prodCrTimeArr.length),prodCrTimeArr.splice(0,startPos)}function initSortingSelects(){clipsLocArr=[];for(var locArr=[],i=0;i<ProductList.length;i++)locArr.push(ProductList[i].location);clipsLocArr.push("All");for(var i=0;i<locArr.length;i++){for(var counter=0,j=0;j<clipsLocArr.length&&locArr[i]!=clipsLocArr[j];j++)counter++;counter==clipsLocArr.length&&clipsLocArr.push(locArr[i])}motifsTypeNamArr=[];for(var nameArr=[],i=0;i<motifsContentTypeList.length;i++)nameArr.push(motifsContentTypeList[i].name);motifsTypeNamArr.push("All");for(var i=0;i<nameArr.length;i++){for(var counter=0,j=0;j<motifsTypeNamArr.length&&nameArr[i]!=motifsTypeNamArr[j];j++)counter++;counter==motifsTypeNamArr.length&&motifsTypeNamArr.push(nameArr[i])}var clipsSortingField=[{text:currLang.DROPDOWN_DEFAULT,value:"id"},{text:currLang.DROPDOWN_NAME,value:"name"}],clipTypesField=[{text:currLang.All,value:"All"}];$.each(clipFormats,function(i,item){clipTypesField.push({text:item.name,value:item.product_type_id})}),clipsFilterModel=kendo.observable({clipTypesArr:clipTypesField,locationArr:clipsLocArr,motifNamesArr:motifsTypeNamArr,sortSelect:clipsSortingField}),kendo.bind($("#clips-filter"),clipsFilterModel);var sortingFields=[{text:currLang.DROPDOWN_DATE,value:"crTime"},{text:currLang.DROPDOWN_NAME,value:"name"}];motifFilterModel=kendo.observable({selectFields:sortingFields}),filmFilterModel=kendo.observable({selectFields:sortingFields})}function getAccountList(callback){$.ajax({type:"GET",url:urlGen("getAccountList"),cache:!1,success:function(data){var dataArr=data.Accounts.Account;accountsArr=[];for(var i=0;i<dataArr.length;i++){for(var curObj={accId:parseInt(dataArr[i].Id),accountGroupID:parseInt(dataArr[i].AccountGroupID),languageIsoCode:dataArr[i].LanguageIsoCode,loginUsername:dataArr[i].LoginUsername,name:dataArr[i].Name,lastName:dataArr[i].LastName,email:dataArr[i].Email,isActive:parseInt(dataArr[i].IsActive),multilogin:parseInt(dataArr[i].multilogin),quota:parseInt(dataArr[i].Quota),budget:parseInt(dataArr[i].Budget)},j=0;j<groupArr.length;j++)if(curObj.accountGroupID==groupArr[j].groupId){curObj.accountGroupName=groupArr[j].name;break}accountsArr.push(curObj)}accountsDataSource.read(),loadingInc(++progressVal),callback&&"function"==typeof callback&&callback()}})}function getAccountGroupList(callback){$.ajax({type:"GET",url:urlGen("getAccountGroupList"),cache:!1,success:function(data){var dataArr=data.AccountGroups.AccountGroup;groupArr=[];for(var i=0;i<dataArr.length;i++)groupArr.push({groupId:dataArr[i].ID,name:dataArr[i].Name,indicative:dataArr[i].Indicative,abdicative:dataArr[i].Abdicative,description:dataArr[i].Description,onlinethreesixty:dataArr[i].onlinethreesixty,groupCustomField:"",groupCustomObligate:0});groupsDataSource.read(),loadingInc(++progressVal),callback&&"function"==typeof callback&&callback()}})}function getProductGroupList(callback){$.ajax({type:"GET",url:urlGen("getProductGroupList"),cache:!1,success:function(data){var dataArr=data.ProductGroups.ProductGroup;prodGroups=[];for(var i=0;i<dataArr.length;i++)prodGroups.push({categoryId:parseInt(dataArr[i].ID),productGroupParentID:dataArr[i].ProductGroupParentID,productGroupName:dataArr[i].ProductGroupName});loadingInc(++progressVal),callback&&"function"==typeof callback&&callback()}})}function getAudioList(callback){var dfd=new $.Deferred;return $.ajax({type:"GET",url:urlGen("getAudioList"),cache:!1,success:function(data){var dataArr=data.Audios.Audio;audioArr=[];for(var i=0;i<dataArr.length;i++){for(var groupIDsArr=[],j=0;j<dataArr[i].AccountGroupIDs.length;j++)groupIDsArr.push(parseInt(dataArr[i].AccountGroupIDs[j]));if(1==userAccount.get("groupId")||1!=userAccount.get("groupId")&&$.inArray(userAccount.get("groupId"),groupIDsArr)>-1){var curObj={audioId:parseInt(dataArr[i].ID),name:dataArr[i].Name,mediaFormatID:parseInt(dataArr[i].MediaFormatID),creationTime:parseInt(dataArr[i].CreationTime),accountID:null==dataArr[i].AccountID?0:parseInt(dataArr[i].AccountID),groupIDs:groupIDsArr};if(curObj.accountName="",0!=curObj.accountID)for(var j=0;j<accountsArr.length;j++)if(curObj.accountID==accountsArr[j].accId){curObj.accountName=accountsArr[j].loginUsername;break}for(var j=0;j<fileExtensionsArr.length;j++)if(curObj.mediaFormatID==fileExtensionsArr[j].id){curObj.mediaFormat=fileExtensionsArr[j].name+"("+fileExtensionsArr[j].extension+")",curObj.extension=fileExtensionsArr[j].extension;break}audioArr.push(curObj)}}audioDataSource.read(),dfd.resolve(),loadingInc(++progressVal),callback&&"function"==typeof callback&&callback()}}),dfd.promise()}function getContentFormats(callback){$.ajax({type:"GET",url:urlGen("getContentFormats"),cache:!1,success:function(data){var dataArr=data.ContentFormats.ContentFormat;motifTypesArr=[];for(var i=0,l=dataArr.length;i<l;i++)motifTypesArr.push({motifTypeId:parseInt(dataArr[i].ID),aspect:parseFloat(dataArr[i].Aspect),iconWidth:checkIconWidth(parseFloat(dataArr[i].Aspect)),name:dataArr[i].Name,width:+dataArr[i].width,height:+dataArr[i].height});motifTypeDataSource.read(),loadingInc(++progressVal),callback&&"function"==typeof callback&&callback()}})}function checkIconWidth(aspect){return w=18*aspect<7?7:18*aspect}function getOpenProductionList(callback){$.ajax({type:"POST",url:urlGen("getOpenProductionList"),cache:!1,success:function(data){var dataArr=data.Productions.Production;openProdsArr=[];for(var i=0;i<dataArr.length;i++)openProdsArr.push({prodId:dataArr[i].ID,name:dataArr[i].Name,creationTime:new Date(1e3*parseInt(dataArr[i].CreationTime)),updateTime:new Date(1e3*parseInt(dataArr[i].UpdateTime)),status:dataArr[i].Status,userName:dataArr[i].UserName,priority:dataArr[i].Priority,clipFrameCount:dataArr[i].ClipFrameCount});openedProdsDataSource.read(),callback&&"function"==typeof callback&&callback()}})}function getFinishedProductionList(callback){$.ajax({type:"POST",url:urlGen("getFinishedProductionList"),cache:!1,success:function(data){var dataArr=data.Productions.Production;finishedProdsArr=[];for(var i=0;i<dataArr.length;i++)finishedProdsArr.push({prodId:dataArr[i].ID,name:dataArr[i].Name,creationTime:new Date(1e3*parseInt(dataArr[i].CreationTime)),updateTime:new Date(1e3*parseInt(dataArr[i].UpdateTime)),userName:dataArr[i].UserName,priority:dataArr[i].Priority,clipFrameCount:dataArr[i].ClipFrameCount});finishedProdsDataSource.read(),callback&&"function"==typeof callback&&callback()}})}function updateProductionPriority(callback){$.ajax({type:"POST",url:urlGen("updateProductionPriority"),cache:!1,data:{productionID:openedProdObj.get("prodId"),priority:openedProdObj.get("priority")},success:function(data){callback&&"function"==typeof callback&&callback()}})}function workOnAccount(callback){var accountOperation="";accountOperation=-1==editAccObj.get("accId")?"createAccount":"updateAccount";var accObj={accountGroupId:parseInt(editAccObj.get("groupField")),username:editAccObj.get("usernameField"),firstName:editAccObj.get("firstnameField"),email:editAccObj.get("emailField"),task:accountOperation,is_active:editAccObj.get("accActivField")?1:0,multilogin:editAccObj.get("multilogin")?1:0,language_iso_code:editAccObj.get("languageField"),lastName:editAccObj.get("lastnameField"),quota:editAccObj.get("quotaField"),budget:editAccObj.get("budgetField"),accountId:editAccObj.get("accId")};""!=editAccObj.get("passwordField")&&(accObj.password=editAccObj.get("passwordField")),$.ajax({type:"POST",url:urlGen("workOnAccount"),cache:!1,data:accObj,success:function(data){if("-1"==(data+"").search("ERR_USER_UNIQUE")){var curAccId=data.ID;editAccObj.set("accId",parseInt(curAccId)),getAccountList(),shortPopupCallFunct("dialog-popup","saved-popup-tmp")}else shortPopupCallFunct("dialog-popup","username-popup-tmp");editAccObj.set("isVisible",!1),toggleBtnStatus($("#delete-account-button , #save-account-button"),!1),callback&&"function"==typeof callback&&callback()}})}function deleteByAdmin(prm,id,itemType,callback){$.ajax({type:"POST",url:urlGen("deleteByAdmin"),cache:!1,data:{permanent:prm,itemID:id,targetItem:itemType},success:function(data){callback&&"function"==typeof callback&&callback()}})}function saveAudio(callback){var inputFiles=document.getElementById("audio-input-file").files,audioUploadData=new FormData;audioUploadData.append("mediaFormatID",editAudioObj.get("mediaFormatID")),audioUploadData.append("name",editAudioObj.get("name")),audioUploadData.append("task",editAudioObj.get("task")),"updateAudio"==editAudioObj.get("task")&&audioUploadData.append("audioID",parseInt(editAudioObj.get("audioId"))),inputFiles.length>0?(audioUploadData.append("Filedata",inputFiles[0]),audioUploadData.append("Filename",inputFiles[0].name)):audioUploadData.append("Filename",editAudioObj.get("name")),$("#audio-upload-progressbar").show(100),$.ajax({type:"POST",url:urlGen("uploadAudio"),cache:!1,processData:!1,contentType:!1,data:audioUploadData,xhr:function(){myXhr=$.ajaxSettings.xhr();var motifProgressBar=$("#audio-upload-progressbar").data("kendoProgressBar");return myXhr.upload&&myXhr.upload.addEventListener("progress",function(e){var pc=parseInt(e.loaded/e.total*100);motifProgressBar.value(pc)},!1),myXhr},success:function(data){editAudioObj.set("audioId",parseInt(data.Audio)),router.navigate("/adm-audio"),getAudioList(function(){$("#playCurAudio").removeClass("playing").attr("src","")}),callback&&"function"==typeof callback&&callback()}})}function getProductAssociations(curGroupId,callback){$.ajax({type:"POST",url:urlGen("getProductAssociations"),cache:!1,data:{accountGroupID:parseInt(curGroupId)},success:function(data){var dataArr=data.ProductIDs.ProductID;currGroupProdIds=[];for(var i=0;i<dataArr.length;i++)currGroupProdIds.push(parseInt(dataArr[i]));callback&&"function"==typeof callback&&callback()}})}function getGroupAssociations(curProductId,callback){$.ajax({type:"POST",url:urlGen("getGroupAssociations"),cache:!1,data:{productID:parseInt(curProductId)},success:function(data){var dataArr=data.AccountGroupIDs.AccountGroupID;currProdGroupIds=[];for(var i=0;i<dataArr.length;i++)currProdGroupIds.push(parseInt(dataArr[i]));callback&&"function"==typeof callback&&callback()}})}function workOnAccountGroup(callback){$.ajax({type:"POST",url:urlGen("workOnAccountGroup"),cache:!1,data:{accountGroupID:editGroupObj.get("groupId"),groupName:editGroupObj.get("name"),groupIndicative:isNaN(editGroupObj.get("indicative"))?-1:editGroupObj.get("indicative"),groupAbdicative:isNaN(editGroupObj.get("abdicative"))?-1:editGroupObj.get("abdicative"),groupDescription:editGroupObj.get("description"),groupCustom:editGroupObj.get("groupCustomField"),associationTasks:groupCommandsToStr(groupOperationsList)+groupAudioCommandsToStr(groupAudioOperationsList),task:-1==editGroupObj.get("groupId")?"createAccountGroup":"updateAccountGroup",groupCustomObligate:editGroupObj.get("groupCustomObligate"),onlinethreesixty:editGroupObj.get("onlinethreesixty")?1:0},success:function(data){-1==editGroupObj.get("groupId")&&editGroupObj.set("groupId",parseInt(data.ID)),getAccountGroupList(function(){getProductGroupList(),getContentFormats(),getAccountList(),getAudioList(),tempGroupUID="",curPopupCloseFunc()}),editGroupObj.set("isVisible",!1),toggleBtnStatus($("#delete-group-button , #save-group-button"),!1),callback&&"function"==typeof callback&&callback()}})}function workOnContentFormat(callback){$.ajax({type:"POST",url:urlGen("workOnContentFormat"),cache:!1,data:{contentFormatID:editMotifTypeObj.get("motifTypeId"),contentFormatName:editMotifTypeObj.get("name"),contentFormatAspect:editMotifTypeObj.get("aspect"),task:-1==editMotifTypeObj.get("motifTypeId")?"createContentFormat":"updateContentFormat",width:editMotifTypeObj.get("width"),height:editMotifTypeObj.get("height")},success:function(data){-1==editMotifTypeObj.get("motifTypeId")&&null!=data&&editMotifTypeObj.set("motifTypeId",parseInt(data.ContentFormatID)),router.navigate("/adm-motif-types"),getContentFormats(),callback&&"function"==typeof callback&&callback()}})}function checkProductID(callback){function checkAndAdd(){$.ajax({type:"POST",url:urlGen("checkProductID"),cache:!1,data:{newProductID:editProductObj.get("clipId")},success:function(data){var existProdIdCnt=parseInt(data.Result.Count);existProdIdCnt>0?shortPopupCallFunct("dialog-popup","product-id-popup-tmp",function(){$("#curr-adm-product-id").html(editProductObj.get("clipId"))}):0==existProdIdCnt&&workOnProduct(function(){getProductListByAccount(function(){getDicativesByAccount(function(){getContentTypeListByAccount(function(){countClipMotifs()})})})}),callback&&"function"==typeof callback&&callback()}})}"updateProduct"==editProductObj.get("task")&&editProductObj.get("clipId")==editProductObj.get("selectedClipId")?workOnProduct(function(){getProductListByAccount(function(){getDicativesByAccount(function(){getContentTypeListByAccount(function(){countClipMotifs()})})})}):"addProduct"==editProductObj.get("task")?checkAndAdd():editProductObj.get("clipId")!=editProductObj.get("selectedClipId")?(console.log("changed ID for selected product"),editProductObj.set("task","addProduct"),checkAndAdd()):console.log("no such task")}function workOnProduct(callback){$.ajax({type:"POST",url:urlGen("workOnProduct"),cache:!1,data:{productID:parseInt(editProductObj.get("clipId")),productName:editProductObj.get("name"),productFrameCount:parseInt(editProductObj.get("duration")),productPreviewFrame:parseInt(editProductObj.get("previewFrame")),productCategoryID:editProductObj.get("categoryId"),productLocation:editProductObj.get("location"),productDescription:editProductObj.get("description"),is_dicative:5e3==editProductObj.get("categoryId")||5001==editProductObj.get("categoryId")?1:0,task:editProductObj.get("task"),commands:productCommandsToStr(editProductObj.get("contentTypes"))+prodGroupsCommandsToStr(prodGroupsOperationsList),productType:parseInt(editProductObj.get("productType")),codecType:editProductObj.get("allowedCodecs").slice(),resolution:editProductObj.get("resolution"),can_reformat:1==editProductObj.get("can_reformat")?1:0,MasterProductId:editProductObj.get("master_ID"),InFrame:editProductObj.get("inFrame"),OutFrame:editProductObj.get("outFrame")},success:function(data){editProductObj.set("isVisible",!1),toggleBtnStatus($("#delete-adm-product-button , #save-adm-product-button"),!1),callback&&"function"==typeof callback&&callback()}})}function loginCheckFunc(e){e.preventDefault(),$("#login-form #username").val().length>0&&$("#login-form #password").val().length>0?loginFunc():$("#login-form .error-empty-msg").fadeIn(300).delay(5e3).fadeOut(700)}function onSelectFilterMotifs(e){var dataItem=this.dataItem(e.item),sortingDirection="asc";"crTime"==dataItem.value&&(sortingDirection="desc"),motifsDataSource.query({sort:[{field:dataItem.value,dir:sortingDirection}]}),bindEnterFunc($("#applyMotifBtn"),!1),toggleBtnStatus($("#applyMotifPreviewBtn"),!1),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)}function motifListViewChangeFunc(){toggleBtnStatus(deleteMotifBtn,!0),toggleBtnStatus(applyMotifBtn,!0),toggleBtnStatus($("#applyMotifPreviewBtn"),!0);var data=this.dataSource.view();selectedMotifUid=$.map(this.select(),function(item){return data[$(item).index()].uid}),selectedMotifId=$.map(this.select(),function(item){return data[$(item).index()].motifId}),$("#applyMotifBtn").parent(".visible").length&&this.select().length>0&&bindEnterFunc($("#applyMotifBtn"),!0)}function apllyDeleteMotifFunc(){for(var i=0;i<selectedMotifUid.length;i++){var curDelItem=motifsDataSource.getByUid(selectedMotifUid[i]);motifsDataSource.remove(curDelItem),i!=selectedMotifUid.length-1?deleteMotifFunc(selectedMotifId[i]):deleteMotifFunc(selectedMotifId[i],function(){getMotifListByAccount()})}curPopupCloseFunc(),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)}function deleteMotifPopupFunc(){$("#curr-motif-name").length&&(1==selectedMotifUid.length?$("#curr-motif-name").text(motifsDataSource.getByUid(selectedMotifUid[0]).name+" "+currLang.MOTIF_SINGLEsm):selectedMotifUid.length>1&&$("#curr-motif-name").text(selectedMotifUid.length+" "+currLang.MOTIF_MULTIPLEsm))}function uploadMotifPopupFunc(){$("#motif-upload-form .img-wr p").show(),$("#saveMotifBtn").data("kendoButton").enable(!1),$("#upload-input").attr("accept",motifUploadAcceptStr),$("#motif-upload-form").submit(function(e){e.preventDefault(),applySaveMotifFunc()}),setTimeout(function(){$("#upload-input").on("change",function(){uploadMotifFunc(this.files[0],function(){$("#newMotifName").trigger("focus")})})},200)}function applySaveMotifFunc(){saveMotifFunc(),curPopupCloseFunc()}function searchMotifFunc(){searchVal=$("#motif-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(motifsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#motif-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(motifsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#motif-search-clear").addClass("hidden")),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)}function initMotifSearch(){searchVal=$("#motif-search-field").val(),prevSearchVal=searchVal,$("#motif-search-field")&&$("#motif-search-field").on("keyup",this,function(){searchMotifFunc()})}function clearMotifsFilter(){motifsDataSource.query({filter:{field:"name",operator:"contains",value:""}}),$("#motif-search-clear").addClass("hidden"),$("#motif-search-field").val(""),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)}function filmsListViewChangeFunc(){toggleBtnStatus(filmsBtnsToDisable,!0);var data=this.dataSource.view();if(selectedFilmUid=$.map(this.select(),function(item){return data[$(item).index()].uid}),selectedFilmId=$.map(this.select(),function(item){return data[$(item).index()].filmId}),null!=selectedFilmUid&&1==selectedFilmUid.length){var filmTmp=filmsDataSource.getByUid(selectedFilmUid[0]);void 0===filmTmp.videoFiles||null===filmTmp.videoFiles?toggleBtnStatus($("#downloadFilm"),!1):0==filmTmp.videoSizes.length&&toggleBtnStatus($("#downloadFilm"),!1)}selectedFilmUid.length>1&&(toggleBtnStatus($("#loadFilm"),!1),toggleBtnStatus($("#downloadFilm"),!1)),$(".html5lightbox-link").html5lightbox()}function onSelectFilterFilms(e){var dataItem=this.dataItem(e.item),sortingDirection="asc";"crTime"==dataItem.value&&(sortingDirection="desc"),filmsDataSource.query({sort:[{field:dataItem.value,dir:sortingDirection}]}),toggleBtnStatus(filmsBtnsToDisable,!0)}function applyDeleteFilmFunc(){for(var i=0;i<selectedFilmUid.length;i++){var curDelItem=filmsDataSource.getByUid(selectedFilmUid[i]);filmsDataSource.remove(curDelItem),deleteFilmFunc(selectedFilmId[i])}curPopupCloseFunc(),toggleBtnStatus(filmsBtnsToDisable,!1)}function deleteFilmPopupFunc(){$("#curr-film-name").length&&(1==selectedFilmUid.length?$("#curr-film-name").text(currLang.PRODUCTION_SINGLE+" "+filmsDataSource.getByUid(selectedFilmUid[0]).name):selectedFilmUid.length>1&&$("#curr-film-name").text(selectedFilmUid.length+" "+currLang.PRODUCTION_MULTIPLE))}function downloadFilmPopupFunc(){var downloadList=$(".download-list"),listContent="",curFilm=filmsDataSource.getByUid(selectedFilmUid),lastname="";if(downloadList.length){if(curFilm.crTime<1497884400)if("none"!=curFilm.videoFiles[0][0]&&curFilm.urlHash)for(var i=0;i<curFilm.videoFiles.length;i++){var href="/"+curFilm.urlHash+"/film_"+curFilm.filmId+"_"+curFilm.videoFiles[i][1]+"."+curFilm.videoFiles[i][0],name=curFilm.name+"_"+curFilm.videoFiles[i][1],label=curFilm.name+"_"+curFilm.videoFiles[i][1]+"."+curFilm.videoFiles[i][0]+" - "+curFilm.videoFiles[i][2]+" MB",videoUrl=window.location.protocol+"//film."+window.location.host.replace("www.","")+"/download.php?name="+encodeURIComponent(name)+"&href="+encodeURIComponent(href)+"&label="+encodeURIComponent(label);listContent+='<li><iframe src="'+videoUrl+'" frameborder="0"></iframe></li>',i==curFilm.videoFiles.length-1&&(lastname=label+" WWWWWWW")}else listContent+="<li>Unfortunately we don't support so old film productions, please produce your films again.</li>";else if(curFilm.formats.length){for(var i=0;i<curFilm.formats.length;i++)if("20"==curFilm.formats[i]){var href=window.location.protocol+"//film."+window.location.host.replace("www.","")+"/krpano/index.php?xml=videopano.xml?p="+curFilm.urlHash+":"+curFilm.filmId,text=currLang.Open360Viewer;listContent+='<li><a href="'+href+'" target="_blank">'+text+"</a></li>"}else{var curCodec=$.grep(codecTypes,function(item,j){return curFilm.formats[i]==item.codec_type_id
})[0],href="/"+curFilm.urlHash+"/film_"+curFilm.filmId+"_"+curCodec.codec_type_id+curCodec.extension,name=curFilm.name+"_"+curCodec.resName,label=curFilm.name+"_"+curCodec.resName+curCodec.extension+" - "+(parseInt(curFilm.videoSizes[i])/1048576).toFixed(2)+" MB",videoUrl=window.location.protocol+"//film."+window.location.host.replace("www.","")+"/download.php?name="+encodeURIComponent(name)+"&href="+encodeURIComponent(href)+"&label="+encodeURIComponent(label);listContent+='<li><iframe src="'+videoUrl+'" frameborder="0"></iframe></li>',i==curFilm.videoFiles.length-1&&(lastname=label+" WWWWWWW")}listContent+='<li style="height:0;margin:0;overflow:hidden;"><a>'+lastname+"</a></li>"}if(curFilm.urlHash){$("#download-page-link").attr("href",window.location.protocol+"//film."+window.location.host.replace("www.","")+"/index.php?film="+curFilm.urlHash);var remainsDate=new Date(parseInt(curFilm.crTime+"000"));remainsDate.setDate(remainsDate.getDate()+30),$("#download-page-term").text(remainsDate.toLocaleDateString())}else $("#download-page-link").parent().hide();$(downloadList).html(listContent)}else $(downloadList).html("<li>This production is not yet sent to produce</li>")}function loadProdDialogFunc(){var curItem=filmsDataSource.getByUid(selectedFilmUid);console.log("----/current film/----"),$("#curr-film-name").text(curItem.name)}function loadProdFunc(){var curItem=filmsDataSource.getByUid(selectedFilmUid),clipIDsArr=prodStringToArray(curItem.products),motifIDsArr=stringToArray(curItem.motifs);clipIDsArr[0]==userAccount.get("indicatives")&&(clipIDsArr=clipIDsArr.slice(1),motifIDsArr=motifIDsArr.slice(1)),clipIDsArr[clipIDsArr.length-1]==userAccount.get("abdicatives")&&(clipIDsArr=clipIDsArr.slice(0,-1),motifIDsArr=motifIDsArr.slice(0,-1)),currentProduction.set("prodObj.name",curItem.name),currentProduction.set("prodObj.durTime",curItem.durTime),currentProduction.set("prodObj.clips",clipIDsArr),currentProduction.set("prodObj.motifs",motifIDsArr),userAccount.set("curProduction",curItem.name),curPopupCloseFunc(),router.navigate("/production"),productionManageFunc(!1,function(){currClipMotifsList=[],populateProdMotifsArr(function(){currentProdMotifsDataSource.read(),currentProdClipsDataSource.read(),recalcProductionTime(),toggleBtnStatus(productionBtnsToDisable,!0),toggleBtnStatus(fillBtn,!0),toggleBtnStatus(productionInsertBtns,!0),$(".html5lightbox-link").html5lightbox()})})}function newProdDialogFunc(){console.log("NEW PRODUCTION"),currentProduction.set("prodObj",defProductionParams),userAccount.set("curProduction",defProductionParams.name),curPopupCloseFunc(),router.navigate("/production"),toggleBtnStatus(productionInsertBtns,!0),productionManageFunc(!0,function(){currClipMotifsList=[],currMotifTypesList=[],$("#fillAllModeBtn").hasClass("active")&&$("#fillAllModeBtn").click(),populateProdMotifsArr(function(){checkEmptyMotifs(),currentProdMotifsDataSource.read(),currentProdClipsDataSource.read(),toggleBtnStatus(productionBtnsToDisable,!1),toggleBtnStatus(fillBtn,!1),toggleBtnStatus(productionProduceBtn,!1)})})}function searchFilmFunc(){searchVal=$("#film-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(filmsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#film-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(filmsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#film-search-clear").removeClass("hidden")),toggleBtnStatus(filmsBtnsToDisable,!1)}function initFilmsSearch(){searchVal=$("#film-search-field").val(),prevSearchVal=searchVal,$("#film-search-field")&&$("#film-search-field").on("keyup",this,function(){searchFilmFunc()})}function clearFilmsFilter(){filmsDataSource.query({filter:{field:"name",operator:"contains",value:""}}),$("#film-search-clear").addClass("hidden"),$("#film-search-field").val(""),toggleBtnStatus(filmsBtnsToDisable,!1)}function clipsListViewChangeFunc(){toggleBtnStatus(applyClipBtn,!0);var data=this.dataSource.view();selectedProductUid=$.map(this.select(),function(item){return data[$(item).index()].uid}),selectedProductId=$.map(this.select(),function(item){return data[$(item).index()].clipId}),$(".html5lightbox-link").html5lightbox(),this.select().length>0&&bindEnterFunc($("#applyClipBtn"),!0)}function exclude360clips(){var filter360={field:"categoryId",operator:"gt",value:0};return(currClipsList.length>1||1==currClipsList.length&&128!=currClipsList[0].categoryId)&&(filter360={field:"categoryId",operator:"neq",value:128}),filter360}function stillTypeFilter(){var filterStillTypeProduction={field:"categoryId",operator:"gt",value:0};return currClipsList.length&&!location.hash.includes("replace")&&(filterStillTypeProduction={field:"productType",operator:"eq",value:"2"},2!=currClipsList[0].productType&&(filterStillTypeProduction.operator="neq")),filterStillTypeProduction}function onSelectFilterClips0(e){var select0field,select1field,select2field,select0val=e.sender.dataItem(e.item).value,select1val=$("#filterClipsSelect1").data("kendoDropDownList").value(),select2val=$("#filterClipsSelect2").data("kendoDropDownList").value(),select3val=$("#filterClipsSelect3").data("kendoDropDownList").value(),searchField={field:"name",operator:"contains",value:$("#clip-search-field").val()};select0field="All"!=select0val?{field:"productType",operator:"eq",value:select0val}:{field:"productType",operator:"neq",value:select0val},select1field="All"!=select1val?{field:"location",operator:"eq",value:select1val}:{field:"location",operator:"neq",value:select1val},select2field="All"!=select2val?{field:"motifNamesString",operator:"contains",value:select2val}:{field:"motifNamesString",operator:"neq",value:select2val},clipsDataSource.query({filter:{logic:"and",filters:[select0field,select1field,select2field,searchField,exclude360clips(),stillTypeFilter()]},sort:[{field:select3val,dir:"asc"}]}),toggleBtnStatus(applyClipBtn,!1)}function onSelectFilterClips1(e){var select0field,select1field,select2field,select0val=$("#filterClipsSelect0").data("kendoDropDownList").value(),select1val=e.item.text(),select2val=$("#filterClipsSelect2").data("kendoDropDownList").value(),select3val=$("#filterClipsSelect3").data("kendoDropDownList").value(),searchField={field:"name",operator:"contains",value:$("#clip-search-field").val()};select0field="All"!=select0val?{field:"productType",operator:"eq",value:select0val}:{field:"productType",operator:"neq",value:select0val},select1field="All"!=select1val?{field:"location",operator:"eq",value:select1val}:{field:"location",operator:"neq",value:select1val},select2field="All"!=select2val?{field:"motifNamesString",operator:"contains",value:select2val}:{field:"motifNamesString",operator:"neq",value:select2val},clipsDataSource.query({filter:{logic:"and",filters:[select0field,select1field,select2field,searchField,exclude360clips(),stillTypeFilter()]},sort:[{field:select3val,dir:"asc"}]}),toggleBtnStatus(applyClipBtn,!1)}function onSelectFilterClips2(e){var select0field,select1field,select2field,select0val=$("#filterClipsSelect0").data("kendoDropDownList").value(),select1val=$("#filterClipsSelect1").data("kendoDropDownList").value(),select2val=e.item.text(),select3val=$("#filterClipsSelect3").data("kendoDropDownList").value(),searchField={field:"name",operator:"contains",value:$("#clip-search-field").val()};select0field="All"!=select0val?{field:"productType",operator:"eq",value:select0val}:{field:"productType",operator:"neq",value:select0val},select1field="All"!=select1val?{field:"location",operator:"eq",value:select1val}:{field:"location",operator:"neq",value:select1val},select2field="All"!=select2val?{field:"motifNamesString",operator:"contains",value:select2val}:{field:"motifNamesString",operator:"neq",value:select2val},clipsDataSource.query({filter:{logic:"and",filters:[select0field,select1field,select2field,searchField,exclude360clips(),stillTypeFilter()]},sort:[{field:select3val,dir:"asc"}]}),toggleBtnStatus(applyClipBtn,!1)}function onSelectFilterClips3(e){var select1field,select2field,select0val=$("#filterClipsSelect0").data("kendoDropDownList").value(),select1val=$("#filterClipsSelect1").data("kendoDropDownList").value(),select2val=$("#filterClipsSelect2").data("kendoDropDownList").value(),dataItem=this.dataItem(e.item),searchField={field:"name",operator:"contains",value:$("#clip-search-field").val()};select0field="All"!=select0val?{field:"productType",operator:"eq",value:select0val}:{field:"productType",operator:"neq",value:select0val},select1field="All"!=select1val?{field:"location",operator:"eq",value:select1val}:{field:"location",operator:"neq",value:select1val},select2field="All"!=select2val?{field:"motifNamesString",operator:"contains",value:select2val}:{field:"motifNamesString",operator:"neq",value:select2val},clipsDataSource.query({filter:{logic:"and",filters:[select0field,select1field,select2field,searchField,exclude360clips(),stillTypeFilter()]},sort:[{field:dataItem.value,dir:"asc"}]}),toggleBtnStatus(applyClipBtn,!1)}function searchClipFunc(){var select0field,select1field,select2field,select0val=$("#filterClipsSelect0").data("kendoDropDownList").value(),select1val=$("#filterClipsSelect1").data("kendoDropDownList").value(),select2val=$("#filterClipsSelect2").data("kendoDropDownList").value(),select3val=$("#filterClipsSelect3").data("kendoDropDownList").value();select0field="All"!=select0val?{field:"productType",operator:"eq",value:select0val}:{field:"productType",operator:"neq",value:select0val},select1field="All"!=select1val?{field:"location",operator:"eq",value:select1val}:{field:"location",operator:"neq",value:select1val},select2field="All"!=select2val?{field:"motifNamesString",operator:"contains",value:select2val}:{field:"motifNamesString",operator:"neq",value:select2val},searchVal=$("#clip-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(clipsDataSource.query({filter:{logic:"and",filters:[select0field,select1field,select2field,{field:"name",operator:"contains",value:searchVal},exclude360clips(),stillTypeFilter()]},sort:[{field:select3val,dir:"asc"}]}),prevSearchVal=searchVal,$("#clip-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(clipsDataSource.query({filter:{logic:"and",filters:[select0field,select1field,select2field,{field:"name",operator:"contains",value:searchVal},exclude360clips(),stillTypeFilter()]},sort:[{field:select3val,dir:"asc"}]}),prevSearchVal=searchVal,$("#clip-search-clear").removeClass("hidden")),toggleBtnStatus(applyClipBtn,!1)}function initClipsSearch(){searchVal=$("#clip-search-field").val(),prevSearchVal=searchVal,$("#clip-search-field")&&$("#clip-search-field").on("keyup",this,function(){searchClipFunc()})}function clearClipsFilter(){var select0field,select1field,select2field,select0val=$("#filterClipsSelect0").data("kendoDropDownList").value(),select1val=$("#filterClipsSelect1").data("kendoDropDownList").value(),select2val=$("#filterClipsSelect2").data("kendoDropDownList").value(),select3val=$("#filterClipsSelect3").data("kendoDropDownList").value();select0field="All"!=select0val?{field:"productType",operator:"eq",value:select0val}:{field:"productType",operator:"neq",value:select0val},select1field="All"!=select1val?{field:"location",operator:"eq",value:select1val}:{field:"location",operator:"neq",value:select1val},select2field="All"!=select2val?{field:"motifNamesString",operator:"contains",value:select2val}:{field:"motifNamesString",operator:"neq",value:select2val},clipsDataSource.query({filter:{logic:"and",filters:[select0field,select1field,select2field,{field:"name",operator:"contains",value:""},exclude360clips(),stillTypeFilter()]},sort:[{field:select3val,dir:"asc"}]}),$("#clip-search-clear").addClass("hidden"),$("#clip-search-field").val(""),toggleBtnStatus(applyClipBtn,!1)}function clearClipsAllFilters(){$("#clip-search-clear").addClass("hidden"),$("#clip-search-field").val(""),$("#filterClipsSelect0").data("kendoDropDownList").select(0),$("#filterClipsSelect1").data("kendoDropDownList").select(0),$("#filterClipsSelect2").data("kendoDropDownList").select(0);var select3=$("#filterClipsSelect3").data("kendoDropDownList");select3.select(0),select3.trigger("change"),select3.trigger("select"),toggleBtnStatus(applyClipBtn,!1)}function productionManageFunc(newFlag,callback){if(currClipsIds=$.extend(!0,{},currentProduction.get("prodObj.clips")),curMotifsList=$.extend(!0,{},currentProduction.get("prodObj.motifs")),currClipsList=[],currClipMotifsList=[],currentProdMotifsDataSource.read(),newFlag&&-1!=userAccount.get("indicatives")){currClipsIds.splice(0,1),curMotifsList.splice(0,1);for(var currClip,i=0;i<ProductList.length;i++)if(ProductList[i].clipId==userAccount.get("indicatives")){currClip=$.extend(!0,{},ProductList[i]),currClip.locked="Intro",currentInd.set("clipObj",currClip),currentInd.set("isVisible",!0),currentInd.set("imgSrc","/data/products/"+currClip.idString+"/"+currClip.idString+"_mdpi.jpg"),currentInd.set("videoSrc","/data/products/"+currClip.idString+"/"+currClip.idString+"_hdpi.mp4");break}}if(newFlag&&-1!=userAccount.get("abdicatives")){currClipsIds.splice(-1,1),curMotifsList.splice(-1,1);for(var currClip,i=0;i<ProductList.length;i++)if(ProductList[i].clipId==userAccount.get("abdicatives")){currClip=$.extend(!0,{},ProductList[i]),currClip.locked="Outro",currentAbd.set("clipObj",currClip),currentAbd.set("isVisible",!0),currentAbd.set("imgSrc","/data/products/"+currClip.idString+"/"+currClip.idString+"_mdpi.jpg"),currentAbd.set("videoSrc","/data/products/"+currClip.idString+"/"+currClip.idString+"_hdpi.mp4");break}}if(currClipsIds.length>0)for(var i=0;i<currClipsIds.length;i++){for(var j=0;j<ProductList.length;j++)if(ProductList[j].clipId==currClipsIds[i]){currClipsList[i]=$.extend(!0,{},ProductList[j]),currClipsList[i].emptyMotifs=0;break}void 0===currClipsList[i]&&(currClipsIds.splice(i,1),curMotifsList.splice(i,1),i--)}callback&&"function"==typeof callback&&callback()}function populateProdMotifsArr(callback){for(var i=0;i<curMotifsList.length;i++){for(var emptyMotifsCount=0,j=0;j<curMotifsList[i].length;j++){if(-1==curMotifsList[i][j])curMotifsList[i][j]={id:j,motifId:0,accountId:userAccount.id,numName:alphabetNumeration[j]},currClipsList[i].clipId!=userAccount.get("abdicatives")&&currClipsList[i].clipId!=userAccount.get("indicatives")&&3!=currClipsList[i].productType&&emptyMotifsCount++;else{for(var z=0;z<motifsList.length;z++)if(curMotifsList[i][j]==motifsList[z].motifId){curMotifsList[i][j]=$.extend(!0,{},motifsList[z]),curMotifsList[i][j].numName=alphabetNumeration[j],curMotifsList[i][j].id=j;break}"object"!=typeof curMotifsList[i][j]&&(curMotifsList[i][j]={id:j,motifId:"0",accountId:userAccount.id,numName:alphabetNumeration[j]},currClipsList[i].clipId!=userAccount.get("abdicatives")&&currClipsList[i].clipId!=userAccount.get("indicatives")&&3!=currClipsList[i].productType&&emptyMotifsCount++)}for(var z=0;z<motifsContentTypeList.length;z++)if(currClipsList[i].clipId==motifsContentTypeList[z].productID&&j+1==motifsContentTypeList[z].position){curMotifsList[i][j].aspectRaw=motifsContentTypeList[z].aspect,curMotifsList[i][j].aspect=parseFloat(motifsContentTypeList[z].aspect*MOTIF_CONTAINER_HEIGHT),curMotifsList[i][j].typeName=motifsContentTypeList[z].name,curMotifsList[i][j].motifTypeId=motifsContentTypeList[z].motifTypeId;break}}emptyMotifsCount>0&&(currClipsList[i].emptyMotifs=emptyMotifsCount)}callback&&"function"==typeof callback&&callback()}function populateMotifTypesList(callback){currMotifTypesList=[];for(var i=0;i<curMotifsList.length;i++)for(var j=0;j<curMotifsList[i].length;j++)if(0==i&&0==j&&0==currMotifTypesList.length){var tmpMotifType={motifTypeId:curMotifsList[i][j].motifTypeId,typeName:curMotifsList[i][j].typeName,aspect:curMotifsList[i][j].aspect,numName:"A",motifId:"0"};currMotifTypesList.push(tmpMotifType)}else for(var z=0;z<currMotifTypesList.length&&curMotifsList[i][j].motifTypeId!=currMotifTypesList[z].motifTypeId;z++)if(z+1==currMotifTypesList.length){var tmpMotifType={motifTypeId:curMotifsList[i][j].motifTypeId,typeName:curMotifsList[i][j].typeName,aspect:curMotifsList[i][j].aspect,numName:"A",motifId:"0"};currMotifTypesList.push(tmpMotifType)}currentMotifTypesDataSource.read(),callback&&"function"==typeof callback&&callback()}function currProdMotifsListViewChangeFunc(){selectedClipMotifUid=this.select().data("uid"),selectedClipMotifId=this.select().index(),router.navigate("/motifSelect")}function currMotifTypesListViewChangeFunc(){selectedClipMotifUid=this.select().data("uid"),selectedClipMotifId=this.select().index(),router.navigate("/motifSelect")}function initImageGrid(){$("#current-film-motifs, #current-motif-types").collagePlus({padding:13,fadeSpeed:500,targetHeight:MOTIF_CONTAINER_HEIGHT,allowPartialLastRow:!0})}function currProdClipsListViewChangeFunc(){this.select().length>0&&(selectedClipUid=this.select().data("uid"),selectedClipId=this.select().index(),toggleBtnStatus(productionBtnsToDisable,!0),currClipMotifsList="Indikativ"==currClipsList[selectedClipId].location||3==currClipsList[selectedClipId].productType?[]:curMotifsList[selectedClipId],currentProdMotifsDataSource.read(),bindDeleteFunc($("#deleteClipButton"),!0),switchOffFillMotifsMode())}function ApllySelectedMotif(callback){if(router.navigate("/production"),$("#fillAllModeBtn").hasClass("active")){var replacedMotif=currentMotifTypesDataSource.getByUid(selectedClipMotifUid),curMotif=$.extend(!0,{},motifsDataSource.getByUid(selectedMotifUid));curMotif.aspect=replacedMotif.aspect,$.extend(!0,currMotifTypesList[selectedClipMotifId],curMotif),currentMotifTypesDataSource.read();for(var i=0;i<curMotifsList.length;i++)for(var j=0;j<curMotifsList[i].length;j++)curMotifsList[i][j].motifTypeId==currMotifTypesList[selectedClipMotifId].motifTypeId&&(0==curMotifsList[i][j].motifId&&(currClipsList[i].emptyMotifs-=1),$.extend(!0,curMotifsList[i][j],curMotif));currentProdMotifsDataSource.read(),currentProdClipsDataSource.read()}else{var replacedMotif=currentProdMotifsDataSource.getByUid(selectedClipMotifUid),curMotif=$.extend(!0,{},motifsDataSource.getByUid(selectedMotifUid));curMotif.aspect=replacedMotif.aspect,$.extend(!0,curMotifsList[selectedClipId][selectedClipMotifId],curMotif),currClipMotifsList=curMotifsList[selectedClipId],currentProdMotifsDataSource.read(),0==replacedMotif.motifId&&(currClipsList[selectedClipId].emptyMotifs-=1,currentProdClipsDataSource.read())}checkEmptyMotifs(),callback&&"function"==typeof callback&&callback()}function prodDeleteClipFunc(){currentProdClipsDataSource.getByUid(selectedClipUid);currClipsList.splice(selectedClipId,1),curMotifsList.splice(selectedClipId,1),currentProdClipsDataSource.read(),currClipMotifsList=[],currentProdMotifsDataSource.read(),toggleBtnStatus(productionBtnsToDisable,!1),0==currClipsList.length&&(toggleBtnStatus(productionInsertBtns,!0),toggleBtnStatus(fillBtn,!1),$("#current-motif-types").hide()),recalcProductionTime()}function prodReplaceClipFunc(callback){router.navigate("/prodCollection-replace"),$("#clips-list").data("kendoListView").setOptions({selectable:"true"}),$("#applyClipBtn , #applyClipBtn2").each(function(){$(this).data("kendoButton").setOptions({enable:"false",click:function(e){ApplySelectedClip()}})}),clearClipsAllFilters(),callback&&"function"==typeof callback&&callback()}function ApplySelectedClip(callback){router.navigate("/production");var curMotifAspect=0,curMotifTypeName="",replacingClip=clipsDataSource.getByUid(selectedProductUid[0]);currClipsList[selectedClipId]=$.extend(!0,{},replacingClip),currClipsList[selectedClipId].emptyMotifs=currClipsList[selectedClipId].motifsNum,curMotifsList[selectedClipId]=[];for(var i=0;i<replacingClip.motifsNum;i++){for(var z=0;z<motifsContentTypeList.length;z++)if(replacingClip.clipId==motifsContentTypeList[z].productID&&i+1==motifsContentTypeList[z].position){curMotifAspectRaw=motifsContentTypeList[z].aspect,curMotifAspect=parseInt(motifsContentTypeList[z].aspect*MOTIF_CONTAINER_HEIGHT),curMotifTypeName=motifsContentTypeList[z].name,curMotifTypeId=motifsContentTypeList[z].motifTypeId;break}curMotifsList[selectedClipId][i]={id:i,motifId:0,accountId:userAccount.id,numName:alphabetNumeration[i],aspectRaw:curMotifAspectRaw,aspect:curMotifAspect,typeName:curMotifTypeName,motifTypeId:curMotifTypeId}}currentProdClipsDataSource.read(),currentProdMotifsDataSource.read();var currentListView=$("#production-films");currentListView.data("kendoListView").select(currentListView.children().get(selectedClipId)),recalcProductionTime(),128==replacingClip.categoryId?toggleBtnStatus($(productionInsertBtns),!1):toggleBtnStatus($(productionInsertBtns),!0),$(".html5lightbox-link").html5lightbox(),callback&&"function"==typeof callback&&callback()}function prodInsertClipFunc(){router.navigate("/prodCollection"),$("#clips-list").data("kendoListView").setOptions({selectable:"multiple"}),$("#applyClipBtn , #applyClipBtn2").each(function(){$(this).data("kendoButton").setOptions({enable:"false",click:function(e){ApplyNewSelectedClip()}})}),clearClipsAllFilters()}function ApplyNewSelectedClip(callback){router.navigate("/production");for(var erppc=0;erppc<selectedProductUid.length;erppc++){var curMotifAspect=0,replacingClip=$.extend(!0,{},clipsDataSource.getByUid(selectedProductUid[erppc]));replacingClip.emptyMotifs=replacingClip.motifsNum;var curClipsCnt=currentProdClipsDataSource.data().length;if(replacingClip.emptyMotifs=replacingClip.motifsNum,-1!=userAccount.get("abdicatives")&&curClipsCnt>0){var tmpItem=$.extend(!0,{},currClipsList.pop());currClipsList.push(replacingClip),currClipsList.push(tmpItem),curClipsCnt--}else currClipsList.push(replacingClip);curMotifsList.splice(curClipsCnt,0,[]);for(var i=0;i<replacingClip.motifsNum;i++){for(var z=0;z<motifsContentTypeList.length;z++)if(replacingClip.clipId==motifsContentTypeList[z].productID&&i+1==motifsContentTypeList[z].position){curMotifAspectRaw=motifsContentTypeList[z].aspect,curMotifAspect=parseInt(motifsContentTypeList[z].aspect*MOTIF_CONTAINER_HEIGHT),curMotifTypeName=motifsContentTypeList[z].name,curMotifTypeId=motifsContentTypeList[z].motifTypeId;break}curMotifsList[curClipsCnt][i]={id:i,motifId:0,accountId:userAccount.id,numName:alphabetNumeration[i],aspectRaw:curMotifAspectRaw,aspect:curMotifAspect,typeName:curMotifTypeName,motifTypeId:curMotifTypeId}}currentProdClipsDataSource.read(),currentProdMotifsDataSource.read()}var currentListView=$("#production-films");currentListView.data("kendoListView").select(currentListView.children().get(curClipsCnt)),recalcProductionTime(),128==replacingClip.categoryId?toggleBtnStatus(productionInsertBtns,!1):toggleBtnStatus(productionInsertBtns,!0),toggleBtnStatus(fillBtn,!0),$(".html5lightbox-link").html5lightbox(),callback&&"function"==typeof callback&&callback()}function switchOffFillMotifsMode(){$("#fillAllModeBtn").removeClass("active"),$("#production-films").removeClass("active"),$("#current-film-motifs").show(),$("#current-motif-types").hide()}function fillMotifsMode(e){var $el=$(e.sender.element[0]);$el.hasClass("active")?($el.removeClass("active"),$("#production-films").removeClass("active"),$("#current-film-motifs").show(),$("#current-motif-types").hide()):($el.addClass("active"),$("#production-films").addClass("active"),$("#current-film-motifs").hide(),$("#current-motif-types").show())}function checkEmptyMotifs(){if(currClipsList.length>0){var unfilledMotifsNum=0,trailersNum=0;toggleBtnStatus(productionProduceBtn,!1);for(var i=0;i<currClipsList.length;i++)currClipsList[i].emptyMotifs>0&&unfilledMotifsNum++,3==currClipsList[i].productType&&trailersNum++;0==unfilledMotifsNum&&trailersNum!=currClipsList.length&&toggleBtnStatus(productionProduceBtn,!0),toggleBtnStatus(productionSaveBtn,!0)}else toggleBtnStatus(productionSaveBtn,!1),toggleBtnStatus(productionProduceBtn,!1)}function recalcProductionTime(){var framesArr=[];if(1==currentInd.get("isVisible")&&framesArr.push(currentInd.get("clipObj.duration")),currClipsList.length>0)for(var i=0;i<currClipsList.length;i++)framesArr.push(currClipsList[i].duration);1==currentAbd.get("isVisible")&&framesArr.push(currentInd.get("clipObj.duration")),currentProduction.set("prodObj.durTime",timeFormatingFromClipsArr(framesArr)),checkEmptyMotifs(),populateMotifTypesList()}function initProductionDragNDrop(){$("#production-films").kendoSortable({cursorOffset:{top:0,left:10},disabled:".locked",ignore:".video-wr , video",placeholder:function(element){return element.clone().css("opacity",.3)},hint:function(element){return element.clone().removeClass("k-state-selected")},change:function(e){var curItem=$.extend(!0,{},currClipsList[e.oldIndex]),curMotifs=[];currClipsList.splice(e.oldIndex,1),currClipsList.splice(e.newIndex,0,curItem);for(var i=0;i<curMotifsList[e.oldIndex].length;i++)curMotifs.push($.extend(!0,{},curMotifsList[e.oldIndex][i]));curMotifsList.splice(e.oldIndex,1),curMotifsList.splice(e.newIndex,0,[]);for(var i=0;i<curMotifs.length;i++)curMotifsList[e.newIndex][i]=$.extend(!0,{},curMotifs[i]);currentProdClipsDataSource.read();var curListView=$("#production-films").data("kendoListView");curListView.select(curListView.element.children().get(e.newIndex)),$(".html5lightbox-link").html5lightbox()}})}function bindEnterFunc(el,status){1==status&&void 0==jQuery._data(document,"events").keydown&&$(document).on("keydown",function(e){13==e.which&&$(el).trigger("click")}),0==status&&$(document).off("keydown")}function bindDeleteFunc(el,status){1==status&&void 0==jQuery._data(document,"events").keydown&&$(document).on("keydown",function(e){46==e.which&&$(el).trigger("click")}),0==status&&$(document).off("keydown")}function initCurAccObj(){kendo.bind($("#current-account-form"),editAccObj),editAccObj.bind("change",function(e){-1==editAccObj.get("accId")?(toggleBtnStatus($("#save-account-button"),!0),toggleBtnStatus($("#delete-account-button"),!1)):toggleBtnStatus($("#delete-account-button , #save-account-button"),!0)})}function createNewAccount(){$("#account-grid").data("kendoGrid").clearSelection(),editAccObj.set("isVisible",!0),editAccObj.set("accId",-1),editAccObj.set("accountGroupID",-1),editAccObj.set("accountGroupName","New Account"),editAccObj.set("usernameField",""),editAccObj.set("passwordField",""),editAccObj.set("firstnameField",""),editAccObj.set("lastnameField",""),editAccObj.set("groupField",-1),editAccObj.set("emailField",""),editAccObj.set("quotaField",0),editAccObj.set("budgetField",0),editAccObj.set("languageField","en_GB"),editAccObj.set("accActivField",0),editAccObj.set("multilogin",0),toggleBtnStatus($("#delete-account-button , #save-account-button"),!1)}function selectAccountItem(){if(this.select().length>0){selectedAccUid=this.select().data("uid");var curItem=$.extend(!0,{},accountsDataSource.getByUid(selectedAccUid));editAccObj.set("isVisible",!0),editAccObj.set("accId",curItem.accId),editAccObj.set("accountGroupID",curItem.accountGroupID),editAccObj.set("accountGroupName",curItem.accountGroupName),editAccObj.set("usernameField",curItem.loginUsername),editAccObj.set("passwordField",""),editAccObj.set("firstnameField",curItem.name),editAccObj.set("lastnameField",curItem.lastName),editAccObj.set("groupField",parseInt(curItem.accountGroupID)),editAccObj.set("emailField",curItem.email),editAccObj.set("quotaField",parseInt(curItem.quota)),editAccObj.set("budgetField",parseInt(curItem.budget)),editAccObj.set("languageField",curItem.languageIsoCode),editAccObj.set("accActivField",parseInt(curItem.isActive)),editAccObj.set("multilogin",parseInt(curItem.multilogin))}toggleBtnStatus($("#save-account-button"),!1),toggleBtnStatus($("#delete-account-button"),!0)}function onSelectAccountGroup(e){var item=e.item;editAccObj.set("accountGroupName",item.text())}function popupSetAccountName(){$("#curr-acc-name").text(editAccObj.get("usernameField"))}function deleteAccount(){deleteByAdmin(0,editAccObj.get("accId"),"account",function(){accountsDataSource.remove(accountsDataSource.getByUid(selectedAccUid)),createNewAccount(),editAccObj.set("isVisible",!1)}),curPopupCloseFunc()}function clearAccountObject(){createNewAccount(),editAccObj.set("isVisible",!1)}function searchAccFunc(){searchVal=$("#account-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(accountsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#account-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(accountsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#account-search-clear").addClass("hidden"))}function initAccSearch(){searchVal=$("#account-search-field").val(),prevSearchVal=searchVal,$("#account-search-field")&&$("#account-search-field").on("keyup",this,function(){searchAccFunc()})}function clearAccFilter(){accountsDataSource.query({filter:{field:"name",operator:"contains",value:""}}),$("#account-search-clear").addClass("hidden"),$("#account-search-field").val("")}function initCurAudioObj(){kendo.bind($("#audio-edit-page"),editAudioObj),editAudioObj.bind("change",function(e){0==editAudioObj.get("name").length||editAudioObj.get("name").length>255||-1==editAudioObj.get("mediaFormatID")?toggleBtnStatus($("#save-audio-edit-button"),!1):toggleBtnStatus($("#save-audio-edit-button"),!0)})}function createNewAudio(){$("#audio-grid").data("kendoGrid").clearSelection(),editAudioObj.set("task","addAudio"),editAudioObj.set("audioId",-1),editAudioObj.set("name","New Audio"),editAudioObj.set("mediaFormatID",-1),editAudioObj.set("creationTime",""),editAudioObj.set("accountID",-1),editAudioObj.set("accountName",""),editAudioObj.set("mediaFormat",""),editAudioObj.set("extension",""),toggleBtnStatus($("#save-audio-edit-button"),!1)}function selectAudioItem(){if(this.select().length>0){selectedAudioUid=this.select().data("uid");var curItem=$.extend(!0,{},audioDataSource.getByUid(selectedAudioUid));editAudioObj.set("audioId",parseInt(curItem.audioId)),editAudioObj.set("name",curItem.name),editAudioObj.set("mediaFormatID",parseInt(curItem.mediaFormatID)),editAudioObj.set("mediaFormat",curItem.mediaFormat),editAudioObj.set("creationTime",curItem.creationTime),editAudioObj.set("accountID",parseInt(curItem.accountID)),editAudioObj.set("accountName",curItem.accountName),editAudioObj.set("extension",curItem.extension)}$("#playCurAudio").removeClass("playing"),this.select().length>0&&$("#playCurAudio").attr("src","/data/audio/audio_"+curItem.audioId+curItem.extension),stopAdminPlayAudio(),toggleBtnStatus($("#play-audio-button , #delete-audio-button , #edit-audio-button"),!0)}function initEditAudioPlayer(){stopAdminPlayAudio(),-1!=editAudioObj.get("audioId")?($("#playCurAudio").removeClass("playing").attr("src","/data/audio/audio_"+editAudioObj.get("audioId")+editAudioObj.get("extension")),toggleBtnStatus($("#play-audio-edit-button"),!0)):($("#playCurAudio").removeClass("playing").attr("src",""),toggleBtnStatus($("#play-audio-edit-button"),!1),stopAdminPlayAudio())}function popupSetAudioName(){$("#curr-audio-name").text(editAudioObj.get("name"))}function deleteAudio(){deleteByAdmin(0,editAudioObj.get("audioId"),"audio",function(){audioDataSource.remove(audioDataSource.getByUid(selectedAudioUid)),createNewAudio()}),curPopupCloseFunc()}function playAudio(){var playBtn=$("#play-audio-button , #play-audio-edit-button"),audio=document.getElementById("playCurAudio");return $(audio).hasClass("playing")?($(audio).removeClass("playing"),audio.pause(),$(playBtn).find(".play").css("opacity",1),$(playBtn).find(".stop").css("opacity",0)):($(audio).addClass("playing"),audio.play(),$(playBtn).find(".play").css("opacity",0),$(playBtn).find(".stop").css("opacity",1)),!1}function stopAdminPlayAudio(){var audio=document.getElementById("playCurAudio"),playBtn=$("#play-audio-button , #play-audio-edit-button");$(audio).removeClass("playing"),audio.pause(),$(playBtn).find(".play").css("opacity",1),$(playBtn).find(".stop").css("opacity",0)}function newAudioFunc(){
createNewAudio(),router.navigate("/adm-audio-edit"),initEditAudioPlayer()}function editAudioFunc(){editAudioObj.set("task","updateAudio"),router.navigate("/adm-audio-edit"),initEditAudioPlayer()}function selectAudioFile(){$("#audio-input-file").on("change",function(){editAudioObj.set("name",this.files[0].name),editAudioObj.set("mediaFormatID",checkFileExtension(this.files[0].name)),$("#playCurAudio").removeClass("playing").attr("src","")}),$("#audio-input-file").trigger("click")}function searchAudioFunc(){searchVal=$("#audio-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(audioDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#audio-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(audioDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#audio-search-clear").addClass("hidden")),toggleBtnStatus($("#play-audio-button, #delete-audio-button, #edit-audio-button"),!1)}function initAudioSearch(){searchVal=$("#audio-search-field").val(),prevSearchVal=searchVal,$("#audio-search-field")&&$("#audio-search-field").on("keyup",this,function(){searchAudioFunc()})}function clearAudioFilter(){audioDataSource.query({filter:{field:"name",operator:"contains",value:""}}),$("#audio-search-clear").addClass("hidden"),$("#audio-search-field").val(""),toggleBtnStatus($("#play-audio-button, #delete-audio-button, #edit-audio-button"),!1)}function searchFinishedFunc(){searchVal=$("#finished-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(finishedProdsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#finished-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(finishedProdsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#finished-search-clear").addClass("hidden"))}function initFinishedSearch(){searchVal=$("#finished-search-field").val(),prevSearchVal=searchVal,$("#finished-search-field")&&$("#finished-search-field").on("keyup",this,function(){searchFinishedFunc()})}function clearFinishedFilter(){finishedProdsDataSource.query({filter:{field:"name",operator:"contains",value:""}}),$("#finished-search-clear").addClass("hidden"),$("#finished-search-field").val("")}function initOpenedProdObj(){kendo.bind($("#change-priority-popup"),openedProdObj)}function updatePriorityAccept(){updateProductionPriority(function(){getOpenProductionList(),toggleBtnStatus($("#change-priority-button"),!1)}),curPopupCloseFunc()}function selectOpenedItem(){var curItem=$.extend(!0,{},openedProdsDataSource.getByUid(this.select().data("uid")));openedProdObj.set("prodId",curItem.prodId),openedProdObj.set("priority",curItem.priority),toggleBtnStatus($("#change-priority-button"),!0)}function searchOpenedFunc(){searchVal=$("#opened-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(openedProdsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#opened-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(openedProdsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#opened-search-clear").addClass("hidden")),toggleBtnStatus($("#change-priority-button"),!1)}function initOpenedSearch(){searchVal=$("#opened-search-field").val(),prevSearchVal=searchVal,$("#opened-search-field")&&$("#opened-search-field").on("keyup",this,function(){searchOpenedFunc()})}function clearOpenedFilter(){openedProdsDataSource.query({filter:{field:"name",operator:"contains",value:""}}),$("#opened-search-clear").addClass("hidden"),$("#opened-search-field").val(""),toggleBtnStatus($("#change-priority-button"),!1)}function initCurGroupObj(){$("#groups-grid").data("kendoGrid").clearSelection(),editGroupObj.set("dicativesArr",dicativeList),kendo.bind($("#current-group-obj"),editGroupObj),editGroupObj.bind("change",function(e){-1==editGroupObj.get("groupId")?(toggleBtnStatus($("#save-group-button"),!0),toggleBtnStatus($("#delete-group-button"),!1)):toggleBtnStatus($("#delete-group-button , #save-group-button"),!0)})}function createNewGroup(){if(""==tempGroupUID){var tmpGr=groupsDataSource.add({abdicative:-1,description:"",groupCustomField:"",groupCustomObligate:0,onlinethreesixty:0,groupId:-1,indicative:-1,name:"New Group"});tempGroupUID=tmpGr.uid,toggleBtnStatus($("#delete-group-button , #save-group-button"),!1)}$("#groups-grid").data("kendoGrid").select("tr[data-uid='"+tempGroupUID+"']")}function selectGroupItem(){function clearGroupArrays(){groupOperationsList=[],groupAudioOperationsList=[],accGrList=[],accGrFullList=[],prodGrList=[],prodGrFullList=[],audioGrList=[],audioGrFullList=[]}function setGrObj(){clearGroupArrays(),$("#group-tabs").kendoTabStrip().data("kendoTabStrip").select(0),kendo.bind($("#current-group-obj"),editGroupObj),editGroupObj.set("isVisible",!0),editGroupObj.set("groupId",curItem.groupId),editGroupObj.set("name",curItem.name),editGroupObj.set("indicative",curItem.indicative),editGroupObj.set("abdicative",curItem.abdicative),editGroupObj.set("description",curItem.description),editGroupObj.set("groupCustomField",curItem.groupCustomField),editGroupObj.set("groupCustomObligate",curItem.groupCustomObligate),editGroupObj.set("onlinethreesixty",curItem.onlinethreesixty),accGrList=$.grep(accountsArr,function(item){return curItem.groupId==item.accountGroupID}),accGrFullList=$.grep(accountsArr,function(item){return curItem.groupId==item.accountGroupID},!0),accGrDataSource.read(),accGrFullDataSource.read(),getProductAssociations(curItem.groupId,function(){prodGrList=$.grep(ProductList,function(item){return-1!=$.inArray(item.clipId,currGroupProdIds)}),prodGrFullList=$.grep(ProductList,function(item){return-1!=$.inArray(item.clipId,currGroupProdIds)},!0),prodGrDataSource.read(),prodGrFullDataSource.read()}),audioGrList=$.grep(audioArr,function(item){return $.inArray(curItem.groupId,item.groupIDs)>-1}),audioGrFullList=$.grep(audioArr,function(item){return $.inArray(curItem.groupId,item.groupIDs)>-1},!0),audioGrDataSource.read(),audioGrFullDataSource.read()}if(this.select().length>0){selectedGroupUid=this.select().data("uid");var curItem=$.extend(!0,{},groupsDataSource.getByUid(selectedGroupUid));""!=tempGroupUID&&-1!=curItem.groupId?shortPopupCallFunct("dialog-popup","save-new-group-tmp"):setGrObj()}toggleBtnStatus($("#add-gr-acc-btn , #remove-gr-acc-btn , #add-gr-prod-btn , #remove-gr-prod-btn"),!1),toggleBtnStatus($("#save-group-button"),!1),toggleBtnStatus($("#delete-group-button"),!0)}function onSelectGroupAbdikativ(e){editGroupObj.set("abdicative",parseInt(this.value()))}function onSelectGroupIndikativ(e){editGroupObj.set("indicative",parseInt(this.value()))}function popupSetGroupName(){$("#curr-group-name").text(editGroupObj.get("name"))}function deleteGroup(){deleteByAdmin(0,editGroupObj.get("groupId"),"account_group",function(){getAccountGroupList(),editGroupObj.set("isVisible",!1)}),curPopupCloseFunc()}function clearGroupObject(){groupsDataSource.remove(groupsDataSource.getByUid(tempGroupUID)),tempGroupUID="",$("#groups-grid").data("kendoGrid").select("tr[data-uid='"+selectedGroupUid+"']"),toggleBtnStatus($("#delete-group-button , #save-group-button"),!1),curPopupCloseFunc()}function addTabListsFunc(e){for(var dataSourceEl,tabName=$(e.event.target).attr("name"),elArr=$("#"+tabName+"-full-grid").data("kendoGrid").select(),elUidArr=[],i=0;i<elArr.length;i++)elUidArr.push($(elArr[i]).data("uid"));switch(tabName){case"acc-gr":for(var i=0;i<elUidArr.length;i++)dataSourceEl=accGrFullDataSource.getByUid(elUidArr[i]),accGrFullDataSource.remove(dataSourceEl),accGrDataSource.add(dataSourceEl),checkOperationsList(groupOperationsList,"accountGroup2account","add",editGroupObj.get("groupId"),dataSourceEl.accId,function(){toggleBtnStatus($("#save-group-button"),!0)});break;case"prod-gr":for(var i=0;i<elUidArr.length;i++)dataSourceEl=prodGrFullDataSource.getByUid(elUidArr[i]),prodGrFullDataSource.remove(dataSourceEl),prodGrDataSource.add(dataSourceEl),checkOperationsList(groupOperationsList,"accountGroup2product","add",editGroupObj.get("groupId"),dataSourceEl.clipId,function(){toggleBtnStatus($("#save-group-button"),!0)});break;case"audio-gr":for(var i=0;i<elUidArr.length;i++)dataSourceEl=audioGrFullDataSource.getByUid(elUidArr[i]),audioGrFullDataSource.remove(dataSourceEl),audioGrDataSource.add(dataSourceEl),checkOperationsList(groupAudioOperationsList,"accountGroup2audio","add",editGroupObj.get("groupId"),dataSourceEl.audioId,function(){toggleBtnStatus($("#save-group-button"),!0)});break;case"prod-groups":for(var i=0;i<elUidArr.length;i++)dataSourceEl=groupProdFullDataSource.getByUid(elUidArr[i]),groupProdFullDataSource.remove(dataSourceEl),groupProdDataSource.add(dataSourceEl),checkOperationsList(prodGroupsOperationsList,"Group2Product","add",editProductObj.get("clipId"),dataSourceEl.groupId,function(){toggleBtnStatus($("#save-adm-product-button"),!0)})}toggleBtnStatus($("#add-"+tabName+"-btn"),!1)}function removeTabListsFunc(e){for(var dataSourceEl,tabName=$(e.event.target).attr("name"),elArr=$("#"+tabName+"-grid").data("kendoGrid").select(),elUidArr=[],i=0;i<elArr.length;i++)elUidArr.push($(elArr[i]).data("uid"));switch(tabName){case"acc-gr":for(var i=0;i<elUidArr.length;i++)dataSourceEl=accGrDataSource.getByUid(elUidArr[i]),accGrDataSource.remove(dataSourceEl),accGrFullDataSource.add(dataSourceEl),checkOperationsList(groupOperationsList,"accountGroup2account","remove",editGroupObj.get("groupId"),dataSourceEl.accId,function(){toggleBtnStatus($("#save-group-button"),!0)});break;case"prod-gr":for(var i=0;i<elUidArr.length;i++)dataSourceEl=prodGrDataSource.getByUid(elUidArr[i]),prodGrDataSource.remove(dataSourceEl),prodGrFullDataSource.add(dataSourceEl),checkOperationsList(groupOperationsList,"accountGroup2product","remove",editGroupObj.get("groupId"),dataSourceEl.clipId,function(){toggleBtnStatus($("#save-group-button"),!0)});break;case"audio-gr":for(var i=0;i<elUidArr.length;i++)dataSourceEl=audioGrDataSource.getByUid(elUidArr[i]),audioGrDataSource.remove(dataSourceEl),audioGrFullDataSource.add(dataSourceEl),checkOperationsList(groupAudioOperationsList,"accountGroup2audio","remove",editGroupObj.get("groupId"),dataSourceEl.audioId,function(){toggleBtnStatus($("#save-group-button"),!0)});break;case"prod-groups":for(var i=0;i<elUidArr.length;i++)dataSourceEl=groupProdDataSource.getByUid(elUidArr[i]),groupProdDataSource.remove(dataSourceEl),groupProdFullDataSource.add(dataSourceEl),checkOperationsList(prodGroupsOperationsList,"Group2Product","remove",editProductObj.get("clipId"),dataSourceEl.groupId,function(){toggleBtnStatus($("#save-adm-product-button"),!0)})}toggleBtnStatus($("#remove-"+tabName+"-btn"),!1)}function enableListOperationBtn(e){var btnId=$(e.sender.element[0]).data("enable-btn");toggleBtnStatus($("#"+btnId),!0)}function checkOperationsList(operationsArr,objectType,operType,groupId,objectId,callback){var invertedOperationIdx=-1;curOperation={opObjType:objectType,operType:operType,grId:groupId,objId:objectId};var invertedOpObj=$.extend({},curOperation);invertedOpObj.operType="add"==curOperation.operType?"remove":"add",$.grep(operationsArr,function(item,index){if(JSON.stringify(invertedOpObj)===JSON.stringify(item))return invertedOperationIdx=index,!0}),-1==invertedOperationIdx?operationsArr.push(curOperation):operationsArr.splice(invertedOperationIdx,1),operationsArr.length>0&&callback&&"function"==typeof callback&&callback()}function searchGroupFunc(){searchVal=$("#group-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(groupsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#group-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(groupsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#group-search-clear").addClass("hidden")),toggleBtnStatus($("#delete-group-button , #save-group-button"),!1)}function initGroupSearch(){searchVal=$("#group-search-field").val(),prevSearchVal=searchVal,$("#group-search-field")&&$("#group-search-field").on("keyup",this,function(){searchGroupFunc()})}function clearGroupFilter(){groupsDataSource.query({filter:{field:"name",operator:"contains",value:""}}),$("#group-search-clear").addClass("hidden"),$("#group-search-field").val(""),toggleBtnStatus($("#delete-group-button , #save-group-button"),!1)}function initCurMotifTypeObj(){kendo.bind($("#motif-types-edit-page"),editMotifTypeObj),editMotifTypeObj.bind("change",function(e){0==editMotifTypeObj.get("width")&&0==editMotifTypeObj.get("height")||editMotifTypeObj.set("aspect",(editMotifTypeObj.get("width")/editMotifTypeObj.get("height")).toFixed(2)),0==editMotifTypeObj.get("name").length||editMotifTypeObj.get("name").length>255||0==editMotifTypeObj.get("width")||0==editMotifTypeObj.get("height")?toggleBtnStatus($("#save-motif-types-edit-button"),!1):toggleBtnStatus($("#save-motif-types-edit-button"),!0)})}function createNewMotifType(){editMotifTypeObj.set("task","createContentFormat"),editMotifTypeObj.set("motifTypeId",-1),editMotifTypeObj.set("name","New Motif Type"),editMotifTypeObj.set("width",0),editMotifTypeObj.set("height",0),editMotifTypeObj.set("aspect",0),$("#motif-type-preview").css("background-image","").text("A"),toggleBtnStatus($("#save-motif-type-edit-button"),!1)}function selectMotifTypeItem(){if(this.select().length>0){selectedMotifTypeUid=this.select().data("uid");var curItem=$.extend(!0,{},motifTypeDataSource.getByUid(selectedMotifTypeUid));editMotifTypeObj.set("motifTypeId",parseInt(curItem.motifTypeId)),editMotifTypeObj.set("name",curItem.name),editMotifTypeObj.set("width",parseFloat(curItem.width)),editMotifTypeObj.set("height",parseFloat(curItem.height)),editMotifTypeObj.set("aspect",parseFloat(curItem.aspect)),$("#motif-type-preview").css("background-image","").text("A")}toggleBtnStatus($("#delete-motif-type-button , #edit-motif-type-button"),!0)}function popupSetMotifTypeName(){$("#curr-motif-type-name").text(editMotifTypeObj.get("name"))}function deleteMotifType(){deleteByAdmin(0,editMotifTypeObj.get("motifTypeId"),"content_format",function(){motifTypeDataSource.remove(motifTypeDataSource.getByUid(selectedMotifTypeUid)),getContentFormats(),createNewMotifType()}),curPopupCloseFunc()}function newMotifTypeFunc(){$("#motif-type-grid").data("kendoGrid").clearSelection(),router.navigate("/adm-motif-types-edit"),createNewMotifType()}function editMotifTypeFunc(){router.navigate("/adm-motif-types-edit"),editMotifTypeObj.set("task","updateContentFormat")}function ApllySelectedPreview(){var curItem=motifsDataSource.getByUid(selectedMotifUid),previewSrc="url(/data/accounts/"+curItem.accountId+"/motifs/"+curItem.motifId+"_thumb.jpg";router.navigate("/adm-motif-types-edit"),$("#motif-type-preview").css("background-image",previewSrc).text("")}function searchMotifTypeFunc(){searchVal=$("#motif-type-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(motifTypeDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#motif-type-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(motifTypeDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#motif-type-search-clear").addClass("hidden")),toggleBtnStatus($("#delete-motif-type-button, #edit-motif-type-button"),!1)}function initMotifTypeSearch(){searchVal=$("#motif-type-search-field").val(),prevSearchVal=searchVal,$("#motif-type-search-field")&&$("#motif-type-search-field").on("keyup",this,function(){searchMotifTypeFunc()})}function clearMotifTypeFilter(){motifTypeDataSource.query({filter:{field:"name",operator:"contains",value:""}}),$("#motif-type-search-clear").addClass("hidden"),$("#momtif-type-search-field").val(""),toggleBtnStatus($("#delete-motif-type-button, #edit-motif-type-button"),!1)}function initCurProductObj(){editProductObj.set("categoriesArr",prodGroups),editProductObj.set("codecTypes",codecTypes),editProductObj.set("clipFormats",clipFormats),editProductObj.set("codecs",codecTypesLists),kendo.bind($("#current-product-obj"),editProductObj),editProductObj.bind("change",function(e){-1==editProductObj.get("clipId")||0==parseInt(editProductObj.get("duration"))||0==editProductObj.get("name").length||0==editProductObj.get("categoryId")||-1==editProductObj.get("categoryId")||3!=editProductObj.get("productType")&&0==editProductObj.get("contentTypes").length?toggleBtnStatus($("#delete-adm-product-button , #save-adm-product-button"),!1):1==editProductObj.get("isVisible")&&toggleBtnStatus($("#save-adm-product-button"),!0),(editProductObj.get("inFrame")>0||editProductObj.get("outFrame")>0)&&editProductObj.set("duration",editProductObj.get("outFrame")-editProductObj.get("inFrame")+1),editProductObj.set("masterIdEnabled","4"==editProductObj.get("productType"))})}function createNewProduct(){$("#adm-products-grid").data("kendoGrid").clearSelection(),editProductObj.set("isVisible",!0),editProductObj.set("clipId",-1),editProductObj.set("selectedClipId",-1),editProductObj.set("idString","0000"),editProductObj.set("name","New Product"),editProductObj.set("location",""),editProductObj.set("categoryId",-1),editProductObj.set("duration",0),editProductObj.set("previewFrame",0),editProductObj.set("description",""),editProductObj.set("task","addProduct"),editProductObj.set("contentTypes",[]),editProductObj.set("productType",1),editProductObj.set("allowedCodecs",[]),editProductObj.set("resolution",""),editProductObj.set("can_reformat",!1),editProductObj.set("width",0),editProductObj.set("height",0),editProductObj.set("master_ID",-1),editProductObj.set("master_ID_unchanged",-1),editProductObj.set("masterIdEnabled",!1),editProductObj.set("inFrame",0),editProductObj.set("outFrame",0),$("#edit-prod-video").attr("src",""),toggleBtnStatus($("#delete-adm-product-button , #save-adm-product-button"),!1),groupProdList=[],groupProdFullList=groupArr,groupProdDataSource.read(),groupProdFullDataSource.read()}function selectAdmProductItem(){function setObj(){groupProdList=[],groupProdFullList=[],editProductObj.set("task","updateProduct"),editProductObj.set("isVisible",!0),editProductObj.set("clipId",curItem.clipId),editProductObj.set("selectedClipId",curItem.clipId),editProductObj.set("idString",curItem.idString),editProductObj.set("name",curItem.name),editProductObj.set("location",curItem.location),editProductObj.set("categoryId",curItem.categoryId),editProductObj.set("previewFrame",curItem.previewFrame),editProductObj.set("description",curItem.description),editProductObj.set("contentTypes",getCurProductContentTypes(curItem.clipId)),editProductObj.set("productType",curItem.productType),editProductObj.set("allowedCodecs",curItem.allowedCodecs.split(",")),editProductObj.set("resolution",curItem.resolution),editProductObj.set("can_reformat","1"==curItem.can_reformat),editProductObj.set("width",curItem.codec.width),editProductObj.set("height",curItem.codec.height),editProductObj.set("master_ID",curItem.master_ID),editProductObj.set("master_ID_unchanged",curItem.master_ID),editProductObj.set("inFrame",curItem.inFrame),editProductObj.set("outFrame",curItem.outFrame),editProductObj.set("duration",curItem.duration),$("#edit-prod-video").attr("src",window.location.protocol+"//"+window.location.hostname+"/data/products/"+curItem.idString+"/"+curItem.idString+"_ldpi.mp4"),getGroupAssociations(curItem.clipId,function(){groupProdList=$.grep(groupArr,function(item){return-1!=$.inArray(item.groupId,currProdGroupIds)}),groupProdFullList=$.grep(groupArr,function(item){return-1!=$.inArray(item.groupId,currProdGroupIds)},!0),groupProdDataSource.read(),groupProdFullDataSource.read()})}if(this.select().length>0){selectedAdmProductUid=this.select().data("uid");var curItem=$.extend(!0,{},admProductsDataSource.getByUid(selectedAdmProductUid));curItem.codec=$.grep(codecTypes,function(item,i){return curItem.resolution==item.codec_type_id})[0],setObj()}toggleBtnStatus($("#save-adm-product-button"),!1),toggleBtnStatus($("#delete-adm-product-button"),!0)}function getCurProductContentTypes(clipId){var contentTypesArray=[];contentTypesArray=$.grep(motifsContentTypeList,function(item){return clipId==item.productID});for(var i=0;i<contentTypesArray.length;++i)contentTypesArray[i].contentTypesArr=motifTypesArr;return contentTypesArray}function addContentType2Product(){var contentTypesArray=editProductObj.get("contentTypes"),newItemIdx=contentTypesArray.length,newContentTypeItem={position:newItemIdx+1,positionName:alphabetNumeration[newItemIdx],motifTypeId:-1,canLoop:0,acceptsFilm:0,loaderName:"Loader"+alphabetNumeration[newItemIdx],contentType:"visual",contentTypesArr:motifTypesArr};contentTypesArray.push(newContentTypeItem),editProductObj.set("contentTypes",contentTypesArray)}function recalcContentNames(e){var contentTypesArray=editProductObj.get("contentTypes");contentTypesArray.splice(e.model.position-1,1);for(var i=0;i<contentTypesArray.length;i++)contentTypesArray[i].position=i+1,contentTypesArray[i].positionName=alphabetNumeration[i],contentTypesArray[i].loaderName="Loader"+alphabetNumeration[i];editProductObj.set("contentTypes",contentTypesArray),$("#cur-content-type-list").data("kendoListView").refresh()}function onSelectProductCategory(e){}function onSelectProductType(e){4==editProductObj.get("productType")&&-1==editProductObj.get("master_ID")&&editProductObj.set("master_ID",0),4!=editProductObj.get("productType")&&-1!=editProductObj.get("master_ID")&&editProductObj.set("master_ID",-1)}function onSelectResolution(e){var codec=codecTypes[e.sender.selectedIndex];editProductObj.set("width",codec.width),editProductObj.set("height",codec.height)}function popupSetProductName(){$("#curr-adm-product-name").text(editProductObj.get("name"))}function deleteAdmProduct(){console.log("delete"+editProductObj.get("selectedClipId")+"ID product"),deleteByAdmin(0,editProductObj.get("selectedClipId"),"product",function(){admProductsDataSource.remove(admProductsDataSource.getByUid(selectedAdmProductUid)),createNewProduct(),editProductObj.set("isVisible",!1),getProductListByAccount(function(){getDicativesByAccount(function(){getContentTypeListByAccount(function(){countClipMotifs()})})})}),curPopupCloseFunc()}function clearAdmProductObject(){createNewProduct(),editProductObj.set("isVisible",!1)}function searchAdmProductFunc(){searchVal=$("#adm-product-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(admProductsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#adm-product-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(admProductsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#adm-product-search-clear").addClass("hidden")),toggleBtnStatus($("#delete-adm-product-button , #save-adm-product-button"),!1)}function initAdmProductSearch(){searchVal=$("#group-search-field").val(),prevSearchVal=searchVal,$("#adm-product-search-field")&&$("#adm-product-search-field").on("keyup",this,function(){searchAdmProductFunc()})}function clearAdmProductFilter(){admProductsDataSource.query({filter:{field:"name",operator:"contains",value:""}}),$("#adm-product-search-clear").addClass("hidden"),$("#adm-product-search-field").val(""),toggleBtnStatus($("#delete-adm-product-button , #save-adm-product-button"),!1)}function curPopupCloseFunc(callback){var curPopup=$("#window");curPopup.parent().removeClass(winClass),curPopup.kendoWindow("close"),callback&&"function"==typeof callback&&callback()}function popupCallFunc(e,callback){if("BUTTON"==e.event.target.tagName)var el=$(e.event.target);else var el=$(e.event.target).closest("button");var $curPopup=$("#window");winClass=el[0].dataset.popupType;var tplName=el[0].dataset.popupContent;refreshCallBackFunc="",refreshCallBackFunc=window[el[0].dataset.refreshFunc],$curPopup.parent().addClass(winClass);var win=$curPopup.data("kendoWindow");win.content($("#"+tplName).html()),localizeHtml($curPopup),kendo.init($curPopup),"function"==typeof refreshCallBackFunc&&refreshCallBackFunc(),win.open().center(),callback&&"function"==typeof callback&&callback()}function shortPopupCallFunct(curWinClass,tplName,refreshFunc){var $curPopup=$("#window");winClass=curWinClass,refreshCallBackFunc=refreshFunc,$curPopup.parent().addClass(winClass);var win=$curPopup.data("kendoWindow");win.content($("#"+tplName).html()),localizeHtml($curPopup),kendo.init($curPopup),"function"==typeof refreshCallBackFunc&&refreshCallBackFunc(),win.open().center()}function onThemingChange(){var value;value=$("#theme-select").length?$("#theme-select").val():DEFAULT_THEME,newThemeLink="css/kendo."+value+".min.css",$("#theme-link").attr("href",newThemeLink),$("body").attr("class","k-content theme-"+value),docCookies.removeItem("virtualcampaign_theming"),docCookies.setItem("virtualcampaign_theming",value,new Date(2038,1,1),"/",window.location.host,null)}function onLangChange(){var value;value=$("#language-select").length?$("#language-select").val():DEFAULT_LANG,currLang=langArr[value],localizeHtml($("#page")),defProductionParams.name=currLang.NEW_PRODUCTION,currentProduction.set("prodObj",defProductionParams),docCookies.removeItem("virtualcampaign_lang"),docCookies.setItem("virtualcampaign_lang",value,new Date(2038,1,1),"/",window.location.host,null)}function initLocalizationData(callback){$.getJSON(langPathArr[0].lang_path,function(json){}).done(function(json){langArr[langPathArr[0].lang_name]=json,Object.keys(langArr).length==langPathArr.length&&callback&&"function"==typeof callback&&callback()}).fail(function(jqxhr,textStatus,error){console.log("Request Failed: "+textStatus+", "+error)}),$.getJSON(langPathArr[1].lang_path,function(json){}).done(function(json){langArr[langPathArr[1].lang_name]=json,Object.keys(langArr).length==langPathArr.length&&callback&&"function"==typeof callback&&callback()}).fail(function(jqxhr,textStatus,error){console.log("Request Failed: "+textStatus+", "+error)}),$.getJSON(langPathArr[2].lang_path,function(json){}).done(function(json){langArr[langPathArr[2].lang_name]=json,Object.keys(langArr).length==langPathArr.length&&callback&&"function"==typeof callback&&callback()}).fail(function(jqxhr,textStatus,error){console.log("Request Failed: "+textStatus+", "+error)}),$.getJSON(langPathArr[3].lang_path,function(json){}).done(function(json){langArr[langPathArr[3].lang_name]=json,Object.keys(langArr).length==langPathArr.length&&callback&&"function"==typeof callback&&callback()}).fail(function(jqxhr,textStatus,error){console.log("Request Failed: "+textStatus+", "+error)}),$.getJSON(langPathArr[4].lang_path,function(json){}).done(function(json){langArr[langPathArr[4].lang_name]=json,Object.keys(langArr).length==langPathArr.length&&callback&&"function"==typeof callback&&callback()}).fail(function(jqxhr,textStatus,error){console.log("Request Failed: "+textStatus+", "+error)})}function localizationFunc(callback){langViewModel=new kendo.observable({lang:currLang}),kendo.bind($("#loginPage"),langViewModel),currLang=langArr[DEFAULT_LANG],langViewModel.set("lang",currLang),callback&&"function"==typeof callback&&callback()}function localizeHtml(parentTag){$(parentTag).find(".lang-replace").each(function(){if(""!=$(this).data("lang")&&void 0!=$(this).data("lang")){var langLabel=$(this).data("lang");$(this).html(currLang[langLabel])}if(""!=$(this).data("tooltip")&&void 0!=$(this).data("tooltip")){var tooltipLabel=$(this).data("tooltip");$(this).attr("title",currLang[tooltipLabel])}if(""!=$(this).data("placeholder")&&void 0!=$(this).data("placeholder")){var placeholderLabel=$(this).data("placeholder");$(this).attr("placeholder",currLang[placeholderLabel])}})}function themeSelectInit(){if(docCookies.hasItem("virtualcampaign_theming")){var selectVal=docCookies.getItem("virtualcampaign_theming");$("#theme-select").length&&$("#theme-select").data("kendoDropDownList").select($("#theme-select option[value="+selectVal+"]").index()),newThemeLink="css/kendo."+selectVal+".min.css",$("#theme-link").attr("href",newThemeLink),$("body").attr("class","k-content theme-"+selectVal)}else docCookies.setItem("virtualcampaign_theming",DEFAULT_THEME,new Date(2038,1,1),"/",window.location.host,null),onThemingChange()}function localSelectInit(){if(docCookies.hasItem("virtualcampaign_lang")){var selectVal=docCookies.getItem("virtualcampaign_lang");$("#language-select").length&&$("#language-select").data("kendoDropDownList").select($("#language-select option[value="+selectVal+"]").index()),currLang=langArr[selectVal]}else docCookies.setItem("virtualcampaign_lang",DEFAULT_LANG,new Date(2038,1,1),"/",window.location.host,null),onLangChange()}var templateLoader=function($,host){return{loadExtTemplate:function(path,callback){var resultAll="";for(i=0;i<path.length;i++)i!=path.length-1?$.get(path[i]).success(function(result){resultAll+=result}).error(function(result){alert("Error Loading Template")}):$.get(path[i]).success(function(result){resultAll+=result,$("body").append(resultAll),callback&&"function"==typeof callback&&callback()}).error(function(result){alert("Error Loading Template")})}}}(jQuery,document),tplArr=["tpl/pages.html.tpl"],constFPS=25,DEFAULT_LANG="en_loc",langArr=[],currLang,langViewModel,cookieTheme="",cookieLang="",alphabetNumeration=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],refreshCallBackFunc,MAX_LOAD_IMG_WIDTH=600,MAX_LOAD_IMG_HEIGHT=600,kendoWindowParams={minHeight:50,minWidth:318,maxWidth:600,title:!1,visible:!1,resizable:!1,modal:!0,content:"",animation:{close:{duration:300}},close:function(e){}},responsivePanelParams={breakpoint:1024,orientation:"left"},currentInd=new kendo.observable({isVisible:!1,imgSrc:"",videoSrc:"",clipObj:{categoryId:0,clipId:0,crTime:0,date:"",description:"",durTime:"",duration:0,emptyMotifs:0,id:0,idString:"",location:"",locked:"",motifNamesString:"",motifsNum:0,name:""}}),currentAbd=new kendo.observable({isVisible:!1,imgSrc:"",videoSrc:"",clipObj:{categoryId:0,clipId:0,crTime:0,date:"",description:"",durTime:"",duration:0,emptyMotifs:0,id:0,idString:"",location:"",locked:"",motifNamesString:"",motifsNum:0,name:""}}),codecTypes=[],codecTypesLists={},clipFormats=[],defProductionParams={id:0,name:null==currLang?"New production":currLang.NEW_PRODUCTION,crTime:0,duration:0,durTime:"00:00 min",clips:[],motifs:[]},currentProduction=new kendo.observable({prodObj:{id:0,name:null==currLang?"New production":currLang.NEW_PRODUCTION,crTime:0,duration:0,durTime:"00:00 min",clips:[],motifs:[]}}),currentProdClipsDataSource,currentProdClipsListView,userAccount=new kendo.observable({loginStatus:0,id:0,groupId:0,firstName:"empty",surName:"empty",inProductionNum:0,inProduction:[],lastProdId:0,curProduction:"",productsVal:0,motifsVal:0,indicatives:-1,abdicatives:-1});userAccount.bind("change",function(e){"inProduction"==e.field&&userAccount.set("inProductionNum",userAccount.get("inProduction").length)})
;var motifsContentTypeList=[],fileExtensionsArr=[],motifUploadAcceptStr="",motifsDataSource,motifListView,motifSelectListView,motifsList=[],selectedMotifUid=[],selectedMotifId=[],uploadMotifObj,deleteMotifObj,filmsDataSource,filmsListView,filmsList=[],tmpFilmsList=[],selectedFilmUid=[],selectedFilmId=[],clipsDataSource,clipsListView,ProductList=[],dicativeList=[],clipsLocArr=[],motifsTypeNamArr=[],selectedProductUid=[],selectedProductId=[],selectedClipId,currClipsIds=[],currClipsList=[],curMotifsList=[],currMotifTypesList=[],currClipMotifsList=[],selectedClipUid,selectedClipId,selectedClipMotifUid,selectedClipMotifId,currentProdMotifsDataSource,currentProdClipsDataSource,accountsArr=[],groupArr=[],groupUsersArr=[],prodGroups=[],motifTypesArr=[],audioArr=[],productionsArr=[],openProdsArr=[],finishedProdsArr=[],winClass="",selectedAccUid,selectedAudioUid,selectedGroupUid,SALTED="vcampaign_704MvAgRniDZAyfLvIzr",progressMaxVal=10,progressVal=0,logStr="",codecFormatsObj=kendo.observable({isEnabled360format:!1,codecFormatTypes:{},codecFormatsArr:[],audioSelectArr:audioArr,productionAudio:-1,jobNameField:currentProduction.get("prodObj.name"),userEmailField:"",formatsReqFlag:!0,musicReqFlag:!0,nameReqFlag:!0});codecFormatsObj.bind("change",function(e){1==userAccount.get("onlinethreesixty")&&("codecFormatsArr"==e.field&&e.hasOwnProperty("items")&&"remove"==e.action&&"19"==e.items[0]&&($("#ch20").attr("disabled",!0),$("#ch20:checked").attr("checked",!1).trigger("change")),"codecFormatsArr"==e.field&&e.hasOwnProperty("items")&&"add"==e.action&&"19"==e.items[0]&&$("#ch20").attr("disabled",!1)),codecFormatsObj.get("codecFormatsArr").length>0?codecFormatsObj.set("formatsReqFlag",!1):codecFormatsObj.set("formatsReqFlag",!0),codecFormatsObj.get("productionAudio")>0?codecFormatsObj.set("musicReqFlag",!1):codecFormatsObj.set("musicReqFlag",!0),codecFormatsObj.get("jobNameField").trim()==currentProduction.get("prodObj.name")||""==codecFormatsObj.get("jobNameField")?codecFormatsObj.set("nameReqFlag",!0):codecFormatsObj.set("nameReqFlag",!1),codecFormatsObj.get("formatsReqFlag")||codecFormatsObj.get("musicReqFlag")||codecFormatsObj.get("nameReqFlag")?toggleBtnStatus($("#produce-prod-popup-button"),!1):toggleBtnStatus($("#produce-prod-popup-button"),!0)});var ProductionsStatArr=[],ProductUsageStatArr=[],statisticUser=new kendo.observable({userName:"",statStartDate:0,statEndDate:0,statStartDateString:"",statEndDateString:"",TimespanFilmCount:0,TimespanClipCount:0,TotalFilmCount:0,TotalClipCount:0}),ProductionsTableData,ProductionsTable,ProductionsChart,ProductionsView,ProductUsageTableData,ProductUsageTable,ProductUsageChart,ProductUsageView,prodCrTimeArr=[],clipsFilterModel,motifFilterModel,filmFilterModel,filmsBtnsToDisable=$("#deleteFilm , #downloadFilm , #loadFilm"),productionBtnsToDisable=$("#deleteClipButton , #replaceClipButton , #deleteClipButton2 , #replaceClipButton2, #deleteClipButton3 , #replaceClipButton3"),productionProduceBtn=$("#produceProdBtn , #produceProdBtn2"),productionInsertBtns=$("#insertClipBtn,#insertClipBtn2,#insertClipBtn3,#timeline-insert-button"),deleteMotifBtn=$("#delete-motif-btn , #delete-motif-btn2"),applyMotifBtn=$("#applyMotifBtn , #applyMotifBtn2"),applyClipBtn=$("#applyClipBtn , #applyClipBtn2"),productionSaveBtn=$("#saveProduction");fillBtn=$("#fillAllModeBtn");var prevSearchVal="",searchVal="",page404=new kendo.View("#page404",{init:function(e){},show:function(e){localizeHtml($("#page"))},hide:function(e){}}),loginPage=new kendo.View("#login",{init:function(e){localSelectInit()},show:function(e){void 0!=currLang&&localizeHtml($("#page"))}}),loadingPage=new kendo.View("#loading",{init:function(e){},show:function(e){localizeHtml($("#page"))}}),hubPage=new kendo.View("#hub",{init:function(e){},show:function(e){localizeHtml($("#page")),1==userAccount.get("groupId")?$("#page").addClass("admin-acc"):$("#page").removeClass("admin-acc")}}),logoutPage=new kendo.View("#logout",{init:function(e){localSelectInit()},show:function(e){void 0!=currLang&&localizeHtml($("#page"))}}),motifsPage=new kendo.View("#motifs",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams)},show:function(e){$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page"));var motifListViewObj=$("#motifs-list").data("kendoListView");motifListViewObj.clearSelection(),motifListViewObj.setOptions({selectable:"multiple"}),kendo.bind($("#motifs-filter"),motifFilterModel),initMotifSearch(),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)}}),motifsSelectPage=new kendo.View("#motifs",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams)},show:function(e){$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page")),$(".hide-block").addClass("visible"),$(".show-block").addClass("hidden");var motifListViewObj=$("#motifs-list").data("kendoListView");motifListViewObj.clearSelection(),motifListViewObj.setOptions({selectable:"true"}),kendo.bind($("#motifs-filter"),motifFilterModel),initMotifSearch(),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)},hide:function(e){bindEnterFunc($("#applyMotifBtn"),!1),$(".hide-block").removeClass("visible"),$(".show-block").removeClass("hidden")}}),prodListPage=new kendo.View("#prod-list",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams)},show:function(e){$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page")),initFilmsSearch(),kendo.bind($("#films-filter"),filmFilterModel),$(".html5lightbox-link").html5lightbox(),$("#films-list").data("kendoListView").clearSelection(),toggleBtnStatus(filmsBtnsToDisable,!1)},hide:function(e){}}),prodColPage=new kendo.View("#prod-collection",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams)},show:function(e){$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page")),$(".html5lightbox-link").html5lightbox(),$("#clips-list").data("kendoListView").clearSelection(),kendo.bind($("#clips-filter"),clipsFilterModel),initClipsSearch(),toggleBtnStatus(applyClipBtn,!1)},hide:function(e){bindEnterFunc($("#applyClipBtn"),!1)}}),productionPage=new kendo.View("#production",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams),kendo.bind($("#productionPage"),currentProduction),kendo.bind($("#currIndikativ"),currentInd),kendo.bind($("#currAbdikativ"),currentAbd),switchOffFillMotifsMode()},show:function(e){initImageGrid(),$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page")),$(".html5lightbox-link").html5lightbox(),toggleBtnStatus(productionBtnsToDisable,!1),initProductionDragNDrop()},hide:function(e){bindDeleteFunc($("#deleteClipButton"),!1)}}),statisticsPage=new kendo.View("#statistics",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams)},show:function(e){$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page")),kendo.bind($("#statistic-page"),statisticUser),initStatisticTime(function(){getStatisticsFunc(function(){initCharts()})})},hide:function(e){}}),layout=new kendo.Layout("<div id='page'></div>"),motifTemplate="",filmTemplate="",clipTemplate="",motifProdTemplate="",clipProdTemplate="";motifsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(motifsList)},create:function(e){e.data.id=motifsList.length,motifsList.push(e.data),e.success(e.data)},update:function(e){motifsList[e.data.id]=e.data,e.success()},destroy:function(e){motifsList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"crTime",dir:"desc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},motifId:{type:"number"},accountId:{type:"number"},name:{type:"string"},frameCount:{type:"number"},crTime:{type:"number"},date:{type:"string"},description:{type:"string"}}}},error:function(e){alert("failed to load motifs array",e.status)}}),filmsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(filmsList)},create:function(e){e.data.id=filmsList.length,filmsList.push(e.data),e.success(e.data)},update:function(e){filmsList[e.data.id]=e.data,e.success()},destroy:function(e){filmsList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"crTime",dir:"desc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},filmId:{type:"number"},accountId:{type:"number"},jobId:{type:"number"},name:{type:"string"},crTime:{type:"number"},crDate:{type:"string"},duration:{type:"number"},durTime:{type:"string"},videoFiles:{type:"default"},videoSizes:{type:"default"},products:{type:"string"},motifs:{type:"string"}}}},error:function(e){alert("failed to load films array",e.status)}}),clipsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(ProductList)},create:function(e){e.data.id=ProductList.length,ProductList.push(e.data),e.success(e.data)},update:function(e){ProductList[e.data.id]=e.data,e.success()},destroy:function(e){ProductList.splice(e.data.id,1),e.success()}},batch:!1,schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},clipId:{type:"number"},idString:{type:"string"},name:{type:"string"},location:{type:"string"},crTime:{type:"number"},date:{type:"string"},duration:{type:"number"},durTime:{type:"string"},motifsNum:{type:"number"},emptyMotifs:{type:"number"},productType:{type:"string"},allowedCodecs:{type:"string"},locked:{type:"string"}}}},error:function(e){alert("failed to load clips array",e.status)}});var MOTIF_CONTAINER_HEIGHT=170;currentProdMotifsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(currClipMotifsList),initImageGrid()},create:function(e){e.data.id=currClipMotifsList.length,currClipMotifsList.push(e.data),e.success(e.data)},update:function(e){currClipMotifsList[e.data.id]=e.data,e.success()},destroy:function(e){currClipMotifsList.splice(e.data.id,1),e.success()}},batch:!1,schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0,defaultValue:0},motifId:{type:"number",defaultValue:0},accountId:{type:"number",defaultValue:0},aspect:{type:"number",defaultValue:0},name:{type:"string"},frameCount:{type:"number"},crTime:{type:"number"},date:{type:"string"},description:{type:"string"},numName:{type:"string",defaultValue:"null"},typeName:{type:"string",defaultValue:"null"}}}},error:function(e){alert("failed to load motifs array",e.status)}}),currentMotifTypesDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(currMotifTypesList),initImageGrid()},create:function(e){e.data.id=currMotifTypesList.length,currMotifTypesList.push(e.data),e.success(e.data)},update:function(e){currMotifTypesList[e.data.id]=e.data,e.success()},destroy:function(e){currMotifTypesList.splice(e.data.id,1),e.success()}},batch:!1,schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0,defaultValue:0},motifId:{type:"number",defaultValue:0},aspect:{type:"number",defaultValue:0},numName:{type:"string",defaultValue:"null"},typeName:{type:"string",defaultValue:"null"},motifTypeId:{type:"number",defaultValue:0}}}},error:function(e){alert("failed to load motif types array",e.status)}});var resizeTimer=null;$(window).bind("resize",function(){$("#current-film-motifs .motif-select-item").css("opacity",0),resizeTimer&&clearTimeout(resizeTimer),resizeTimer=setTimeout(initImageGrid,200)}),currentProdClipsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(currClipsList)},create:function(e){e.data.id=currClipsList.length,currClipsList.push(e.data),e.success(e.data)},update:function(e){currClipsList[e.data.id]=e.data,e.success()},destroy:function(e){currClipsList.splice(e.data.id,1),e.success()}},batch:!1,schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},clipId:{type:"number"},idString:{type:"string"},name:{type:"string"},location:{type:"string"},crTime:{type:"number"},date:{type:"string"},duration:{type:"number"},durTime:{type:"string"},motifsNum:{type:"number"},emptyMotifs:{type:"number"},productType:{type:"string"},allowedCodecs:{type:"string"},locked:{type:"string"}}}},error:function(e){alert("failed to load clips array",e.status)}}),kendo.ui.Selectable.fn._myTap=kendo.ui.Selectable.fn._tap,kendo.ui.Selectable.fn._tap=function(e){$(e.target).hasClass("custom-disabled-item")||this._myTap(e)};var adminHubPage=new kendo.View("#admin-hub",{init:function(e){getOpenProductionList(function(){}),getFinishedProductionList(function(){})},show:function(e){localizeHtml($("#page"))}}),admAccountsPage=new kendo.View("#adm-accounts",{init:function(e){},show:function(e){localizeHtml($("#page")),initAccSearch(),clearAccountObject(),initCurAccObj()},hide:function(e){}}),admGroupsPage=new kendo.View("#adm-groups",{init:function(e){},show:function(e){localizeHtml($("#page")),initGroupSearch(),initCurGroupObj()},hide:function(e){}}),admMotifTypePage=new kendo.View("#adm-motif-types",{init:function(e){},show:function(e){localizeHtml($("#page")),initMotifTypeSearch(),initCurMotifTypeObj()}}),admMotifTypeEdit=new kendo.View("#adm-motif-types-edit",{init:function(e){},show:function(e){localizeHtml($("#page")),initCurMotifTypeObj(),toggleBtnStatus($("#save-motif-type-edit-button"),!1)}}),motifPreviewSelectPage=new kendo.View("#motifs",{init:function(e){},show:function(e){localizeHtml($("#page")),$(".hide-block").addClass("visible"),$(".show-block").addClass("hidden"),$(".preview-select-nav").show(),$(".motif-select-nav").hide();var motifListViewObj=$("#motifs-list").data("kendoListView");motifListViewObj.clearSelection(),motifListViewObj.setOptions({selectable:"true"}),kendo.bind($("#motifs-filter"),motifFilterModel),initMotifSearch(),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus($("#applyMotifPreviewBtn"),!1)},hide:function(e){bindEnterFunc($("#applyMotifPreviewBtn"),!1),$(".hide-block").removeClass("visible"),$(".show-block").removeClass("hidden"),$(".preview-select-nav").hide(),$(".motif-select-nav").show()}}),admAudioPage=new kendo.View("#adm-audio",{init:function(e){},show:function(e){localizeHtml($("#page")),initAudioSearch(),initCurAudioObj()}}),admAudioEdit=new kendo.View("#adm-audio-edit",{init:function(e){},show:function(e){$("#audio-upload-progressbar").data("kendoProgressBar").value(0),localizeHtml($("#page")),initCurAudioObj(),toggleBtnStatus($("#save-audio-edit-button"),!1)}}),admProductsPage=new kendo.View("#adm-products",{init:function(e){},show:function(e){localizeHtml($("#page")),initAdmProductSearch(),clearAdmProductObject(),initCurProductObj()},hide:function(e){}}),admOpenProdsPage=new kendo.View("#adm-open-prods",{init:function(e){},show:function(e){localizeHtml($("#page"))}}),admFinishedProdsPage=new kendo.View("#adm-finished-prods",{init:function(e){},show:function(e){localizeHtml($("#page"))}}),editAccObj=kendo.observable({isVisible:!1,accId:-1,accountGroupID:-1,accountGroupName:"",usernameField:"",passwordField:"",firstnameField:"",lastnameField:"",groupNamesField:groupArr,groupField:0,emailField:"",quotaField:0,budgetField:0,languageField:"",accActivField:0,multilogin:0});accountsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(accountsArr)},create:function(e){e.data.id=accountsArr.length,accountsArr.push(e.data),e.success(e.data)},update:function(e){accountsArr[e.data.id]=e.data,e.success()},destroy:function(e){accountsArr.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"accId",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},accId:{type:"number"},accountGroupID:{type:"number"},accountGroupName:{type:"string"},languageIsoCode:{type:"string"},loginUsername:{type:"string"},name:{type:"string"},lastName:{type:"string"},email:{type:"string"},isActive:{type:"number"},multilogin:{type:"number"},quota:{type:"number"},budget:{type:"number"}}}},error:function(e){alert("failed to load accounts array",e.status)}});var editAudioObj=kendo.observable({task:"addAudio",audioId:-1,name:"",mediaFormatID:-1,creationTime:"",accountID:-1,accountName:"",mediaFormat:"",extension:""});audioDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(audioArr)},create:function(e){e.data.id=audioArr.length,audioArr.push(e.data),e.success(e.data)},update:function(e){audioArr[e.data.id]=e.data,e.success()},destroy:function(e){audioArr.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"accId",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},audioId:{type:"number"},name:{type:"string"},mediaFormatID:{type:"number"},mediaFormat:{type:"string"},extension:{type:"string"},creationTime:{type:"string"},accountID:{type:"number"},accountName:{type:"string"}}}},error:function(e){alert("failed to load accounts array",e.status)}}),finishedProdsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(finishedProdsArr)},create:function(e){e.data.id=finishedProdsArr.length,finishedProdsArr.push(e.data),e.success(e.data)},update:function(e){finishedProdsArr[e.data.id]=e.data,e.success()},destroy:function(e){finishedProdsArr.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"prodId",dir:"desc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},prodId:{type:"number"},name:{type:"string"},creationTime:{type:"date"},updateTime:{type:"date"},userName:{type:"string"},priority:{type:"number"},clipFrameCount:{type:"number"}}}},error:function(e){alert("failed to load finished products array",e.status)}}),openedProdsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(openProdsArr)},create:function(e){e.data.id=openProdsArr.length,openProdsArr.push(e.data),e.success(e.data)},update:function(e){openProdsArr[e.data.id]=e.data,e.success()},destroy:function(e){openProdsArr.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"prodId",dir:"desc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},prodId:{type:"number"},name:{type:"string"},creationTime:{type:"date"},updateTime:{type:"date"},status:{type:"string"},userName:{type:"string"},priority:{type:"number"},clipFrameCount:{type:"number"}}}},error:function(e){alert("failed to load opened products array",e.status)}});var openedProdObj=kendo.observable({prodId:-1,priority:-1}),currGroupProdIds=[],accGrList=[],prodGrList=[],audioGrList=[],accGrFullList=[],prodGrFullList=[],audioGrFullList=[],groupOperationsList=[],groupAudioOperationsList=[],tempGroupUID="",editGroupObj=kendo.observable({isVisible:!1,groupId:-1,name:"",indicative:-1,abdicative:-1,description:"",groupCustomField:"",groupCustomObligate:0,onlinethreesixty:0,dicativesArr:dicativeList});groupsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(groupArr)},create:function(e){e.data.id=groupArr.length,groupArr.push(e.data),e.success(e.data)},update:function(e){groupArr[e.data.id]=e.data,e.success()},destroy:function(e){groupArr.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"groupId",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},groupId:{type:"number"},name:{type:"string"},indicative:{type:"number"},abdicative:{type:"number"},description:{type:"string"},groupCustomField:{type:"string"},groupCustomObligate:{type:"number"},onlinethreesixty:{type:"number"}}}},error:function(e){alert("failed to load groups array",e.status)}}),accGrDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(accGrList)},create:function(e){e.data.id=accGrList.length,accGrList.push(e.data),e.success(e.data)},update:function(e){accGrList[e.data.id]=e.data,e.success()},destroy:function(e){accGrList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"loginUsername",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},accId:{type:"number"},loginUsername:{type:"string"}}}},error:function(e){alert("failed to load array",e.status)}}),accGrFullDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(accGrFullList)},create:function(e){e.data.id=accGrFullList.length,accGrFullList.push(e.data),e.success(e.data)},update:function(e){accGrFullList[e.data.id]=e.data,e.success()},destroy:function(e){accGrFullList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"loginUsername",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},accId:{type:"number"},loginUsername:{type:"string"}}}},error:function(e){alert("failed to load array",e.status)}}),prodGrDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(prodGrList)},create:function(e){e.data.id=prodGrList.length,prodGrList.push(e.data),e.success(e.data)},update:function(e){prodGrList[e.data.id]=e.data,e.success()},destroy:function(e){prodGrList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"clipId",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},clipId:{type:"number"},categoryId:{type:"number"},loginUsername:{type:"string"}}}},error:function(e){alert("failed to load array",e.status)}}),prodGrFullDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(prodGrFullList)},create:function(e){e.data.id=prodGrFullList.length,prodGrFullList.push(e.data),e.success(e.data)},update:function(e){prodGrFullList[e.data.id]=e.data,e.success()},destroy:function(e){prodGrFullList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"clipId",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},clipId:{type:"number"},categoryId:{type:"number"},loginUsername:{type:"string"}}}},error:function(e){alert("failed to load array",e.status)}}),audioGrDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(audioGrList)},create:function(e){e.data.id=audioGrList.length,audioGrList.push(e.data),e.success(e.data)},update:function(e){audioGrList[e.data.id]=e.data,e.success()},destroy:function(e){audioGrList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"audioId",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},audioId:{type:"number"},name:{type:"string"}}}},error:function(e){alert("failed to load array",e.status)}}),audioGrFullDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(audioGrFullList)},create:function(e){e.data.id=audioGrFullList.length,audioGrFullList.push(e.data),e.success(e.data)},update:function(e){audioGrFullList[e.data.id]=e.data,e.success()},destroy:function(e){audioGrFullList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"audioId",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},audioId:{type:"number"},name:{type:"string"}}}},error:function(e){alert("failed to load array",e.status)}});var editMotifTypeObj=kendo.observable({task:"createContentFormat",motifTypeId:-1,name:"",aspect:0,width:0,height:0,calculatedWidth:function(){var w=0!=this.get("aspect")?115*this.get("aspect"):172.5;return(w=w<70?70:w)+"px"},calculatedHeight:function(){var w,h=115;return 0!=this.get("aspect")?(w=h*this.get("aspect"),h=w<70?70/this.get("aspect"):115):h=115,h+"px"}});motifTypeDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(motifTypesArr)},create:function(e){e.data.id=motifTypesArr.length,motifTypesArr.push(e.data),e.success(e.data)},update:function(e){motifTypesArr[e.data.id]=e.data,e.success()},destroy:function(e){motifTypesArr.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"motifTypeId",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},motifTypeId:{type:"number"},name:{type:"string"},width:{type:"width"},height:{type:"height"},aspect:{type:"number"},iconWidth:{type:"number"}}}},error:function(e){alert("failed to load array",e.status)}});var selectedMotifTypeUid,selectedAdmProductUid,prodGroupsOperationsList=[],currProdGroupIds=[],groupProdList=[],groupProdFullList=[],editProductObj=kendo.observable({isVisible:!1,selectedClipId:-1,clipId:-1,idString:"0000",name:"",location:"",categoriesArr:prodGroups,clipFormats:clipFormats,codecTypes:codecTypes,categoryId:0,duration:0,previewFrame:0,description:"",task:"addProduct",contentTypes:[],productType:1,allowedCodecs:[],codecs:{},can_reformat:!1,resolution:"",width:0,height:0,master_ID:-1,master_ID_unchanged:-1,masterIdEnabled:!1,inFrame:0,outFrame:0});admProductsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(ProductList)},create:function(e){e.data.id=ProductList.length,ProductList.push(e.data),e.success(e.data)},update:function(e){ProductList[e.data.id]=e.data,e.success()},destroy:function(e){ProductList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"clipId",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},clipId:{type:"number"},idString:{type:"string"},name:{type:"string"},location:{type:"string"},categoryId:{type:"number"},duration:{type:"number"},previewFrame:{type:"number"},description:{type:"string"},motifsNum:{type:"number"},productType:{type:"number"},productTypeName:{type:"string"},allowedCodecs:{type:"string"},resolution:{type:"string"},can_reformat:{type:"string"},master_ID:{type:"number"},inFrame:{type:"number"},outFrame:{type:"number"}}}},error:function(e){alert("failed to load array",e.status)}}),groupProdDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(groupProdList)},create:function(e){e.data.id=groupProdList.length,groupProdList.push(e.data),e.success(e.data)},update:function(e){groupProdList[e.data.id]=e.data,e.success()},destroy:function(e){groupProdList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"groupId",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},groupId:{type:"number"},name:{type:"string"}}}},error:function(e){alert("failed to load array",e.status)}}),groupProdFullDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(groupProdFullList)},create:function(e){e.data.id=groupProdFullList.length,groupProdFullList.push(e.data),e.success(e.data)},update:function(e){groupProdFullList[e.data.id]=e.data,e.success()},destroy:function(e){groupProdFullList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"groupId",dir:"asc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},groupId:{type:"number"},name:{type:"string"}}}},error:function(e){alert("failed to load array",e.status)}});var router=new kendo.Router({routeMissing:function(e){console.log("404"),router.navigate("/page404")},change:function(e){console.log(e.url)}});router.route("/",function(){layout.showIn("#page",loginPage)}),router.route("/login",function(){layout.showIn("#page",loginPage)}),router.route("/hub",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/loading",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",loadingPage):router.navigate("/login")}),router.route("/myproductions",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",prodListPage):router.navigate("/login")}),router.route("/production",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",productionPage):router.navigate("/login")}),router.route("/motifs",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",motifsPage):router.navigate("/login")}),router.route("/motifSelect",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",motifsSelectPage):router.navigate("/login")}),router.route("/prodCollection",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",prodColPage):router.navigate("/login")}),router.route("/prodCollection-replace",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",prodColPage):router.navigate("/login")}),router.route("/statistics",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",statisticsPage):router.navigate("/login")}),router.route("/logout",function(){layout.showIn("#page",logoutPage)}),router.route("/page404",function(){layout.showIn("#page",page404)}),router.route("/admin-hub",function(){0!=userAccount.get("loginStatus")?1==userAccount.get("groupId")?layout.showIn("#page",adminHubPage):layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/adm-accounts",function(){0!=userAccount.get("loginStatus")?1==userAccount.get("groupId")?layout.showIn("#page",admAccountsPage):layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/adm-groups",function(){0!=userAccount.get("loginStatus")?1==userAccount.get("groupId")?layout.showIn("#page",admGroupsPage):layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/adm-motif-types",function(){0!=userAccount.get("loginStatus")?1==userAccount.get("groupId")?layout.showIn("#page",admMotifTypePage):layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/adm-motif-types-edit",function(){0!=userAccount.get("loginStatus")?1==userAccount.get("groupId")?layout.showIn("#page",admMotifTypeEdit):layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/motifSelect-for-preview",function(){0!=userAccount.get("loginStatus")?1==userAccount.get("groupId")?layout.showIn("#page",motifPreviewSelectPage):layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/adm-audio",function(){0!=userAccount.get("loginStatus")?1==userAccount.get("groupId")?layout.showIn("#page",admAudioPage):layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/adm-audio-edit",function(){0!=userAccount.get("loginStatus")?1==userAccount.get("groupId")?layout.showIn("#page",admAudioEdit):layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/adm-products",function(){0!=userAccount.get("loginStatus")?1==userAccount.get("groupId")?layout.showIn("#page",admProductsPage):layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/adm-open-prods",function(){0!=userAccount.get("loginStatus")?1==userAccount.get("groupId")?layout.showIn("#page",admOpenProdsPage):layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/adm-finished-prods",function(){0!=userAccount.get("loginStatus")?1==userAccount.get("groupId")?layout.showIn("#page",admFinishedProdsPage):layout.showIn("#page",hubPage):router.navigate("/login")});var langPathArr=[{lang_path:"loc/en.json",lang_name:"en_loc"},{lang_path:"loc/de.json",lang_name:"de_loc"},{lang_path:"loc/tr.json",lang_name:"tr_loc"},{lang_path:"loc/ru.json",lang_name:"ru_loc"},{lang_path:"loc/pl.json",lang_name:"pl_loc"}];$(function(){templateLoader.loadExtTemplate(tplArr,function(){motifTemplate=kendo.template($("#motifTemplate").html()),filmTemplate=kendo.template($("#filmTemplate").html()),clipTemplate=kendo.template($("#clipTemplate").html()),clipProdTemplate=kendo.template($("#clipProdTemplate").html()),motifProdTemplate=kendo.template($("#motifProdTemplate").html()),initLocalizationData(function(){layout.render($("#application")),router.start(),localSelectInit(),$("#theme-select").length&&$("#theme-select").kendoDropDownList({change:onThemingChange}),$("#language-select").length&&$("#language-select").kendoDropDownList({change:onLangChange}),$("#page").on("touchstart click","#logout-btn",function(event){logOut(),event.preventDefault()})})});$("#window").kendoWindow(kendoWindowParams);$("body").on("touchend click",".popup-close , .k-overlay",function(event){curPopupCloseFunc()});var resizeTimer;$(window).resize(function(){clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){$("#window").data("kendoWindow").center()},100)})});var docCookies={getItem:function(sKey){return sKey?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(sKey,sValue,vEnd,sPath,sDomain,bSecure){if(!sKey||/^(?:expires|max\-age|path|domain|secure)$/i.test(sKey))return!1;var sExpires="";if(vEnd)switch(vEnd.constructor){case Number:sExpires=vEnd===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+vEnd;break;case String:sExpires="; expires="+vEnd;break;case Date:sExpires="; expires="+vEnd.toUTCString()}
return document.cookie=encodeURIComponent(sKey)+"="+encodeURIComponent(sValue)+sExpires+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"")+(bSecure?"; secure":""),!0},removeItem:function(sKey,sPath,sDomain){return!!this.hasItem(sKey)&&(document.cookie=encodeURIComponent(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:""),!0)},hasItem:function(sKey){return!!sKey&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var aKeys=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),nLen=aKeys.length,nIdx=0;nIdx<nLen;nIdx++)aKeys[nIdx]=decodeURIComponent(aKeys[nIdx]);return aKeys}};$(window).resize(function(){$(".k-grid").each(function(){$(this).data("kendoGrid").resize()})});