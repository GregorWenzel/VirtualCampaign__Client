function clearVariables(){motifsContentTypeList=[],motifsList=[],motifsDataSource.read(),filmsList=[],filmsDataSource.read(),ProductList=[],clipsDataSource.read(),dicativeList=[],clipsLocArr=[],motifsTypeNamArr=[],currClipsIds=[],currClipsList=[],currentProdClipsDataSource.read(),curMotifsList=[],currClipMotifsList=[],currentProdMotifsDataSource.read(),currentProduction.set("prodObj",defProductionParams),userAccount.set("loginStatus",0),userAccount.set("id",0),userAccount.set("groupId",0),userAccount.set("firstName","empty"),userAccount.set("surName","empty"),userAccount.set("inProduction",""),userAccount.set("curProduction",""),userAccount.set("productsVal",0),userAccount.set("motifsVal",0),userAccount.set("indicatives",-1),userAccount.set("abdicatives",-1),ProductionsStatArr=[],ProductUsageStatArr=[]}function toggleBtnStatus(btns,status){$(btns.selector).each(function(){$(this).data("kendoButton").enable(status)})}function countClipMotifs(callback){for(var i=0;i<motifsContentTypeList.length;i++)for(var j=0;j<ProductList.length;j++){if(motifsContentTypeList[i].productID==ProductList[j].clipId){ProductList[j].motifsNum++,ProductList[j].motifNamesString+=motifsContentTypeList[i].name+" ";break}ProductList[j].emptyMotifs=ProductList[j].motifsNum}clipsDataSource.read(),callback&&"function"==typeof callback&&callback()}function urlGen(method){var shaObj=new jsSHA(method,"TEXT"),hash=shaObj.getHash("SHA-1","HEX");return shaObj=new jsSHA(hash+SALTED,"TEXT"),hash=shaObj.getHash("SHA-1","HEX"),"/services/index_dev.php?pass="+hash+"&call="+method}function loginFunc(){var loginData=$("#login-form").serializeArray();$.ajax({type:"POST",url:urlGen("login"),cache:!1,data:loginData,success:function(data){var loginedUser=$.parseXML("<xmltag>"+data+"</xmltag>");$loginedUser=$(loginedUser),"0"==$loginedUser.find("Result").text()?($("#login-form .error-msg").fadeIn(300).delay(5e3).fadeOut(700),console.log("Wrong username or password"),router.navigate("/login")):"3"==$loginedUser.find("Result").text()?(console.log("Same user is already logged in"),router.navigate("/login")):"2"==$loginedUser.find("Result").text()&&(userAccount.set("id",$loginedUser.find("ID").text()),userAccount.set("groupId",$loginedUser.find("AccountGroupID").text()),userAccount.set("firstName",$loginedUser.find("Name1").text()),userAccount.set("surName",$loginedUser.find("Name2").text()),userAccount.set("indicatives",$loginedUser.find("Indicative").text()),userAccount.set("abdicatives",$loginedUser.find("Abdicative").text()),defProductionParams.name=currLang.NEW_PRODUCTION,currentProduction.set("name",currLang.NEW_PRODUCTION),getMotifListByAccount(),getFilmsByAccount(),getProductListByAccount(function(){getDicativesByAccount(function(){mergeProductsNDicatives(ProductList,dicativeList,function(){getContentTypeListByAccount(function(){countClipMotifs(),initSortingSelects(),(-1!=userAccount.get("indicatives")||-1!=userAccount.get("abdicatives"))&&productionManageFunc(function(){currClipMotifsList=[],populateProdMotifsArr(function(){checkEmptyMotifs(),currentProdMotifsDataSource.read(),currentProdClipsDataSource.read(),recalcProductionTime()})})})})})}),userAccount.set("loginStatus",1),router.navigate("/hub"),kendo.bind($("#hubPage"),userAccount))},error:function(jqXHR,textStatus,errorThrown){console.log("failed to connect"),console.log(jqXHR),console.log(textStatus),console.log(errorThrown),$("#login-form .error").prepend('<p class="cur-error">failed to send login request - '+textStatus+"</p>").find(".cur-error").fadeIn(300).delay(5e3).fadeOut(700,function(){$("#login-form .cur-error").remove()}),router.navigate("/login")}})}function getContentTypeListByAccount(callback){$.ajax({type:"POST",url:urlGen("getContentTypeListByAccount"),cache:!1,data:{accountGroupID:+userAccount.get("groupId")},success:function(data){var contentTypeData=$.parseXML("<xmltag>"+data+"</xmltag>");return $contentTypeData=$(contentTypeData),motifsContentTypeList=[],$contentTypeData.find("ContentType").each(function(){var curContentType={id:$(this).find("ID").text(),name:$(this).find("Name").text(),aspect:$(this).find("Aspect").text(),position:$(this).find("Position").text(),productID:$(this).find("ProductID").text()};motifsContentTypeList.push(curContentType)}),callback&&"function"==typeof callback&&callback(),motifsContentTypeList},error:function(data){console.log("can't get contentType list")}})}function getMotifListByAccount(callback){$.ajax({type:"POST",url:urlGen("getMotifListByAccount"),cache:!1,data:{accountID:+userAccount.get("id"),min_date:0},success:function(data){var motifData=$.parseXML("<xmltag>"+data+"</xmltag>");$motifData=$(motifData),motifsList=[];var itemID=0;return $motifData.find("Motif").each(function(){var curMotif={id:itemID++,motifId:+$(this).find("ID").text(),accountId:+$(this).find("AccountID").text(),name:$(this).find("Name").text(),frameCount:+$(this).find("FrameCount").text(),crTime:+$(this).find("CreationTime").text(),date:dateFormating(parseInt($(this).find("CreationTime").text())),description:$(this).find("Description").text()};motifsList.push(curMotif)}),userAccount.set("motifsVal",motifsList.length),motifsDataSource.read(),callback&&"function"==typeof callback&&callback(),motifsList},error:function(data){console.log("can't get motifs list")}})}function dataURItoBlob(dataURI){var byteString;byteString=dataURI.split(",")[0].indexOf("base64")>=0?atob(dataURI.split(",")[1]):unescape(dataURI.split(",")[1]);for(var mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],ia=new Uint8Array(byteString.length),i=0;i<byteString.length;i++)ia[i]=byteString.charCodeAt(i);return new Blob([ia],{type:mimeString})}function uploadMotifFunc(loadedMotif,callback){$("#motif-upload-form img").hide().attr("src",""),$("#saveMotifBtn").data("kendoButton").enable(!1),$("#motif-upload-form .img-wr p").show();var motifUploadData=new FormData;motifUploadData.append("accountID",+userAccount.get("id")),motifUploadData.append("extension",loadedMotif.type),motifUploadData.append("name",loadedMotif.name),motifUploadData.append("image_film_flag","image"),motifUploadData.append("Filedata",loadedMotif),""==$("#newMotifName").val()&&$("#newMotifName").val(loadedMotif.name),$("#motif-upload-form .img-wr p").text("image is loading"),$.ajax({type:"POST",url:urlGen("uploadMotif"),cache:!1,processData:!1,contentType:!1,data:motifUploadData,success:function(data){console.log("--/motif upload/--");var uploadData=$.parseXML("<xmltag>"+data+"</xmltag>");$uploadData=$(uploadData),uploadMotifObj={accountID:userAccount.get("id"),media_format_id:3,aspect:$uploadData.find("Aspect").text(),width:MAX_LOAD_IMG_WIDTH,fileName:$uploadData.find("Name").text()+".png",description:$("#descriptionValue").val(),frameCount:$uploadData.find("nFrames").text(),name:$("#newMotifName").val()},$("#motif-upload-form img").attr("src","http://www."+window.location.host+"/data/accounts/"+userAccount.get("id")+"/temp/"+uploadMotifObj.fileName).show(),$("#saveMotifBtn").data("kendoButton").enable(!0),$("#motif-upload-form .img-wr p").hide(),callback&&"function"==typeof callback&&callback()}})}function saveMotifFunc(callback){uploadMotifObj.name=$("#newMotifName").val(),uploadMotifObj.description=$("#descriptionValue").val(),$.ajax({type:"POST",url:urlGen("saveMotif"),cache:!1,data:uploadMotifObj,success:function(data){console.log("--/save motif/--"),getMotifListByAccount(function(){window.scrollTo(0,0)}),callback&&"function"==typeof callback&&callback()}})}function deleteMotifFunc(motifID,callback){deleteMotifObj={ownerID:+userAccount.get("id"),motifID:motifID,permanent:0},$.ajax({type:"POST",url:urlGen("deleteMotif"),cache:!1,data:deleteMotifObj,success:function(data){console.log("--/delete motif/--"),getMotifListByAccount(),callback&&"function"==typeof callback&&callback()}})}function getProductListByAccount(callback){$.ajax({type:"POST",url:urlGen("getShortProductListByAccount"),cache:!1,data:{accountGroupID:+userAccount.get("groupId")},success:function(data){var productData=$.parseXML("<xmltag>"+data+"</xmltag>");$productData=$(productData),ProductList=[];var itemID=0;$productData.find("Product").each(function(){var curProduct={id:itemID++,clipId:$(this).find("ID").text(),idString:to4DigitsSting($(this).find("ID").text()),name:$(this).find("Name").text(),location:$(this).find("Location").text(),motifNamesString:"",crTime:$(this).find("CreationTime").text(),date:dateFormating(parseInt($(this).find("CreationTime").text())),duration:$(this).find("Frames").text(),durTime:timeFormating(parseInt($(this).find("Frames").text())),motifsNum:0,emptyMotifs:0,locked:""};ProductList.push(curProduct)}),callback&&"function"==typeof callback&&callback()}})}function getDicativesByAccount(callback){$.ajax({type:"POST",url:urlGen("getDicativesByAccount"),cache:!1,data:{accountGroupID:+userAccount.get("groupId")},success:function(data){var dicativeData=$.parseXML("<xmltag>"+data+"</xmltag>");$dicativeData=$(dicativeData),dicativeList=[];var itemID=0;$dicativeData.find("Product").each(function(){var curProduct={id:itemID++,clipId:$(this).find("ID").text(),idString:to4DigitsSting($(this).find("ID").text()),name:$(this).find("Name").text(),location:$(this).find("Location").text(),motifNamesString:"",crTime:$(this).find("CreationTime").text(),date:dateFormating(parseInt($(this).find("CreationTime").text())),duration:$(this).find("Frames").text(),durTime:timeFormating(parseInt($(this).find("Frames").text())),motifsNum:0,emptyMotifs:0};dicativeList.push(curProduct)}),callback&&"function"==typeof callback&&callback()}})}function mergeProductsNDicatives(baseArray,extArray,callback){for(var overlapFlag=!1,newArr=[],i=0;i<extArray.length;i++){for(var j=0;j<baseArray.length;j++)if(extArray[i].clipId==baseArray[j].clipId){overlapFlag=!0;break}1!=overlapFlag?newArr.push(extArray[i]):overlapFlag=!1}$.merge(baseArray,newArr),callback&&"function"==typeof callback&&callback()}function getFilmsByAccount(callback){$.ajax({type:"POST",url:urlGen("getFilmsByAccount"),cache:!1,data:{accountID:+userAccount.get("id"),min_date:0},success:function(data){var filmData=$.parseXML("<xmltag>"+data+"</xmltag>");$filmData=$(filmData),filmsList=[];var itemID=0;$filmData.find("Film").each(function(){var curFilm={id:itemID++,filmId:+$(this).find("ID").text(),accountId:$(this).find("Owner").text(),jobId:$(this).find("jobID").text(),name:$(this).find("Name").text(),crTime:$(this).find("Date").text(),crDate:dateFormating(parseInt($(this).find("Date").text())),duration:$(this).find("Duration").text(),durTime:timeFormating(parseInt($(this).find("Duration").text())),videoFiles:codecFormatsToArray($(this).find("codecFormats").text(),$(this).find("size").text()),products:$(this).find("Products").text(),motifs:$(this).find("Motifs").text()};filmsList.push(curFilm)}),userAccount.set("productsVal",filmsList.length),filmsDataSource.read(),callback&&"function"==typeof callback&&callback()}})}function deleteFilmFunc(FilmId,callback){$.ajax({type:"POST",url:urlGen("deleteFilm"),cache:!1,data:{filmID:+FilmId,permanent:0},success:function(data){console.log("--/delete film/--"),getFilmsByAccount(function(){}),callback&&"function"==typeof callback&&callback()}})}function createSingleProductionFunc(prodObj,callback){$.ajax({type:"POST",url:urlGen("createSingleProduction"),cache:!1,data:prodObj,success:function(data){console.log("--/create new production/--");var filmData=$.parseXML("<xmltag>"+data+"</xmltag>");$filmData=$(filmData),$filmData.find("FilmID").length?userAccount.set("lastProdId",$filmData.find("FilmID").text()):console.log("production send failed"),callback&&"function"==typeof callback&&callback()}})}function logOut(){$.ajax({type:"POST",url:urlGen("logout"),cache:!1,data:{accountID:userAccount.get("id")},success:function(data){console.log("--/logout/--"),clearVariables(),router.navigate("/logout")}})}function checkProductionStatus(callback){$.ajax({type:"POST",url:urlGen("checkProductionStatus"),cache:!1,data:{userID:+userAccount.get("id"),filmIDs:+userAccount.get("lastProdId")},success:function(data){var filmData=$.parseXML("<xmltag>"+data+"</xmltag>");if($filmData=$(filmData),1!=$filmData.find("Result").text())setTimeout(checkProductionStatus(),2e3);else{var inProdNum=userAccount.get("inProductionNum");userAccount.set("inProductionNum",--inProdNum),inProdNum>0?userAccount.set("inProduction",inProdNum+" "+currLang.inProduction):userAccount.set("inProduction",""),getFilmsByAccount(function(){setTimeout(function(){filmsDataSource.read()},500)})}callback&&"function"==typeof callback&&callback()}})}function dateFormating(miliseconds){var d=new Date(1e3*miliseconds);return d.toLocaleDateString()+" - "+to2DigitsSting(d.getHours())+":"+to2DigitsSting(d.getMinutes())+"h"}function timeFormating(videoFramesNum){if(0==videoFramesNum)return"00:00 min";var totalSeconds=Math.floor(videoFramesNum/constFPS),minutes=Math.floor(totalSeconds%3600/60);minutes=to2DigitsSting(minutes);var seconds=Math.floor(totalSeconds%60-1);return seconds=to2DigitsSting(seconds),minutes+":"+seconds+" min"}function timeFormatingFromClipsArr(framesArr){if(0==framesArr.length)return"00:00 min";for(var totalSeconds=0,i=0;i<framesArr.length;i++)framesArr[i]=Math.floor(framesArr[i]/constFPS)-1,totalSeconds+=framesArr[i];var minutes=Math.floor(totalSeconds%3600/60);minutes=to2DigitsSting(minutes);var seconds=Math.floor(totalSeconds%60);return seconds=to2DigitsSting(seconds),minutes+":"+seconds+"min"}function to2DigitsSting(number){return number="0"+number,number.slice(-2)}function to4DigitsSting(number){return number="000"+number,number.slice(-4)}function codecFormatsToArray(codecString,sizeString){for(var itemSize,codecArray=codecString.split("+"),sizeArray=sizeString.split("."),i=0;i<codecArray.length;i++)codecArray[i]=codecArray[i].split(":"),itemSize=parseInt(sizeArray[i])/1e6,codecArray[i][2]=itemSize.toFixed(2),codecArray[i][0]=codecArray[i][0].toLowerCase();return codecArray}function stringToArray(curString){for(var resultArray=curString.split("."),i=0;i<resultArray.length;i++)resultArray[i]=resultArray[i].split(",");return resultArray}function prodStringToArray(curString){var resultArray=curString.split(",");return resultArray}function motifsArrayToString(curArray){for(var resultString="",i=0;i<curArray.length;i++){for(var tmpStr="",j=0;j<curArray[i].length;j++)tmpStr+="0"!=curArray[i][j]?curArray[i][j]+",":"-1,";0==curArray[i].length&&(tmpStr+="-1,"),tmpStr=tmpStr.substr(0,tmpStr.length-1),resultString+=tmpStr+"."}return resultString=resultString.substr(0,resultString.length-1)}function codecFormatsToString(curArray){for(var resultString="",i=0;i<curArray.length;i++)resultString+=curArray[i]+"+";return resultString=resultString.substr(0,resultString.length-1)}function previewFramesStringFunc(curArray){for(var resultString="",i=0;i<curArray.length;i++)resultString+="0,";return resultString=resultString.substr(0,resultString.length-1)}function clipsDurationTotalTime(curArray){for(var framesSum=0,i=0;i<curArray.length;i++)framesSum+=curArray[i].duration;return timeFormating(framesSum)}function clipsDurationToString(curArray){var tpmArr=[],indDur=0,resultString=0,abdDur=0,startCount=0,endCount=curArray.length;-1!=userAccount.get("indicatives")&&startCount++,-1!=userAccount.get("abdicatives")&&endCount--;for(var i=0;i<curArray.length;i++)for(var j=0;j<ProductList.length;j++)if(curArray[i]==ProductList[j].clipId){tpmArr[i]=+ProductList[j].duration;break}for(var i=startCount;endCount>i;i++)resultString+=tpmArr[i];return-1!=userAccount.get("indicatives")&&(indDur=curArray[0]),-1!=userAccount.get("abdicatives")&&(abdDur=curArray[endCount]),resultString=indDur+"."+resultString+"."+abdDur}function clipsArrayToString(curArray){for(var resultString="",i=0;i<curArray.length;i++)resultString+=curArray[i]+",";return resultString=resultString.substr(0,resultString.length-1)}function productTypesFunc(curArray){for(var resultString="",i=0;i<curArray.length;i++)resultString+="0,";return resultString=resultString.substr(0,resultString.length-1)}function motifFramesFunc(curArray){for(var resultString="",i=0;i<curArray.length;i++){for(var tmpStr="",j=0;j<curArray[i].length;j++)for(var z=0;z<motifsList.length;z++)if(curArray[i][j]==motifsList[z].motifId){tmpStr+=motifsList[z].frameCount+",";break}0==curArray[i].length&&(tmpStr+="-1,"),tmpStr=tmpStr.substr(0,tmpStr.length-1),resultString+=tmpStr+"."}return resultString=resultString.substr(0,resultString.length-1)}function getProductionClipIds(){for(var resultArray=[],i=0;i<currClipsList.length;i++)resultArray[i]=currClipsList[i].clipId;return resultArray}function getProductionMotifIds(){for(var resultArray=[],i=0;i<curMotifsList.length;i++){for(var tmpArr=[],j=0;j<curMotifsList[i].length;j++)tmpArr[j]=curMotifsList[i][j].motifId;resultArray[i]=tmpArr}return resultArray}function saveProdPopupFunc(){$("#production-save-form #newProdNameInput").val(currentProduction.get("prodObj.name"))}function applySaveProdFunc(){console.log("save PRODUCTION"),currentProduction.set("prodObj.clips",getProductionClipIds()),currentProduction.set("prodObj.motifs",getProductionMotifIds());var newProdObj={indicatives:+userAccount.get("indicatives"),abdicatives:+userAccount.get("abdicatives"),motifIDs:motifsArrayToString(currentProduction.get("prodObj.motifs")),durationTime:0,codecFormats:"none",products:clipsArrayToString(currentProduction.get("prodObj.clips")),user:+userAccount.get("id"),jobName:$("#production-save-form #newProdNameInput").val(),template:1};userAccount.set("curProduction",newProdObj.jobName),currentProduction.set("prodObj.name",newProdObj.jobName),createSingleProductionFunc(newProdObj,function(){getFilmsByAccount(function(){filmsDataSource.read()})});var curPopup=$("[data-role=window]");curPopup.kendoWindow("close"),curPopup.parent().removeClass(winClass)}function produceProdPopupFunc(){console.log("produce prod popup"),kendo.bind($("#produce-form"),codecFormatsObj)}function applyProduceProdFunc(){console.log("produce PRODUCTION"),currentProduction.set("prodObj.clips",getProductionClipIds()),currentProduction.set("prodObj.motifs",getProductionMotifIds());var newProdObj={indicatives:+userAccount.get("indicatives"),abdicatives:+userAccount.get("abdicatives"),companyID:+userAccount.get("groupId"),motifFrames:motifFramesFunc(currentProduction.get("prodObj.motifs")),durations:"",jobName:codecFormatsObj.get("jobNameField"),codecFormats:codecFormatsToString(codecFormatsObj.get("codecFormatsArr")),previewFrames:previewFramesStringFunc(currentProduction.get("prodObj.clips")),motifIDs:motifsArrayToString(currentProduction.get("prodObj.motifs")),specialIntroMusic:0,durationTime:clipsDurationToString(currentProduction.get("prodObj.clips")),status:0,template:0,user:+userAccount.get("id"),audioParam:"stroeer.wav",products:clipsArrayToString(currentProduction.get("prodObj.clips")),productTypes:productTypesFunc(currentProduction.get("prodObj.clips")),email:codecFormatsObj.get("userEmailField")};userAccount.set("curProduction",newProdObj.jobName),currentProduction.set("prodObj.name",newProdObj.jobName),createSingleProductionFunc(newProdObj,function(){var inProdNum=userAccount.get("inProductionNum");userAccount.set("inProductionNum",++inProdNum),userAccount.set("inProduction",inProdNum+" "+currLang.inProduction),currentProduction.set("prodObj",newProdObj.jobName),checkProductionStatus();var curPopup=$("[data-role=window]");curPopup.kendoWindow("close"),curPopup.parent().removeClass(winClass),$("#new-prod-dialog-btn").trigger("click")})}function logOutAfterProduce(){var curPopup=$("[data-role=window]");curPopup.kendoWindow("close"),curPopup.parent().removeClass(winClass),logOut()}function goHubAfterProduce(){var curPopup=$("[data-role=window]");curPopup.kendoWindow("close"),curPopup.parent().removeClass(winClass),router.navigate("/hub")}function initStatisticTime(callback){var curTime=Math.floor((new Date).getTime()/1e3),strStartTime=new Date,strEndTime=new Date;strStartTime.setTime(strEndTime.getTime()-2592e6),strStartTime.setSeconds(1),strStartTime.setMinutes(0),strStartTime.setHours(0),statisticUser.set("userName",userAccount.get("firstName")+" "+userAccount.get("surName")),statisticUser.set("statEndDate",curTime),statisticUser.set("statStartDate",Math.floor(strStartTime.getTime()/1e3)),statisticUser.set("statStartDateString",strStartTime.toLocaleDateString()),statisticUser.set("statEndDateString",strEndTime.toLocaleDateString()),callback&&"function"==typeof callback&&callback()}function initCharts(){ProductionsTableData=new google.visualization.DataTable,ProductionsTableData.addColumn("string",currLang.DROPDOWN_DATE),ProductionsTableData.addColumn("number",currLang.FCPD_FilmsHeader),ProductionsTableData.addColumn("number",currLang.FCPD_ClipsHeader),ProductionsTableData.addRows(ProductionsStatArr),ProductionsView=new google.visualization.DataView(ProductionsTableData),ProductionsView.setColumns([0,1,2]),ProductionsTable=new google.visualization.Table(document.getElementById("ProductionsTable")),ProductionsTable.draw(ProductionsTableData,{showRowNumber:!1});var optionsProductionsChart={width:$("#ProductionsChart").width()-16,height:300,legend:{position:"top",maxLines:10},bar:{groupWidth:"75%"},isStacked:!0,chartArea:{width:"80%",height:"75%"}};ProductionsChart=new google.visualization.ColumnChart(document.getElementById("ProductionsChart")),ProductionsChart.draw(ProductionsTableData,optionsProductionsChart),google.visualization.events.addListener(ProductionsTable,"sort",function(event){ProductionsTableData.sort([{column:event.column,desc:!event.ascending}]),ProductionsChart.draw(ProductionsView,optionsProductionsChart)}),ProductUsageTableData=new google.visualization.DataTable,ProductUsageTableData.addColumn("string",currLang.DROPDOWN_NAME),ProductUsageTableData.addColumn("number",currLang.count),ProductUsageTableData.addRows(ProductUsageStatArr),ProductUsageView=new google.visualization.DataView(ProductUsageTableData),ProductUsageView.setColumns([0,1]),ProductUsageTable=new google.visualization.Table(document.getElementById("ProductUsageTable")),ProductUsageTable.draw(ProductUsageTableData,{showRowNumber:!1});var optionsProductUsageChart={width:$("#ProductUsageChart").width(),height:300,chartArea:{width:"90%",height:"90%"}};ProductUsageChart=new google.visualization.PieChart(document.getElementById("ProductUsageChart")),ProductUsageChart.draw(ProductUsageTableData,optionsProductUsageChart),google.visualization.events.addListener(ProductUsageTable,"sort",function(event){ProductUsageTableData.sort([{column:event.column,desc:!event.ascending}]),ProductUsageChart.draw(ProductUsageView,optionsProductUsageChart)})}function getStatisticsFunc(callback){$.ajax({type:"POST",url:urlGen("getStatistics"),data:{StartDate:+statisticUser.get("statStartDate"),EndDate:+statisticUser.get("statEndDate"),AccountID:+userAccount.get("id")},success:function(data){console.log("--/statistic/--");var statisticData=$.parseXML("<xmltag>"+data+"</xmltag>");$statisticData=$(statisticData);var tmpFilmCount=0,tmpClipCount=0;ProductionsStatArr=[],ProductUsageStatArr=[],$statisticData.find("AssetCount").each(function(){var AssetCount=[{v:$(this).find("Timestamp").text(),f:$(this).find("Date").text()},{v:+$(this).find("FilmCount").text(),f:$(this).find("FilmCount").text()},{v:+$(this).find("ClipCount").text(),f:$(this).find("ClipCount").text()}];ProductionsStatArr.push(AssetCount),tmpFilmCount+=parseInt($(this).find("FilmCount").text()),tmpClipCount+=parseInt($(this).find("ClipCount").text())}),$statisticData.find("ProductUsage").each(function(){var ProductUsage=[$(this).find("Name").text(),{v:+$(this).find("Count").text(),f:$(this).find("Count").text()}];ProductUsageStatArr.push(ProductUsage)}),statisticUser.set("TotalFilmCount",$statisticData.find("TotalFilmCount").text()),statisticUser.set("TotalClipCount",$statisticData.find("TotalClipCount").text()),statisticUser.set("TimespanFilmCount",tmpFilmCount),statisticUser.set("TimespanClipCount",tmpClipCount),callback&&"function"==typeof callback&&callback()},error:function(data){console.log("can't get statistic")}})}function initDatepickers(){var start=$("#startDate").data("kendoDatePicker"),end=$("#endDate").data("kendoDatePicker");start.max(end.value()),end.min(start.value())}function startDateChange(){var start=$("#startDate").data("kendoDatePicker"),end=$("#endDate").data("kendoDatePicker"),startDate=start.value(),endDate=end.value();startDate?(startDate=new Date(startDate),startDate.setDate(startDate.getDate()),end.min(startDate)):endDate?start.max(new Date(endDate)):(endDate=new Date,start.max(endDate),end.min(endDate))}function endDateChange(){var start=$("#startDate").data("kendoDatePicker"),end=$("#endDate").data("kendoDatePicker"),startDate=start.value(),endDate=end.value();endDate?(endDate=new Date(endDate),endDate.setDate(endDate.getDate()),start.max(endDate)):startDate?end.min(new Date(startDate)):(endDate=new Date,start.max(endDate),end.min(endDate))}function setToday(){var startDate=new Date,endDate=new Date;startDate.setSeconds(1),startDate.setMinutes(0),startDate.setHours(0);var startDatepicker=$("#startDate").data("kendoDatePicker"),endDatepicker=$("#endDate").data("kendoDatePicker");startDatepicker.max(new Date(2100,0,1)),endDatepicker.min(new Date(1999,0,1)),startDatepicker.value(startDate),endDatepicker.value(endDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),statisticUser.set("statEndDateString",endDate.toLocaleDateString())}function setThisMonth(){var startDate=new Date,endDate=new Date;startDate.setSeconds(1),startDate.setMinutes(0),startDate.setHours(0),startDate.setDate(1);var startDatepicker=$("#startDate").data("kendoDatePicker"),endDatepicker=$("#endDate").data("kendoDatePicker");startDatepicker.max(new Date(2100,0,1)),endDatepicker.min(new Date(1999,0,1)),startDatepicker.value(startDate),endDatepicker.value(endDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),statisticUser.set("statEndDateString",endDate.toLocaleDateString())}function setLastMonth(){var startDate=new Date,endDate=new Date;startDate.setSeconds(1),startDate.setMinutes(0),startDate.setHours(0),startDate.setDate(1),startDate.setMonth(endDate.getMonth()-1),endDate.setSeconds(59),endDate.setMinutes(59),endDate.setHours(23),endDate.setDate(0);var startDatepicker=$("#startDate").data("kendoDatePicker"),endDatepicker=$("#endDate").data("kendoDatePicker");startDatepicker.max(new Date(2100,0,1)),endDatepicker.min(new Date(1999,0,1)),startDatepicker.value(startDate),endDatepicker.value(endDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),statisticUser.set("statEndDateString",endDate.toLocaleDateString())}function setThisYear(){var startDate=new Date,endDate=new Date;startDate.setSeconds(1),startDate.setMinutes(0),startDate.setHours(0),startDate.setDate(1),startDate.setMonth(0);var startDatepicker=$("#startDate").data("kendoDatePicker"),endDatepicker=$("#endDate").data("kendoDatePicker");startDatepicker.max(new Date(2100,0,1)),endDatepicker.min(new Date(1999,0,1)),startDatepicker.value(startDate),endDatepicker.value(endDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),statisticUser.set("statEndDateString",endDate.toLocaleDateString())}function setLastYear(){var startDate=new Date,endDate=new Date;startDate.setSeconds(1),startDate.setMinutes(0),startDate.setHours(0),startDate.setDate(1),startDate.setMonth(0),startDate.setFullYear(endDate.getFullYear()-1),endDate.setSeconds(59),endDate.setMinutes(59),endDate.setHours(23),endDate.setDate(1),endDate.setMonth(0);var startDatepicker=$("#startDate").data("kendoDatePicker"),endDatepicker=$("#endDate").data("kendoDatePicker");startDatepicker.max(new Date(2100,0,1)),endDatepicker.min(new Date(1999,0,1)),startDatepicker.value(startDate),endDatepicker.value(endDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),statisticUser.set("statEndDateString",endDate.toLocaleDateString())}function setTimespan(){var start=$("#startDate").data("kendoDatePicker"),end=$("#endDate").data("kendoDatePicker"),startDate=start.value(),endDate=end.value();startDate&&endDate?(startDate=new Date(startDate),statisticUser.set("statStartDateString",startDate.toLocaleDateString()),startDate=Math.floor(startDate.getTime()/1e3),endDate=new Date(endDate),statisticUser.set("statEndDateString",endDate.toLocaleDateString()),endDate=Math.floor(endDate.getTime()/1e3)+86399,statisticUser.set("statStartDate",startDate),statisticUser.set("statEndDate",endDate),getStatisticsFunc(function(){initCharts();var curPopup=$("[data-role=window]");curPopup.kendoWindow("close"),curPopup.parent().removeClass(winClass)})):alert("Enter both values")}function exportStatistics(){function genProductionCsv(){var resultString="",clipsArr=[],motifsArr=[];clipsArr=prodStringToArray(curProdItem.products).slice(),motifsArr=stringToArray(curProdItem.motifs).slice(),resultString+=curProdItem.crDate+";"+curProdItem.name+";"+userAccount.get("surName")+";\n";for(var i=0;i<clipsArr.length;i++){resultString+=";;;"+(i+1)+";";for(var j=0;j<ProductList.length;j++){if(clipsArr[i]==ProductList[j].clipId){resultString+=ProductList[j].name+";\n";break}j==ProductList.length-1&&(resultString+=clipsArr[i]+" was deleted;\n")}for(var j=0;j<motifsArr[i].length;j++){if(-1==motifsArr[i][j]){resultString+=";;;;;Indicativ;\n";break}resultString+=";;;;;"+(j+1)+";";for(var z=0;z<motifsContentTypeList.length;z++)if(clipsArr[i]==motifsContentTypeList[z].productID&&j+1==motifsContentTypeList[z].position){resultString+=motifsContentTypeList[z].name+";";break}for(var z=0;z<motifsList.length;z++){if(motifsArr[i][j]==motifsList[z].motifId){resultString+=motifsList[z].name+";\n";break}z==motifsList.length-1&&(resultString+=motifsArr[i][j]+" was deleted;\n")}}}return resultString}var csvContent="",curDate=new Date,startDate=new Date(1e3*statisticUser.get("statStartDate")),endDate=new Date(1e3*statisticUser.get("statEndDate"));crStatProdictionsIdArr(statisticUser.get("statStartDate"),statisticUser.get("statEndDate")),csvContent+="Report date:;",csvContent+=curDate.toLocaleDateString()+" - "+curDate.toLocaleTimeString()+";",csvContent+="Date Range:"+startDate.toLocaleDateString()+" - "+startDate.toLocaleTimeString()+" to "+endDate.toLocaleDateString()+" - "+endDate.toLocaleTimeString()+";\n\n",csvContent+="Total Films;Total Clips;\n"+statisticUser.get("TotalFilmCount")+";"+statisticUser.get("TotalClipCount")+";\n",csvContent+="Films in date range;Clips in date range;\n"+statisticUser.get("TimespanFilmCount")+";"+statisticUser.get("TimespanClipCount")+";\n",csvContent+="Production Date;Production Name;Account Name;Clip Counter;Clip Name;Motif Counter;Motif Type;Motif Name;\n";for(var i=0;i<prodCrTimeArr.length;i++){for(var curProdItem={},resultString="",j=0;j<filmsList.length;j++)if(prodCrTimeArr[i]==filmsList[j].crTime){var curProdItem=$.extend(!0,{},filmsList[j]);resultString=genProductionCsv();break}csvContent+=resultString}csvContent+="\nProduct;nClipS;\n";for(var i=0;i<ProductUsageStatArr.length;i++)csvContent+=ProductUsageStatArr[i][0]+";"+ProductUsageStatArr[i][1].v+";\n";var encodedUri=encodeURIComponent(csvContent),$link=$("#dataLink");$link.attr("href","data:Application/octet-stream,"+encodedUri),$link.attr("download","joblog_"+userAccount.get("id")+".csv"),$link[0].click()}function crStatProdictionsIdArr(startTime,endTime){prodCrTimeArr=[];for(var startPos=0,endPos=0,j=0;j<filmsList.length;j++)filmsList[j].duration>0&&prodCrTimeArr.push(+filmsList[j].crTime);prodCrTimeArr.sort();for(var j=0;j<prodCrTimeArr.length;j++)startTime>prodCrTimeArr[j]&&++startPos,endTime>=prodCrTimeArr[j]&&++endPos;prodCrTimeArr.splice(endPos,prodCrTimeArr.length),prodCrTimeArr.splice(0,startPos)}function initSortingSelects(){clipsLocArr=[];for(var locArr=[],i=0;i<ProductList.length;i++)locArr.push(ProductList[i].location);clipsLocArr.push("All");for(var i=0;i<locArr.length;i++){for(var counter=0,j=0;j<clipsLocArr.length&&locArr[i]!=clipsLocArr[j];j++)counter++;
counter==clipsLocArr.length&&clipsLocArr.push(locArr[i])}motifsTypeNamArr=[];for(var nameArr=[],i=0;i<motifsContentTypeList.length;i++)nameArr.push(motifsContentTypeList[i].name);motifsTypeNamArr.push("All");for(var i=0;i<nameArr.length;i++){for(var counter=0,j=0;j<motifsTypeNamArr.length&&nameArr[i]!=motifsTypeNamArr[j];j++)counter++;counter==motifsTypeNamArr.length&&motifsTypeNamArr.push(nameArr[i])}var clipsSortingField=[{text:currLang.DROPDOWN_DEFAULT,value:"id"},{text:currLang.DROPDOWN_NAME,value:"name"}];clipsFilterModel=kendo.observable({locationArr:clipsLocArr,motifNamesArr:motifsTypeNamArr,sortSelect:clipsSortingField});var sortingFields=[{text:currLang.DROPDOWN_DATE,value:"crTime"},{text:currLang.DROPDOWN_NAME,value:"name"}];motifFilterModel=kendo.observable({selectFields:sortingFields}),filmFilterModel=kendo.observable({selectFields:sortingFields})}function loginCheckFunc(){$("#login-form #username").val().length>0&&$("#login-form #password").val().length>0?loginFunc():$("#login-form .error-empty-msg").fadeIn(300).delay(5e3).fadeOut(700)}function onSelectFilterMotifs(e){var dataItem=this.dataItem(e.item),sortingDirection="asc";"crTime"==dataItem.value&&(sortingDirection="desc"),motifsDataSource.query({sort:[{field:dataItem.value,dir:sortingDirection}]}),bindEnterFunc($("#applyMotifBtn"),!1),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)}function motifListViewChangeFunc(){toggleBtnStatus(deleteMotifBtn,!0),toggleBtnStatus(applyMotifBtn,!0);var data=this.dataSource.view();selectedMotifUid=$.map(this.select(),function(item){return data[$(item).index()].uid}),selectedMotifId=$.map(this.select(),function(item){return data[$(item).index()].motifId}),$("#applyMotifBtn").parent(".visible").length&&this.select().length>0&&bindEnterFunc($("#applyMotifBtn"),!0)}function apllyDeleteMotifFunc(){for(var i=0;i<selectedMotifUid.length;i++){var curDelItem=motifsDataSource.getByUid(selectedMotifUid[i]);motifsDataSource.remove(curDelItem),deleteMotifFunc(selectedMotifId[i])}var curPopup=$("[data-role=window]");curPopup.kendoWindow("close"),curPopup.parent().removeClass(winClass),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)}function deleteMotifPopupFunc(){$("#curr-motif-name").length&&(1==selectedMotifUid.length?$("#curr-motif-name").text(motifsDataSource.getByUid(selectedMotifUid[0]).name+" "+currLang.MOTIF_SINGLEsm):selectedMotifUid.length>1&&$("#curr-motif-name").text(selectedMotifUid.length+" "+currLang.MOTIF_MULTIPLEsm))}function uploadMotifPopupFunc(){console.log("uploadMotifPopupFunc"),$("#motif-upload-form .img-wr p").show(),$("#saveMotifBtn").data("kendoButton").enable(!1),setTimeout(function(){$("#upload-input").on("change",function(){var loadedMotif=this.files[0];uploadMotifFunc(loadedMotif,function(){$("#saveMotifBtn").data("kendoButton").enable(!0)})})},200)}function applySaveMotifFunc(){console.log("save motif"),saveMotifFunc();var curPopup=$("[data-role=window]");curPopup.kendoWindow("close"),curPopup.parent().removeClass(winClass)}function searchMotifFunc(){searchVal=$("#motif-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(motifsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#motif-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(motifsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#motif-search-clear").addClass("hidden")),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)}function initMotifSearch(){searchVal=$("#motif-search-field").val(),prevSearchVal=searchVal,$("#motif-search-field")&&$("#motif-search-field").on("keyup",this,function(){searchMotifFunc()})}function clearMotifsFilter(){motifsDataSource.query({filter:{field:"name",operator:"contains",value:""}}),$("#motif-search-clear").addClass("hidden"),$("#motif-search-field").val(""),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)}function filmsListViewChangeFunc(){toggleBtnStatus(filmsBtnsToDisable,!0);var data=this.dataSource.view();selectedFilmUid=$.map(this.select(),function(item){return data[$(item).index()].uid}),selectedFilmId=$.map(this.select(),function(item){return data[$(item).index()].filmId}),null!=selectedFilmUid&&1==selectedFilmUid.length&&"none"==filmsDataSource.getByUid(selectedFilmUid[0]).videoFiles[0][0]&&toggleBtnStatus($("#downloadFilm"),!1),selectedFilmUid.length>1&&(toggleBtnStatus($("#loadFilm"),!1),toggleBtnStatus($("#downloadFilm"),!1)),$(".html5lightbox-link").html5lightbox()}function onSelectFilterFilms(e){var dataItem=this.dataItem(e.item),sortingDirection="asc";"crTime"==dataItem.value&&(sortingDirection="desc"),filmsDataSource.query({sort:[{field:dataItem.value,dir:sortingDirection}]}),toggleBtnStatus(filmsBtnsToDisable,!0)}function applyDeleteFilmFunc(){for(var i=0;i<selectedFilmUid.length;i++){var curDelItem=filmsDataSource.getByUid(selectedFilmUid[i]);filmsDataSource.remove(curDelItem),deleteFilmFunc(selectedFilmId[i])}var curPopup=$("[data-role=window]");curPopup.kendoWindow("close"),curPopup.parent().removeClass(winClass),toggleBtnStatus(filmsBtnsToDisable,!1)}function deleteFilmPopupFunc(){$("#curr-film-name").length&&(1==selectedFilmUid.length?$("#curr-film-name").text(currLang.PRODUCTION_SINGLE+" "+filmsDataSource.getByUid(selectedFilmUid[0]).name):selectedFilmUid.length>1&&$("#curr-film-name").text(selectedFilmUid.length+" "+currLang.PRODUCTION_MULTIPLE))}function downloadFilmPopupFunc(){var downloadList=$(".download-list"),listContent="",curFilm=filmsDataSource.getByUid(selectedFilmUid);if(downloadList.length&&"none"!=curFilm.videoFiles[0][0]){for(var i=0;i<curFilm.videoFiles.length;i++){var videoUrl=window.location.origin+"/data/accounts/"+curFilm.accountId+"/productions/"+curFilm.filmId+"/film_"+curFilm.filmId+"_"+curFilm.videoFiles[i][1]+"."+curFilm.videoFiles[i][0];listContent+='<li><a href="'+videoUrl+'" download="'+curFilm.name+"_"+curFilm.videoFiles[i][1]+'">'+curFilm.name+"_"+curFilm.videoFiles[i][1]+"."+curFilm.videoFiles[i][0]+" - "+curFilm.videoFiles[i][2]+" MB</a></li>"}$(downloadList).html(listContent)}else $(downloadList).html("<li>This production is not yet sent to produce</li>")}function loadProdDialogFunc(){var curItem=filmsDataSource.getByUid(selectedFilmUid);console.log("----/current film/----"),$("#curr-film-name").text(curItem.name)}function loadProdFunc(){var curItem=filmsDataSource.getByUid(selectedFilmUid);currentProduction.set("prodObj.name",curItem.name),currentProduction.set("prodObj.durTime",curItem.durTime),currentProduction.set("prodObj.clips",prodStringToArray(curItem.products)),currentProduction.set("prodObj.motifs",stringToArray(curItem.motifs)),userAccount.set("curProduction",curItem.name);var curPopup=$("[data-role=window]");curPopup.kendoWindow("close"),curPopup.parent().removeClass(winClass),router.navigate("/production"),productionManageFunc(function(){currClipMotifsList=[],populateProdMotifsArr(function(){checkEmptyMotifs(),currentProdMotifsDataSource.read(),currentProdClipsDataSource.read(),recalcProductionTime(),$(".html5lightbox-link").html5lightbox()})})}function newProdDialogFunc(){console.log("NEW PRODUCTION"),currentProduction.set("prodObj",defProductionParams),userAccount.set("curProduction",defProductionParams.name);var curPopup=$("[data-role=window]");curPopup.kendoWindow("close"),curPopup.parent().removeClass(winClass),router.navigate("/production"),toggleBtnStatus(productionBtnsToDisable,!1),productionManageFunc(function(){currClipMotifsList=[],populateProdMotifsArr(function(){checkEmptyMotifs(),currentProdMotifsDataSource.read(),currentProdClipsDataSource.read()})})}function searchFilmFunc(){searchVal=$("#film-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(filmsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#film-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(filmsDataSource.query({filter:{field:"name",operator:"contains",value:searchVal}}),prevSearchVal=searchVal,$("#film-search-clear").removeClass("hidden")),toggleBtnStatus(filmsBtnsToDisable,!1)}function initFilmsSearch(){searchVal=$("#film-search-field").val(),prevSearchVal=searchVal,$("#film-search-field")&&$("#film-search-field").on("keyup",this,function(){searchFilmFunc()})}function clearFilmsFilter(){filmsDataSource.query({filter:{field:"name",operator:"contains",value:""}}),$("#film-search-clear").addClass("hidden"),$("#film-search-field").val(""),toggleBtnStatus(filmsBtnsToDisable,!1)}function clipsListViewChangeFunc(){toggleBtnStatus(applyClipBtn,!0);var data=this.dataSource.view();selectedProductUid=$.map(this.select(),function(item){return data[$(item).index()].uid}),selectedProductId=$.map(this.select(),function(item){return data[$(item).index()].clipId}),$(".html5lightbox-link").html5lightbox(),this.select().length>0&&bindEnterFunc($("#applyClipBtn"),!0)}function onSelectFilterClips1(e){var select1field,select2field,select1val=e.item.text(),select2val=$("#filterClipsSelect2").data("kendoDropDownList").value(),select3val=$("#filterClipsSelect3").data("kendoDropDownList").value(),searchField={field:"name",operator:"contains",value:$("#clip-search-field").val()};select1field="All"!=select1val?{field:"location",operator:"contains",value:select1val}:{field:"location",operator:"neq",value:select1val},select2field="All"!=select2val?{field:"motifNamesString",operator:"contains",value:select2val}:{field:"motifNamesString",operator:"neq",value:select2val},clipsDataSource.query({filter:{logic:"and",filters:[select1field,select2field,searchField]},sort:[{field:select3val,dir:"asc"}]}),toggleBtnStatus(applyClipBtn,!1)}function onSelectFilterClips2(e){var select1field,select2field,select1val=$("#filterClipsSelect1").data("kendoDropDownList").value(),select2val=e.item.text(),select3val=$("#filterClipsSelect3").data("kendoDropDownList").value(),searchField={field:"name",operator:"contains",value:$("#clip-search-field").val()};select1field="All"!=select1val?{field:"location",operator:"contains",value:select1val}:{field:"location",operator:"neq",value:select1val},select2field="All"!=select2val?{field:"motifNamesString",operator:"contains",value:select2val}:{field:"motifNamesString",operator:"neq",value:select2val},clipsDataSource.query({filter:{logic:"and",filters:[select1field,select2field,searchField]},sort:[{field:select3val,dir:"asc"}]}),toggleBtnStatus(applyClipBtn,!1)}function onSelectFilterClips3(e){var select1field,select2field,select1val=$("#filterClipsSelect1").data("kendoDropDownList").value(),select2val=$("#filterClipsSelect2").data("kendoDropDownList").value(),dataItem=this.dataItem(e.item),searchField={field:"name",operator:"contains",value:$("#clip-search-field").val()};select1field="All"!=select1val?{field:"location",operator:"contains",value:select1val}:{field:"location",operator:"neq",value:select1val},select2field="All"!=select2val?{field:"motifNamesString",operator:"contains",value:select2val}:{field:"motifNamesString",operator:"neq",value:select2val},clipsDataSource.query({filter:{logic:"and",filters:[select1field,select2field,searchField]},sort:[{field:dataItem.value,dir:"asc"}]}),toggleBtnStatus(applyClipBtn,!1)}function searchClipFunc(){var select1field,select2field,select1val=$("#filterClipsSelect1").data("kendoDropDownList").value(),select2val=$("#filterClipsSelect2").data("kendoDropDownList").value(),select3val=$("#filterClipsSelect3").data("kendoDropDownList").value();select1field="All"!=select1val?{field:"location",operator:"contains",value:select1val}:{field:"location",operator:"neq",value:select1val},select2field="All"!=select2val?{field:"motifNamesString",operator:"contains",value:select2val}:{field:"motifNamesString",operator:"neq",value:select2val},searchVal=$("#clip-search-field").val(),""!=searchVal&&searchVal!=prevSearchVal?(clipsDataSource.query({filter:{logic:"and",filters:[select1field,select2field,{field:"name",operator:"contains",value:searchVal}]},sort:[{field:select3val,dir:"asc"}]}),prevSearchVal=searchVal,$("#clip-search-clear").removeClass("hidden")):""==searchVal&&searchVal!=prevSearchVal&&(clipsDataSource.query({filter:{logic:"and",filters:[select1field,select2field,{field:"name",operator:"contains",value:searchVal}]},sort:[{field:select3val,dir:"asc"}]}),prevSearchVal=searchVal,$("#clip-search-clear").removeClass("hidden")),toggleBtnStatus(applyClipBtn,!1)}function initClipsSearch(){searchVal=$("#clip-search-field").val(),prevSearchVal=searchVal,$("#clip-search-field")&&$("#clip-search-field").on("keyup",this,function(){searchClipFunc()})}function clearClipsFilter(){var select1field,select2field,select1val=$("#filterClipsSelect1").data("kendoDropDownList").value(),select2val=$("#filterClipsSelect2").data("kendoDropDownList").value(),select3val=$("#filterClipsSelect3").data("kendoDropDownList").value();select1field="All"!=select1val?{field:"location",operator:"contains",value:select1val}:{field:"location",operator:"neq",value:select1val},select2field="All"!=select2val?{field:"motifNamesString",operator:"contains",value:select2val}:{field:"motifNamesString",operator:"neq",value:select2val},clipsDataSource.query({filter:{logic:"and",filters:[select1field,select2field,{field:"name",operator:"contains",value:""}]},sort:[{field:select3val,dir:"asc"}]}),$("#clip-search-clear").addClass("hidden"),$("#clip-search-field").val(""),toggleBtnStatus(applyClipBtn,!1)}function productionManageFunc(callback){if(currClipsIds=$.extend(!0,{},currentProduction.get("prodObj.clips")),curMotifsList=$.extend(!0,{},currentProduction.get("prodObj.motifs")),currClipsList=[],currClipMotifsList=[],currentProdMotifsDataSource.read(),currClipsIds.length>0)for(var i=0;i<currClipsIds.length;i++)for(var j=0;j<ProductList.length;j++){if(ProductList[j].clipId==currClipsIds[i]){currClipsList[i]=$.extend(!0,{},ProductList[j]),currClipsList[i].emptyMotifs=0;break}currClipsList[i]={id:j,clipId:0,idString:"none",durTime:"",emptyMotifs:0,name:"not available"}}if(-1!=userAccount.get("indicatives")){var currClip,clipIndex=0;curMotifsList.unshift([]);for(var i=0;i<ProductList.length;i++)if(ProductList[i].clipId==userAccount.get("indicatives")){currClip=$.extend(!0,{},ProductList[i]),currClip.locked="Intro";for(var j=0;j<currClip.motifsNum;j++)curMotifsList[clipIndex].push(0);break}currClipsList.unshift(currClip)}if(-1!=userAccount.get("abdicatives")){var currClip,clipIndex=currClipsList.length;curMotifsList.push([]);for(var i=0;i<ProductList.length;i++)if(ProductList[i].clipId==userAccount.get("abdicatives")){currClip=$.extend(!0,{},ProductList[i]),currClip.locked="Outro";for(var j=0;j<currClip.motifsNum;j++)curMotifsList[clipIndex].push(0);break}currClipsList.push(currClip)}callback&&"function"==typeof callback&&callback()}function populateProdMotifsArr(callback){for(var i=0;i<curMotifsList.length;i++){for(var emptyMotifsCount=0,j=0;j<curMotifsList[i].length;j++){if(-1==curMotifsList[i][j])curMotifsList[i][j]={id:j,motifId:0,accountId:userAccount.id,numName:alphabetNumeration[j]},"Indikativ"!=currClipsList[i].location&&emptyMotifsCount++;else{for(var z=0;z<motifsList.length;z++)if(curMotifsList[i][j]==motifsList[z].motifId){curMotifsList[i][j]=$.extend(!0,{},motifsList[z]),curMotifsList[i][j].numName=alphabetNumeration[j],curMotifsList[i][j].id=j;break}"object"!=typeof curMotifsList[i][j]&&(curMotifsList[i][j]={id:j,motifId:"0",accountId:userAccount.id,numName:alphabetNumeration[j]},"Indikativ"!=currClipsList[i].location&&emptyMotifsCount++)}for(var z=0;z<motifsContentTypeList.length;z++)if(currClipsList[i].clipId==motifsContentTypeList[z].productID&&j+1==motifsContentTypeList[z].position){curMotifsList[i][j].aspect=parseInt(motifsContentTypeList[z].aspect*MOTIF_CONTAINER_HEIGHT);break}}emptyMotifsCount>0&&(currClipsList[i].emptyMotifs=emptyMotifsCount)}callback&&"function"==typeof callback&&callback()}function currProdMotifsListViewChangeFunc(){selectedClipMotifUid=this.select().data("uid"),selectedClipMotifId=this.select().index(),router.navigate("/motifSelect")}function currProdClipsListViewChangeFunc(){selectedClipUid=this.select().data("uid"),selectedClipId=this.select().index(),currClipMotifsList="Indikativ"==currClipsList[selectedClipId].location?[]:curMotifsList[selectedClipId],currentProdMotifsDataSource.read(),this.select().length>0&&bindDeleteFunc($("#deleteClipButton"),!0),toggleBtnStatus(productionBtnsToDisable,!0)}function ApllySelectedMotif(callback){router.navigate("/production");var replacedMotif=currentProdMotifsDataSource.getByUid(selectedClipMotifUid),curMotif=$.extend(!0,{},motifsDataSource.getByUid(selectedMotifUid));curMotif.aspect=replacedMotif.aspect,curMotifsList[selectedClipId][selectedClipMotifId]=$.extend(!0,{},curMotif),currClipMotifsList=curMotifsList[selectedClipId],currentProdMotifsDataSource.read(),0==replacedMotif.motifId&&(currClipsList[selectedClipId].emptyMotifs-=1,currentProdClipsDataSource.read()),checkEmptyMotifs(),callback&&"function"==typeof callback&&callback()}function prodDeleteClipFunc(){currentProdClipsDataSource.getByUid(selectedClipUid);currClipsList.splice(selectedClipId,1),curMotifsList.splice(selectedClipId,1),currentProdClipsDataSource.read(),currClipMotifsList=[],currentProdMotifsDataSource.read(),toggleBtnStatus(productionBtnsToDisable,!1),recalcProductionTime()}function prodReplaceClipFunc(callback){router.navigate("/prodCollection"),$("#clips-list").data("kendoListView").setOptions({selectable:"true"});var currApplyBtn=$("#applyClipBtn , #applyClipBtn2");currApplyBtn.each(function(){$(this).data("kendoButton").setOptions({enable:"false",click:function(e){ApplySelectedClip()}})}),callback&&"function"==typeof callback&&callback()}function ApplySelectedClip(callback){router.navigate("/production");var curMotifAspect=0,replacingClip=clipsDataSource.getByUid(selectedProductUid[0]);currClipsList[selectedClipId]=$.extend(!0,{},replacingClip),currClipsList[selectedClipId].emptyMotifs=currClipsList[selectedClipId].motifsNum,curMotifsList[selectedClipId]=[];for(var i=0;i<replacingClip.motifsNum;i++){for(var z=0;z<motifsContentTypeList.length;z++)if(replacingClip.clipId==motifsContentTypeList[z].productID&&i+1==motifsContentTypeList[z].position){curMotifAspect=parseInt(motifsContentTypeList[z].aspect*MOTIF_CONTAINER_HEIGHT);break}curMotifsList[selectedClipId][i]={id:i,motifId:0,accountId:userAccount.id,numName:alphabetNumeration[i],aspect:curMotifAspect}}currentProdClipsDataSource.read(),currentProdMotifsDataSource.read();var currentListView=$("#production-films");currentListView.data("kendoListView").select(currentListView.children().get(selectedClipId)),recalcProductionTime(),$(".html5lightbox-link").html5lightbox(),callback&&"function"==typeof callback&&callback()}function prodInsertClipFunc(){router.navigate("/prodCollection"),$("#clips-list").data("kendoListView").setOptions({selectable:"multiple"});var currApplyBtn=$("#applyClipBtn , #applyClipBtn2");currApplyBtn.each(function(){$(this).data("kendoButton").setOptions({enable:"false",click:function(e){ApplyNewSelectedClip()}})})}function ApplyNewSelectedClip(callback){router.navigate("/production");for(var erppc=0;erppc<selectedProductUid.length;erppc++){var curMotifAspect=0,replacingClip=$.extend(!0,{},clipsDataSource.getByUid(selectedProductUid[erppc]));replacingClip.emptyMotifs=replacingClip.motifsNum;var curClipsCnt=currentProdClipsDataSource.data().length;if(replacingClip.emptyMotifs=replacingClip.motifsNum,-1!=userAccount.get("abdicatives")&&curClipsCnt>0){var tmpItem=$.extend(!0,{},currClipsList.pop());currClipsList.push(replacingClip),currClipsList.push(tmpItem),curClipsCnt--}else currClipsList.push(replacingClip);curMotifsList.splice(curClipsCnt,0,[]);for(var i=0;i<replacingClip.motifsNum;i++){for(var z=0;z<motifsContentTypeList.length;z++)if(replacingClip.clipId==motifsContentTypeList[z].productID&&i+1==motifsContentTypeList[z].position){curMotifAspect=parseInt(motifsContentTypeList[z].aspect*MOTIF_CONTAINER_HEIGHT);break}curMotifsList[curClipsCnt][i]={itemId:i,motifId:0,accountId:userAccount.id,numName:alphabetNumeration[i],aspect:curMotifAspect}}currentProdClipsDataSource.read(),currentProdMotifsDataSource.read()}var currentListView=$("#production-films");currentListView.data("kendoListView").select(currentListView.children().get(curClipsCnt)),recalcProductionTime(),$(".html5lightbox-link").html5lightbox(),callback&&"function"==typeof callback&&callback()}function checkEmptyMotifs(){if(currClipsList.length>0){for(var unfilledMotifsNum=0,i=0;i<currClipsList.length;i++)currClipsList[i].emptyMotifs>0&&unfilledMotifsNum++,toggleBtnStatus(productionProduceBtn,!1);0==unfilledMotifsNum&&toggleBtnStatus(productionProduceBtn,!0)}}function recalcProductionTime(){var framesArr=[];if(currClipsList.length>0)for(var i=0;i<currClipsList.length;i++)framesArr.push(currClipsList[i].duration);currentProduction.set("prodObj.durTime",timeFormatingFromClipsArr(framesArr))}function initProductionDragNDrop(){$("#production-films").kendoSortable({cursorOffset:{top:0,left:10},disabled:".locked",ignore:".video-wr , video",placeholder:function(element){return element.clone().css("opacity",.3)},hint:function(element){return element.clone().removeClass("k-state-selected")},change:function(e){var curItem=$.extend(!0,{},currClipsList[e.oldIndex]),curMotifs=[];currClipsList.splice(e.oldIndex,1),currClipsList.splice(e.newIndex,0,curItem);for(var i=0;i<curMotifsList[e.oldIndex].length;i++)curMotifs.push($.extend(!0,{},curMotifsList[e.oldIndex][i]));curMotifsList.splice(e.oldIndex,1),curMotifsList.splice(e.newIndex,0,[]);for(var i=0;i<curMotifs.length;i++)curMotifsList[e.newIndex][i]=$.extend(!0,{},curMotifs[i]);currentProdClipsDataSource.read();var curListView=$("#production-films").data("kendoListView");curListView.select(curListView.element.children().get(e.newIndex)),$(".html5lightbox-link").html5lightbox()}})}function bindEnterFunc(el,status){1==status&&void 0==jQuery._data(document,"events").keydown&&$(document).on("keydown",function(e){13==e.which&&$(el).trigger("click")}),0==status&&$(document).off("keydown")}function bindDeleteFunc(el,status){1==status&&void 0==jQuery._data(document,"events").keydown&&$(document).on("keydown",function(e){46==e.which&&$(el).trigger("click")}),0==status&&$(document).off("keydown")}function popupCallFunc(e){if("BUTTON"==e.event.target.tagName)var el=$(e.event.target);else var el=$(e.event.target).parent();var $curPopup=$("#window");winClass=$(el).data("popup-type");var tplName=$(el).data("popup-content");refreshCallBackFunc="",refreshCallBackFunc=window[$(el).data("refresh-func")],$curPopup.parent().addClass(winClass);var win=$curPopup.data("kendoWindow");win.setOptions({activate:function(){kendo.init($curPopup),"function"==typeof refreshCallBackFunc&&refreshCallBackFunc(),localizeHtml($curPopup)}}),win.bind("refresh",function(){win.center(),win.open()}),win.refresh("tpl/popups/"+tplName+".html.tpl")}function onThemingChange(){var value;value=$("#theme-select").length?$("#theme-select").val():DEFAULT_THEME,newThemeLink="css/kendo."+value+".min.css",$("#theme-link").attr("href",newThemeLink),$("body").attr("class","k-content theme-"+value),docCookies.removeItem("virtualcampaign_theming"),docCookies.setItem("virtualcampaign_theming",value,new Date(2038,1,1),"/",window.location.host,null)}function onLangChange(){var value;value=$("#language-select").length?$("#language-select").val():DEFAULT_LANG,currLang=langArr[value],localizeHtml($("#page")),docCookies.removeItem("virtualcampaign_lang"),docCookies.setItem("virtualcampaign_lang",value,new Date(2038,1,1),"/",window.location.host,null)}function initLocalizationData(lang_path,lang_name,callback){$.getJSON(lang_path,function(json){}).done(function(json){langArr[lang_name]=json,callback&&"function"==typeof callback&&callback()}).fail(function(jqxhr,textStatus,error){var err=textStatus+", "+error;console.log("Request Failed: "+err)})}function localizationFunc(callback){langViewModel=new kendo.observable({lang:currLang}),kendo.bind($("#loginPage"),langViewModel),currLang=langArr[DEFAULT_LANG],langViewModel.set("lang",currLang),callback&&"function"==typeof callback&&callback()}function localizeHtml(parentTag){$(parentTag).find(".lang-replace").each(function(){if(""!=$(this).data("lang")&&void 0!=$(this).data("lang")){var langLabel=$(this).data("lang");$(this).html(currLang[langLabel])}if(""!=$(this).data("tooltip")&&void 0!=$(this).data("tooltip")){var tooltipLabel=$(this).data("tooltip");$(this).attr("title",currLang[tooltipLabel])}if(""!=$(this).data("placeholder")&&void 0!=$(this).data("placeholder")){var placeholderLabel=$(this).data("placeholder");$(this).attr("placeholder",currLang[placeholderLabel])}})}function themeSelectInit(){if(docCookies.hasItem("virtualcampaign_theming")){var selectVal=docCookies.getItem("virtualcampaign_theming");$("#theme-select").length&&$("#theme-select").data("kendoDropDownList").select($("#theme-select option[value="+selectVal+"]").index()),newThemeLink="css/kendo."+selectVal+".min.css",$("#theme-link").attr("href",newThemeLink),$("body").attr("class","k-content theme-"+selectVal)}else docCookies.setItem("virtualcampaign_theming",DEFAULT_THEME,new Date(2038,1,1),"/",window.location.host,null),onThemingChange()}function localSelectInit(){if(docCookies.hasItem("virtualcampaign_lang")){var selectVal=docCookies.getItem("virtualcampaign_lang");$("#language-select").length&&$("#language-select").data("kendoDropDownList").select($("#language-select option[value="+selectVal+"]").index()),currLang=langArr[selectVal],localizeHtml($("#page"))}else docCookies.setItem("virtualcampaign_lang",DEFAULT_LANG,new Date(2038,1,1),"/",window.location.host,null),onLangChange()}var templateLoader=function($,host){return{loadExtTemplate:function(path,callback){var resultAll="";for(i=0;i<path.length;i++)i!=path.length-1?$.get(path[i]).success(function(result){resultAll+=result}).error(function(result){alert("Error Loading Template - "+path[i])}):$.get(path[i]).success(function(result){resultAll+=result,$("body").append(resultAll),callback&&"function"==typeof callback&&callback()}).error(function(result){alert("Error Loading Template - "+path[i])})}}}(jQuery,document),tplArr=["tpl/pages.html.tpl"],constFPS=25,DEFAULT_LANG="en_loc",langArr=[],currLang,langViewModel,cookieTheme="",cookieLang="",alphabetNumeration=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],refreshCallBackFunc,MAX_LOAD_IMG_WIDTH=600,MAX_LOAD_IMG_HEIGHT=600,MOTIF_CONTAINER_HEIGHT=170,kendoWindowParams={minHeight:50,minWidth:318,maxWidth:600,title:!1,visible:!1,resizable:!1,modal:!0,content:"",close:function(e){}},responsivePanelParams={breakpoint:1024,orientation:"left"},defProductionParams={id:0,name:"New production",crTime:0,duration:0,durTime:"00:00 min",clips:[],motifs:[]},currentProduction=new kendo.observable({prodObj:{id:0,name:"New production",crTime:0,duration:0,durTime:"00:00 min",clips:[],motifs:[]}}),currentProdClipsDataSource,currentProdClipsListView,userAccount=new kendo.observable({loginStatus:0,id:0,groupId:0,firstName:"empty",surName:"empty",inProductionNum:0,inProduction:"",lastProdId:0,curProduction:"",productsVal:0,motifsVal:0,indicatives:-1,abdicatives:-1}),motifsContentTypeList=[],motifsDataSource,motifListView,motifSelectListView,motifsList=[],selectedMotifUid=[],selectedMotifId=[],uploadMotifObj,deleteMotifObj,filmsDataSource,filmsListView,filmsList=[],selectedFilmUid=[],selectedFilmId=[],clipsDataSource,clipsListView,ProductList=[],dicativeList=[],clipsLocArr=[],motifsTypeNamArr=[],selectedProductUid=[],selectedProductId=[],selectedClipId,currClipsIds=[],currClipsList=[],curMotifsList=[],currClipMotifsList=[],selectedClipUid,selectedClipId,selectedClipMotifUid,selectedClipMotifId,currentProdMotifsDataSource,currentProdClipsDataSource,winClass="",SALTED="vcampaign_niDZA704MvAgRyfLvIzr",codecFormatsObj=kendo.observable({codecFormatsArr:[],jobNameField:currentProduction.get("prodObj.name"),userEmailField:""}),ProductionsStatArr=[],ProductUsageStatArr=[],statisticUser=new kendo.observable({userName:"",statStartDate:0,statEndDate:0,statStartDateString:"",statEndDateString:"",TimespanFilmCount:0,TimespanClipCount:0,TotalFilmCount:0,TotalClipCount:0}),ProductionsTableData,ProductionsTable,ProductionsChart,ProductionsView,ProductUsageTableData,ProductUsageTable,ProductUsageChart,ProductUsageView,prodCrTimeArr=[],clipsFilterModel,motifFilterModel,filmFilterModel,filmsBtnsToDisable=$("#deleteFilm , #downloadFilm , #loadFilm"),productionBtnsToDisable=$("#deleteClipButton , #replaceClipButton","#deleteClipButton2 , #replaceClipButton2"),productionProduceBtn=$("#produceProdBtn , #produceProdBtn2"),deleteMotifBtn=$("#delete-motif-btn , #delete-motif-btn2"),applyMotifBtn=$("#applyMotifBtn , #applyMotifBtn2"),applyClipBtn=$("#applyClipBtn , #applyClipBtn2"),prevSearchVal="",searchVal="",page404=new kendo.View("#page404",{init:function(e){},show:function(e){localizeHtml($("#page"))},hide:function(e){}}),loginPage=new kendo.View("#login",{init:function(e){themeSelectInit(),localSelectInit()},show:function(e){void 0!=currLang&&localizeHtml($("#page"))}}),hubPage=new kendo.View("#hub",{init:function(e){},show:function(e){localizeHtml($("#page"))}}),logoutPage=new kendo.View("#logout",{show:function(e){localizeHtml($("#page"))}}),motifsPage=new kendo.View("#motifs",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams)},show:function(e){$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page"));var motifListViewObj=$("#motifs-list").data("kendoListView");motifListViewObj.clearSelection(),motifListViewObj.setOptions({selectable:"multiple"}),kendo.bind($("#motifs-filter"),motifFilterModel),initMotifSearch(),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)}}),motifsSelectPage=new kendo.View("#motifs",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams)},show:function(e){$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page")),$(".hide-block").addClass("visible"),$(".show-block").addClass("hidden");var motifListViewObj=$("#motifs-list").data("kendoListView");motifListViewObj.clearSelection(),motifListViewObj.setOptions({selectable:"true"}),kendo.bind($("#motifs-filter"),motifFilterModel),initMotifSearch(),toggleBtnStatus(deleteMotifBtn,!1),toggleBtnStatus(applyMotifBtn,!1)},hide:function(e){bindEnterFunc($("#applyMotifBtn"),!1),$(".hide-block").remove("visible"),$(".show-block").remove("hidden")}}),prodListPage=new kendo.View("#prod-list",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams)},show:function(e){$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page")),initFilmsSearch(),kendo.bind($("#films-filter"),filmFilterModel),$(".html5lightbox-link").html5lightbox(),toggleBtnStatus(filmsBtnsToDisable,!1),$("#films-list").data("kendoListView").clearSelection()},hide:function(e){}}),prodColPage=new kendo.View("#prod-collection",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams)},show:function(e){$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page")),$(".html5lightbox-link").html5lightbox(),$("#clips-list").data("kendoListView").clearSelection(),kendo.bind($("#clips-filter"),clipsFilterModel),initClipsSearch(),toggleBtnStatus(applyClipBtn,!1)},hide:function(e){bindEnterFunc($("#applyClipBtn"),!1)}}),productionPage=new kendo.View("#production",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams),kendo.bind($("#productionPage"),currentProduction)},show:function(e){$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page")),$(".html5lightbox-link").html5lightbox(),toggleBtnStatus(productionBtnsToDisable,!1),initProductionDragNDrop()},hide:function(e){bindDeleteFunc($("#deleteClipButton"),!1);
}}),statisticsPage=new kendo.View("#statistics",{init:function(e){$(".panel-menu").kendoResponsivePanel(responsivePanelParams)},show:function(e){$(".panel-menu").data("kendoResponsivePanel").close(),localizeHtml($("#page")),kendo.bind($("#statistic-page"),statisticUser),initStatisticTime(function(){getStatisticsFunc(function(){initCharts()})})},hide:function(e){}}),layout=new kendo.Layout("<div id='page'></div>"),motifTemplate="",filmTemplate="",clipTemplate="",motifProdTemplate="",clipProdTemplate="";motifsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(motifsList)},create:function(e){e.data.id=motifsList.length,motifsList.push(e.data),e.success(e.data)},update:function(e){motifsList[e.data.id]=e.data,e.success()},destroy:function(e){motifsList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"crTime",dir:"desc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},motifId:{type:"number"},accountId:{type:"number"},name:{type:"string"},frameCount:{type:"number"},crTime:{type:"number"},date:{type:"string"},description:{type:"string"}}}},error:function(e){alert("failed to load motifs array",e.status)}}),filmsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(filmsList)},create:function(e){e.data.id=filmsList.length,filmsList.push(e.data),e.success(e.data)},update:function(e){filmsList[e.data.id]=e.data,e.success()},destroy:function(e){filmsList.splice(e.data.id,1),e.success()}},batch:!1,sort:[{field:"crTime",dir:"desc"}],schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},filmId:{type:"number"},accountId:{type:"number"},jobId:{type:"number"},name:{type:"string"},crTime:{type:"number"},crDate:{type:"string"},duration:{type:"number"},durTime:{type:"string"},videoFiles:{type:"default"},products:{type:"string"},motifs:{type:"string"}}}},error:function(e){alert("failed to load films array",e.status)}}),clipsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(ProductList)},create:function(e){e.data.id=ProductList.length,ProductList.push(e.data),e.success(e.data)},update:function(e){ProductList[e.data.id]=e.data,e.success()},destroy:function(e){ProductList.splice(e.data.id,1),e.success()}},batch:!1,schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},clipId:{type:"number"},idString:{type:"string"},name:{type:"string"},location:{type:"string"},crTime:{type:"number"},date:{type:"string"},duration:{type:"number"},durTime:{type:"string"},motifsNum:{type:"number"},emptyMotifs:{type:"number"},locked:{type:"string"}}}},error:function(e){alert("failed to load clips array",e.status)}}),currentProdMotifsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(currClipMotifsList)},create:function(e){e.data.id=currClipMotifsList.length,currClipMotifsList.push(e.data),e.success(e.data)},update:function(e){currClipMotifsList[e.data.id]=e.data,e.success()},destroy:function(e){currClipMotifsList.splice(e.data.id,1),e.success()}},batch:!1,schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0,defaultValue:0},motifId:{type:"number",defaultValue:0},accountId:{type:"number",defaultValue:0},aspect:{type:"number",defaultValue:0},name:{type:"string"},frameCount:{type:"number"},crTime:{type:"number"},date:{type:"string"},description:{type:"string"},numName:{type:"string",defaultValue:"null"}}}},error:function(e){alert("failed to load motifs array",e.status)}}),currentProdClipsDataSource=new kendo.data.DataSource({transport:{read:function(e){e.success(currClipsList)},create:function(e){e.data.id=currClipsList.length,currClipsList.push(e.data),e.success(e.data)},update:function(e){currClipsList[e.data.id]=e.data,e.success()},destroy:function(e){currClipsList.splice(e.data.id,1),e.success()}},batch:!1,schema:{model:{id:"id",fields:{id:{editable:!1,nullable:!0},clipId:{type:"number"},idString:{type:"string"},name:{type:"string"},location:{type:"string"},crTime:{type:"number"},date:{type:"string"},duration:{type:"number"},durTime:{type:"string"},motifsNum:{type:"number"},emptyMotifs:{type:"number"},locked:{type:"string"}}}},error:function(e){alert("failed to load clips array",e.status)}});var router=new kendo.Router({routeMissing:function(e){console.log("404"),router.navigate("/page404")},change:function(e){console.log(e.url)}});router.route("/",function(){layout.showIn("#page",loginPage)}),router.route("/login",function(){layout.showIn("#page",loginPage)}),router.route("/hub",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",hubPage):router.navigate("/login")}),router.route("/myproductions",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",prodListPage):router.navigate("/login")}),router.route("/production",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",productionPage):router.navigate("/login")}),router.route("/motifs",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",motifsPage):router.navigate("/login")}),router.route("/motifSelect",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",motifsSelectPage):router.navigate("/login")}),router.route("/prodCollection",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",prodColPage):router.navigate("/login")}),router.route("/statistics",function(){0!=userAccount.get("loginStatus")?layout.showIn("#page",statisticsPage):router.navigate("/login")}),router.route("/logout",function(){layout.showIn("#page",logoutPage)}),router.route("/page404",function(){layout.showIn("#page",page404)}),$(function(){templateLoader.loadExtTemplate(tplArr,function(){console.log("----------- all tpls loaded ---------------"),motifTemplate=kendo.template($("#motifTemplate").html()),filmTemplate=kendo.template($("#filmTemplate").html()),clipTemplate=kendo.template($("#clipTemplate").html()),clipProdTemplate=kendo.template($("#clipProdTemplate").html()),motifProdTemplate=kendo.template($("#motifProdTemplate").html()),layout.render($("#application")),router.start(),$("#page").on("touchstart click","#logout-btn",function(event){logOut(),event.preventDefault()}),$("#theme-select").length&&$("#theme-select").kendoDropDownList({change:onThemingChange}),$("#language-select").length&&$("#language-select").kendoDropDownList({change:onLangChange})});$("#window").kendoWindow(kendoWindowParams);$("body").on("touchend click",".popup-close",function(event){var curPopup=$(this).closest("[data-role=window]");curPopup.kendoWindow("close"),curPopup.parent().removeClass(winClass)}),$("body").on("touchend click",".k-overlay",function(event){var curPopups=$("[data-role=window]");curPopups.parent().removeClass(winClass),curPopups.kendoWindow("close")})});var docCookies={getItem:function(sKey){return sKey?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(sKey,sValue,vEnd,sPath,sDomain,bSecure){if(!sKey||/^(?:expires|max\-age|path|domain|secure)$/i.test(sKey))return!1;var sExpires="";if(vEnd)switch(vEnd.constructor){case Number:sExpires=vEnd===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+vEnd;break;case String:sExpires="; expires="+vEnd;break;case Date:sExpires="; expires="+vEnd.toUTCString()}return document.cookie=encodeURIComponent(sKey)+"="+encodeURIComponent(sValue)+sExpires+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"")+(bSecure?"; secure":""),!0},removeItem:function(sKey,sPath,sDomain){return this.hasItem(sKey)?(document.cookie=encodeURIComponent(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:""),!0):!1},hasItem:function(sKey){return sKey?new RegExp("(?:^|;\\s*)"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1},keys:function(){for(var aKeys=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),nLen=aKeys.length,nIdx=0;nLen>nIdx;nIdx++)aKeys[nIdx]=decodeURIComponent(aKeys[nIdx]);return aKeys}};initLocalizationData("loc/en.json","en_loc",function(){initLocalizationData("loc/de.json","de_loc",function(){initLocalizationData("loc/tr.json","tr_loc",function(){localSelectInit()})})});